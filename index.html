<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-rabbtMQ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/01/rabbtMQ/" class="article-date">
  <time datetime="2019-08-01T09:20:19.000Z" itemprop="datePublished">2019-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/01/rabbtMQ/">&#39;rabbtMQ&#39;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目录</p>
<p>目录 目录一、昨日回顾1、知识点回顾二、学习目标三、RabbitMQ1、简介2、AMQP 是什么3、消息队列的类型四、安装1、RabbitMQ 所支持的平台2、windows 下安装2.1、安装 Erlang2.1.1、以管理员身份运行2.1.2、下一步2.1.3、下一步2.1.4、选择 Install2.1.5、等待安装2.1.6、点击完成安装2.1.7、检测是否安装成功2.2、安装 RabbitMQ2.2.1、以管理员身份运行2.2.2、下一步2.2.3、选择 Install2.2.4、等待安装2.2.5、下一步2.2.6、点击完成2.2.7、查看服务是否启动2.3、激活web管理页面2.3.1、激活管理插件2.3.2、添加用户2.3.3、浏览器中访问3、Linux下安装3.1、安装 Erlang3.1.1、安装依赖的底层库3.1.2、更新 yum 源3.1.1、下载 erlang 镜像源文件3.1.2、安装 erlang 镜像源3.1.3、安装3.1.4、检测是否安装成功3.2、安装 RabbitMQ3.2.1、输入密钥3.2.2、下载 rpm3.2.3、安装3.2.4、启动服务并查看状态3.3、激活web管理页面3.3.1、激活管理插件3.3.2、添加用户3.3.3、浏览器中访问五、PHP 中开启 RabbitMQ 扩展文件1、windows 安装扩展1.1、下载扩展文件1.2、解压文件1.3、复制php_amqp.dll文件到PHP扩展目录中1.4、复制rabbitmq.4.dll文件到php.exe同级目录下1.5、修改 php.ini 配置文件1.6、重启服务1.7、查看是否开启成功2、Linux 安装扩展2.1、rabbitmq-c 依赖库2.1.1、下载2.1.2、解压2.1.3、进入目录2.1.4、指定安装目录2.1.5、编译软件并且进行安装2.2、安装扩展文件2.2.1、下载扩展文件2.2.2、上传文件2.2.3、解压文件2.2.4、进入目录2.2.5、生成编译文件2.2.6、进行软件配置和环境检测2.2.7、编译软件并且进行安装2.2.8、修改 php.ini 文件2.2.9、重启服务2.2.10、查看是否开启成功六、PHP 操作 RabbitMQ1、安装 composer1.1、把PHP设置到环境变量中1.1.1、进入PHP目录1.1.2、设置系统环境变量2.1、安装2.1.1、下载 Composer-Setup.exe 文件安装2.1.2、使用 PHP 方式安装2.1.2.1、下载 composer-setup.php2.1.2.2、下载  composer.phar 文件2.1.2.3、删除 composer-setup.php 文件2.1.2.4、创建 composer.bat 文件2.1.3、切换镜像源2、下载RabbitMQ代码2.1、创建 composer.json 文件2.2、安装MQ项目(下载代码)3、Hello World模式3.1、客户端3.1.1、引入相关文件3.1.2、实例MQ对象3.1.3、创建一个队列3.1.4、发送消息与关闭队列(通道)与连接3.2、服务端3.2.1、引入相关的文件3.2.2、实例MQ对象3.2.3、创建队列3.2.4、接收消息4、路由(Routing)模式4.1、客户端4.1.1、引入相关的文件4.1.2、实例化MQ对象4.1.3、创建交换机4.1.4、发送消息与关闭队列(通道)与连接4.2、服务端4.2.1、引入相关的文件4.2.2、实例化MQ对象4.2.3、创建交换机4.2.4、创建队列与绑定交换机4.2.5、接收消息与关闭队列(通道)与连接七、推送消息模板1、创建一个消息模板2、推送微信模板消息八、总结</p>
<p>一、昨日回顾</p>
<p>1、知识点回顾</p>
<p>Redis 有几种数据类型？</p>
<pre><code>5种

string

    常用命令有哪些？

    set、get、incrby、incr、decrby、decr

hash

    常用命令有哪些？

    hset、hget、hmset、hmget、hgetall、hdel

list

    常用命令有哪些？

    lpush、lpop、rpush、rpop、lrange、ltrim

set

    常用命令有哪些？

    sadd、smembers、sdiff、sunion、sinter、scard

zset

    常用命令有哪些？

    zadd、zrange、zrevrange</code></pre><p>快照与AOF持久化模式：</p>
<pre><code>快照：将所数据保存到一个dump文件中

AOF：将所有命令保存一个*.aof文件</code></pre><p>Redis 管理命令：</p>
<pre><code>keys、type、del、expire、exists、ttl、ping、auth、select</code></pre><p>二、学习目标</p>
<ul>
<li>能够了解RabbitMQ的作用</li>
<li>能够说出RabbitMQ有几种模式</li>
<li>能够实现Linux与win系统上安装RabbitMQ服务</li>
<li>能够实现Linux与win系统上PHP的RabbitMQ扩展安装</li>
</ul>
<p>三、RabbitMQ</p>
<p>官方开发文档：<a href="https://www.rabbitmq.com/getstarted.html" target="_blank" rel="noopener">https://www.rabbitmq.com/getstarted.html</a></p>
<p>中文开发文档：<a href="https://xiaoxiami.gitbook.io/rabbitmq_into_chinese_php/rabbitmq-jian-jie/description" target="_blank" rel="noopener">https://xiaoxiami.gitbook.io/rabbitmq_into_chinese_php/rabbitmq-jian-jie/description</a></p>
<p>1、简介</p>
<pre><code>RabbitMQ是一个消息代理、一个消息系统的媒介。它可以为你的应用提供一个通用的消息发送和接收平台，并且保证消息再传输过程中的安全。</code></pre><p>技术亮点</p>
<ul>
<li>可靠性</li>
<li>灵活的路由</li>
<li>集群</li>
<li>高可用的队列</li>
<li>多协议</li>
<li>广泛的客户端</li>
<li>可视化管理工具</li>
<li>等</li>
</ul>
<p>安全和端口</p>
<p>4369 (epmd)，25672 (Erlang distribution)</p>
<p>5672，5671 (启用了 或者 未启用 TLS 的 AMQP 0-9-1)</p>
<p>15672 (如果管理插件被启用)</p>
<p>61613，61614 (如果 STOMP 被启用)</p>
<p>1883，8883 (如果 MQTT 被启用)</p>
<p>2、AMQP 是什么</p>
<pre><code>AMQP（高级消息队列协议）是一个网络协议。它支持符合要求的客户端应用（application）和消息中间件代理（messaging middleware broker）之间进行通信。</code></pre><p>3、消息队列的类型</p>
<p>中文PHP开发文档：<a href="https://xiaoxiami.gitbook.io/rabbitmq_into_chinese_php" target="_blank" rel="noopener">https://xiaoxiami.gitbook.io/rabbitmq_into_chinese_php</a></p>
<p>官网：</p>
<p>四、安装</p>
<p>注意：</p>
<pre><code>erlang与RabbitMQ版本的对应关系，如：RabbitMQ3.6.10，建议的erlang版本是19.3.x(安装前必看：https://www.rabbitmq.com/which-erlang.html)</code></pre><p>1、RabbitMQ 所支持的平台</p>
<pre><code>RabbitMQ 有着运行在所有 Erlang 所支持的平台之上的潜力，从嵌入式系统到多核心集群还有基于云端的服务器。</code></pre><p>以下的平台是 Erlang 语言所支持的，因此 RabbitMQ 可以运行其上：</p>
<ul>
<li>Solaris</li>
<li>BSD</li>
<li>Linux</li>
<li>Mac OS X</li>
<li>TRU64</li>
<li>Windows</li>
<li>VxWorks</li>
</ul>
<p>RabbitMQ 的开源版本通常被部署在以下的平台上：</p>
<ul>
<li>Ubuntu 和其他基于 Debian 的 Linux 发行版</li>
<li>Fedora 和其他基于 RPM 包管理方式的 Linux 发行版</li>
<li>openSUSE 和衍生的发行版（包括 SLES 和 SLERT）</li>
<li>Mac OS x</li>
<li>windows XP 和后续版本</li>
</ul>
<p>2、windows 下安装</p>
<p>2.1、安装 Erlang</p>
<p>官网：<a href="http://www.erlang.org/" target="_blank" rel="noopener">http://www.erlang.org/</a></p>
<p>下载地址：<a href="http://erlang.org/download/otp_win64_19.3.exe" target="_blank" rel="noopener">http://erlang.org/download/otp_win64_19.3.exe</a></p>
<p>2.1.1、以管理员身份运行</p>
<p>2.1.2、下一步</p>
<p>2.1.3、下一步</p>
<p>2.1.4、选择 Install</p>
<p>2.1.5、等待安装</p>
<p>2.1.6、点击完成安装</p>
<p>2.1.7、检测是否安装成功</p>
<p>先进入Erlang安装目录下的bin目录下</p>
<p>在地址栏中输入 cmd 后，按回车键</p>
<p>上面代表安装成功</p>
<p>2.2、安装 RabbitMQ</p>
<p>官网：<a href="https://www.rabbitmq.com" target="_blank" rel="noopener">https://www.rabbitmq.com</a></p>
<p>下载地址：<a href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.7/rabbitmq-server-3.7.7.exe" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.7/rabbitmq-server-3.7.7.exe</a></p>
<p>2.2.1、以管理员身份运行</p>
<p>2.2.2、下一步</p>
<p>2.2.3、选择 Install</p>
<p>注意：不要安装到中文目录</p>
<p>2.2.4、等待安装</p>
<p>2.2.5、下一步</p>
<p>2.2.6、点击完成</p>
<p>2.2.7、查看服务是否启动</p>
<p>2.3、激活web管理页面</p>
<p>2.3.1、激活管理插件</p>
<p>首先，进入RabbitMQ安装目录下的sbin目录</p>
<p>然后，在地址栏中输入 cmd</p>
<p>再然后，在 cmd 窗口中输入以下命令</p>
<pre><code>rabbitmq-plugins enable rabbitmq_management</code></pre><p>2.3.2、添加用户</p>
<p>默认用户名与密码为：guest</p>
<p>例如：添加一个 php34的用户，密码设置为：php34</p>
<pre><code>#添加用户rabbitmqctl  add_user username password
rabbitmqctl  add_user php34 php34
#设置用户为管理员rabbitmqctl set_user_tags username administrator
rabbitmqctl set_user_tags php34 administrator
#设置用户权限rabbitmqctl set_permissions -p / username &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;
rabbitmqctl set_permissions -p / php34 &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code></pre><p>2.3.3、浏览器中访问</p>
<p>RabbitMQ Web服务的默认的端口为：15672</p>
<p>请求格式：<a href="http://ip:15672" target="_blank" rel="noopener">http://ip:15672</a></p>
<p>登陆成功后，效果如下图所示：</p>
<p>3、Linux下安装</p>
<p>学习目标：掌握在Linux安装RabbitMQ</p>
<p>步骤</p>
<ol>
<li>安装Erlang<ol>
<li>安装yum源(依赖库)</li>
<li>更新yum源 yum -y update</li>
</ol>
</li>
<li>安装RabbitMQ<ol>
<li>输入密钥</li>
<li>下载rpm包(yum安装源)</li>
<li>启动服务并查看状态</li>
</ol>
</li>
<li>激活web管理页面<ol>
<li>激活web管理页面</li>
<li>添加用户(默认的用户与密码也是：guest，Linux无法使用登陆)</li>
<li>设置权限</li>
</ol>
</li>
</ol>
<p>3.1、安装 Erlang</p>
<p>3.1.1、安装依赖的底层库</p>
<pre><code>shell&gt;# yum install -y epel-release</code></pre><p>3.1.2、更新 yum 源</p>
<pre><code>shell&gt;# yum -y update</code></pre><p>注意：更新成功后需要重启服务器 shell&gt;# reboot</p>
<p>3.1.1、下载 erlang 镜像源文件</p>
<p>注意：有可能提示没有wget这个，解决方案使用yum源安装：yum -y install wget</p>
<pre><code>shell&gt;# wget http://packages.erlang-solutions.com/erlang-solutions-1.0-1.noarch.rpm</code></pre><p>3.1.2、安装 erlang 镜像源</p>
<pre><code>shell&gt;# rpm -Uvh erlang-solutions-1.0-1.noarch.rpm</code></pre><p>3.1.3、安装</p>
<pre><code>shell&gt;# yum -y install erlang</code></pre><p>安装完成效果如下图所示：</p>
<p>3.1.4、检测是否安装成功</p>
<pre><code>shell&gt;# erl</code></pre><p>3.2、安装 RabbitMQ</p>
<p>3.2.1、输入密钥</p>
<pre><code>shell&gt;# rpm --import https://www.rabbitmq.com/rabbitmq-signing-key-public.asc</code></pre><p>3.2.2、下载 rpm</p>
<pre><code>shell&gt;# wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.8/rabbitmq-server-3.7.8-1.el6.noarch.rpm</code></pre><p>成功以下图所示：</p>
<p>3.2.3、安装</p>
<pre><code>shell&gt;# yum -y install rabbitmq-server-3.7.8-1.el6.noarch.rpm</code></pre><p>3.2.4、启动服务并查看状态</p>
<pre><code># 启动服务
shell&gt;# service rabbitmq-server start
# 重启
shell&gt;# service rabbitmq-server restart
# 查看状态
shell&gt;# service rabbitmq-server status
# 停止
shell&gt;# service rabbitmq-server stop</code></pre><p>启动成功如下图所示：</p>
<p>有可能报以下错误：</p>
<p>于是将bogon也加入到/etc/hosts 里面的127.0.0.1 bogon</p>
<pre><code>shell&gt;# vim /etc/hosts</code></pre><p>在/etc/hosts文件添加一行，内容为：127.0.0.1 bogon</p>
<p>注意：确保防火墙关闭状态</p>
<p>service rabbitmq-server start 启动</p>
<p>3.3、激活web管理页面</p>
<p>3.3.1、激活管理插件</p>
<pre><code>#使用rabbitmq-plplugins激活管理
shell&gt;# /usr/sbin/rabbitmq-plugins enable rabbitmq_management</code></pre><p>有可能报以错误信息：</p>
<p>解决方案：</p>
<p>修改 hosts，添加 127.0.0.1 rabbit@localhost</p>
<pre><code>shell&gt;# vim /etc/hosts</code></pre><p>将所有进程杀死：</p>
<p>然后再启动服务</p>
<p>3.3.2、添加用户</p>
<p>默认用户名与密码为：guest</p>
<p>例如：添加一个 php34 的用户，密码设置为：php34</p>
<pre><code>#添加用户rabbitmqctl  add_user username password
shell&gt;# rabbitmqctl  add_user php34 php34
#设置用户未管理员rabbitmqctl set_user_tags username administrator
shell&gt;# rabbitmqctl set_user_tags php34 administrator
#设置用户权限rabbitmqctl set_permissions -p / username &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;
shell&gt;# rabbitmqctl set_permissions -p / php34 &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code></pre><p>解决使用 guset用户登陆问题</p>
<pre><code>#进入目录
shell&gt;# cd /usr/share/doc/rabbitmq-server-3.7.8/



#复制配置文件
shell&gt;# cp rabbitmq.config.example /etc/rabbitmq/rabbitmq.config



#修改配置文件
#将 {loopback_users, []} 内容写入配置文件[{rabbit,[ 后面
shell&gt;# vim /etc/rabbitmq/rabbitmq.config



#重启服务
shell&gt;# service rabbitmq-server restart</code></pre><p>添加用户：</p>
<p>设置权限</p>
<p>3.3.3、浏览器中访问</p>
<p>RabbitMQ Web服务的默认的端口为：15672</p>
<p>请求格式：<a href="http://ip:15672" target="_blank" rel="noopener">http://ip:15672</a></p>
<p>登陆成功后，效果如下图所示：</p>
<p>五、PHP 中开启 RabbitMQ 扩展文件</p>
<p>扩展文件下载地址：<a href="http://pecl.php.net/package/amqp" target="_blank" rel="noopener">http://pecl.php.net/package/amqp</a></p>
<p>查看PHP版本号与位数、VC库、nts/ts</p>
<p>1、windows 安装扩展</p>
<p>1.1、下载扩展文件</p>
<p>下载地址：<a href="http://pecl.php.net/package/amqp/1.9.4/windows" target="_blank" rel="noopener">http://pecl.php.net/package/amqp/1.9.4/windows</a></p>
<p>1.2、解压文件</p>
<p>1.3、复制php_amqp.dll文件到PHP扩展目录中</p>
<p>1.4、复制rabbitmq.4.dll文件到php.exe同级目录下</p>
<p>1.5、修改 php.ini 配置文件</p>
<p>1.6、重启服务</p>
<p>1.7、查看是否开启成功</p>
<p>2、Linux 安装扩展</p>
<p>2.1、rabbitmq-c 依赖库</p>
<p>2.1.1、下载</p>
<p>下载地址：<a href="https://github.com/alanxz/rabbitmq-c/archive/v0.9.0.tar.gz" target="_blank" rel="noopener">https://github.com/alanxz/rabbitmq-c/archive/v0.9.0.tar.gz</a></p>
<p>2.1.2、解压</p>
<pre><code>shell&gt;# tar -zxvf rabbitmq-c-0.9.0.tar.gz</code></pre><p>2.1.3、进入目录</p>
<pre><code>shell&gt;# cd rabbitmq-c-0.9.0</code></pre><p>2.1.4、指定安装目录</p>
<pre><code>shell&gt;# cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/librabbitmq</code></pre><p>2.1.5、编译软件并且进行安装</p>
<pre><code>shell&gt;# make &amp;&amp; make install</code></pre><p>2.2、安装扩展文件</p>
<p>2.2.1、下载扩展文件</p>
<p>下载扩展文件：<a href="http://pecl.php.net/package/amqp" target="_blank" rel="noopener">http://pecl.php.net/package/amqp</a></p>
<p>2.2.2、上传文件</p>
<p>2.2.3、解压文件</p>
<pre><code>shell&gt;# tar -zxvf amqp-1.9.4.tgz</code></pre><p>2.2.4、进入目录</p>
<pre><code>shell&gt;# cd amqp-1.9.4</code></pre><p>2.2.5、生成编译文件</p>
<pre><code>shell&gt;# /usr/local/php/bin/phpize</code></pre><p>2.2.6、进行软件配置和环境检测</p>
<pre><code>shell&gt;# ./configure --with-php-config=/usr/local/php/bin/php-config --with-amqp --with-librabbitmq-dir=/usr/local/librabbitmq</code></pre><p>2.2.7、编译软件并且进行安装</p>
<pre><code>shell&gt;# make &amp;&amp; make install</code></pre><p>成功如下图所示：</p>
<p>有可能报以下错误信息：</p>
<p>解决方案：</p>
<p>进入 /usr/local/librabbitmq/ 目录下发现没有 lib 目录，只有 lib64</p>
<pre><code>shell&gt;# cd /usr/local/librabbitmq</code></pre><p>将 /usr/local/librabbitmq/lib64 目录复制一份并生命名为 lib</p>
<pre><code>shell&gt;# cp -R /usr/local/librabbitmq/lib64/ /usr/local/librabbitmq/lib</code></pre><p>然后再重复执行：</p>
<pre><code>shell&gt;# cd /root/amqp-1.9.4
shell&gt;# make &amp;&amp; make install</code></pre><p>2.2.8、修改 php.ini 文件</p>
<pre><code>shell&gt;# vim /usr/local/php/etc/php.ini</code></pre><p>2.2.9、重启服务</p>
<pre><code>shell&gt;# pkill -9 php-fpm
shell&gt;# service php-fpm start</code></pre><p>2.2.10、查看是否开启成功</p>
<p>六、PHP 操作 RabbitMQ</p>
<p>1、安装 composer</p>
<p>学习目标：掌握composer安装与使用</p>
<p>概述</p>
<pre><code>composer 是一个 PHP 的依赖管理器，专门用于给我们安装和卸载项目、框架和插件(安装包)，类似于 Linux 操作系统的 yum 包管理器。借助 composer 我们可以找到合适的安装包和框架进行安装。</code></pre><p>官网：<a href="http://www.getcomposer.org" target="_blank" rel="noopener">http://www.getcomposer.org</a></p>
<p>中文：<a href="http://www.phpcomposer.com" target="_blank" rel="noopener">http://www.phpcomposer.com</a></p>
<p>中国镜像源：<a href="https://pkg.phpcomposer.com/" target="_blank" rel="noopener">https://pkg.phpcomposer.com/</a>  (推荐使用)</p>
<p>步骤</p>
<ol>
<li>将php设置到系统环境变量中<ol>
<li>进入php目录</li>
<li>复制路径</li>
<li>设置系统环境变量</li>
</ol>
</li>
<li>安装composer</li>
<li>将composer设置到系统环境变量中</li>
<li>切换镜像源</li>
</ol>
<p>1.1、把PHP设置到环境变量中</p>
<p>1.1.1、进入PHP目录</p>
<p>1.1.2、设置系统环境变量</p>
<p>2.1、安装</p>
<p>2.1.1、下载 Composer-Setup.exe 文件安装</p>
<p>注意：</p>
<pre><code>多得尝试几次；这种方式安装不够灵活，只能指定某个PHP使用</code></pre><p>2.1.2、使用 PHP 方式安装</p>
<p>2.1.2.1、下载 composer-setup.php</p>
<pre><code>C:\composer&gt; php -r &quot;copy(&apos;https://install.phpcomposer.com/installer&apos;, &apos;composer-setup.php&apos;);&quot;</code></pre><p>有可能报以下错误：</p>
<p>没有开启 openssl 扩展文件</p>
<p>2.1.2.2、下载  composer.phar 文件</p>
<pre><code>C:\composer&gt; php composer-setup.php</code></pre><p>2.1.2.3、删除 composer-setup.php 文件</p>
<pre><code>C:\composer&gt; php -r &quot;unlink(&apos;composer-setup.php&apos;);&quot;</code></pre><p>2.1.2.4、创建 composer.bat 文件</p>
<pre><code>C:\composer&gt; echo @php &quot;%~dp0composer.phar&quot; %* &gt; composer.bat</code></pre><p>2.1.3、切换镜像源</p>
<pre><code>C:\composer&gt; composer config -g repo.packagist composer https://packagist.phpcomposer.com</code></pre><p>2、下载RabbitMQ代码</p>
<p>学习目标：掌握使用composer下载 RabbitMQ 代码</p>
<p>概述</p>
<pre><code>官方已经把RabbitMQ代码封装好，已托管在composer包管理站点上，我们直接使用composer下载就能直接使用或在其它PHP框架下载使用。</code></pre><p>步骤</p>
<ol>
<li>创建 composer.json 文件</li>
<li>下载代码</li>
</ol>
<p>2.1、创建 composer.json 文件</p>
<pre><code>{
     &quot;require&quot;: {
      &quot;php-amqplib/php-amqplib&quot;: &quot;2.6.1&quot;
     }
 }</code></pre><p>2.2、安装MQ项目(下载代码)</p>
<pre><code>composer.json文件目录&gt; composer install</code></pre><p>3、Hello World模式</p>
<p>学习目标：掌握RabbitMQ中的Hello World模式操作</p>
<p>概述</p>
<pre><code>RabbitMQ 是一个消息代理器。它的核心原理非常简单：接收和发送消息。你可以把它想像成一个邮局：你把信件放入邮箱，邮递员就会把信件投递到你的收件人处。在这个比喻中，RabbitMQ 就扮演着邮箱、邮局以及邮递员的角色。</code></pre><p>RabbitMQ 和邮局主要的区别是，它不是用来处理纸张的，它是用来接收、存储和发送消息这种二进制数据的。</p>
<p>一般提到 RabbitMQ 和消息，都会用一些专有名词。</p>
<ul>
<li><p>生产(Producing)意思就是发送。发送消息的程序就是一个生产者(Producer)。我们一般用”P”来表示：</p>
</li>
<li><p>队列(queue)就是邮箱的名称。消息通过你的应用程序和 RabbitMQ 进行传输，它们能够只存储在一个队列(queue)中。队列(queue)没有任何限制，你要存储多少消息都可以一一基本上是一个无限的缓冲。多个生产者(Producers)能够把消息发送给同一个队列，同样，多个消费者(consumers)也能够从同一个队列(queue)中获取数据。队列可以绘制成这样(图上是队列的名称)：</p>
</li>
<li><p>消费(Consuming)和获取消息是一样的意思。一个消费者(consumer)就是一个等待获取消息的程序。我们把它绘制为”C”：</p>
</li>
</ul>
<p>步骤</p>
<ol>
<li>客户端<ol>
<li>引入相关文件</li>
<li>实例MQ对象</li>
<li>创建一个队列</li>
<li>发送消息与闭关队列(通道)与连接</li>
<li>测试代码</li>
</ol>
</li>
<li>服务端<ol>
<li>引入相关的文件</li>
<li>实例MQ对象</li>
<li>创建队列</li>
<li>接收消息</li>
</ol>
</li>
</ol>
<p>3.1、客户端</p>
<p>3.1.1、引入相关文件</p>
<pre><code>&lt;?php
    //引入自动加载类
    require_once __DIR__ . &apos;/vendor/autoload.php&apos;;
    //把类型命名空间
    use PhpAmqpLib\Connection\AMQPStreamConnection; //创建队列信息类
    use PhpAmqpLib\Message\AMQPMessage; //发送信息类</code></pre><p>3.1.2、实例MQ对象</p>
<pre><code>//实例化MQ
//设置配置信息
$config = [
    &apos;host&apos; =&gt; &apos;127.0.0.1&apos;,
    &apos;port&apos; =&gt; 5672,
    &apos;user&apos; =&gt; &apos;guest&apos;,
    &apos;pass&apos; =&gt; &apos;guest&apos;
];
extract($config); // 从数组中将变量导入到当前的符号表
$connection = new AMQPStreamConnection($host, $port, $user, $pass);
$channel = $connection-&gt;channel(); // 创建一个MQ，如果这个对象已存在，就不创建，否则相反</code></pre><p>3.1.3、创建一个队列</p>
<pre><code>//创建一个队列
$channel-&gt;queue_declare(&apos;php34&apos;,false,false,false, false);</code></pre><p>3.1.4、发送消息与关闭队列(通道)与连接</p>
<pre><code>//实例化发送消息类
$msg = new AMQPMessage(&apos;我们再次探讨MQ...&apos;);
//发送消息
$channel-&gt;basic_publish($msg, &apos;&apos;, &apos;php34&apos;);

//告诉用户发送请求成功
echo &apos;亲，你发送消息，送出...&apos;;
//关闭队列(通道)与连接
$channel-&gt;close();
$connection-&gt;close();</code></pre><p>3.2、服务端</p>
<p>3.2.1、引入相关的文件</p>
<pre><code>&lt;?php
    //引入相关文件
    require_once __DIR__ . &apos;/vendor/autoload.php&apos;; //自动加类
    use PhpAmqpLib\Connection\AMQPStreamConnection; //创建队列信息类</code></pre><p>3.2.2、实例MQ对象</p>
<pre><code>//实例化MQ
//设置配置信息
$config = [
    &apos;host&apos; =&gt; &apos;127.0.0.1&apos;,
    &apos;port&apos; =&gt; 5672,
    &apos;user&apos; =&gt; &apos;guest&apos;,
    &apos;pass&apos; =&gt; &apos;guest&apos;
];
extract($config); // 从数组中将变量导入到当前的符号表
$connection = new AMQPStreamConnection($host, $port, $user, $pass);
$channel = $connection-&gt;channel(); // 创建一个MQ对象，如果这个对象已存在，就不创建，否则相反</code></pre><p>3.2.3、创建队列</p>
<pre><code>//创建队列
$channel-&gt;queue_declare(&apos;php34&apos;, false,false, false,false);
echo &apos; 想终止程序请按 CTRL + C&apos;, &quot;\n&quot;;</code></pre><p>3.2.4、接收消息</p>
<pre><code>//接收消息
$callback = function($msg) {
    echo &quot;他(她)给您发送的消息：&quot;, $msg-&gt;body, &quot;\n&quot;;
    //处理我们业务逻辑
};

//启动队列使用者(从php34队列获取消息)
$channel-&gt;basic_consume(&apos;php34&apos;, &apos;&apos;, false, true, false, false, $callback);
//死循环
while(true) {
    $channel-&gt;wait();
}</code></pre><p>4、路由(Routing)模式</p>
<p>学习目标：掌握RabbitMQ的路由(Routing)模式</p>
<p>概述</p>
<p>交换机的类别分别为：direct、headers、fanout、topic</p>
<pre><code>我们将会使用直连交换机（direct exchange）来代替。路由的算法很简单 —— 交换机将会对绑定键（binding key）和路由键（routing key）进行精确匹配，从而确定消息该分发到哪个队列。



在这个场景中，我们可以看到直连交换机 X 和两个队列进行了绑定。第一个队列使用orange作为绑定键，第二个队列有两个绑定，一个使用black作为绑定键，另外一个使用green。</code></pre><p>这样以来，当路由键为orange的消息发布到交换机，就会被路由到队列Q1。路由键为black或者green的消息就会路由到Q2。其他的所有消息都将会被丢弃。</p>
<p>步骤</p>
<ol>
<li>客户端<ol>
<li>引入相关的文件</li>
<li>实例化MQ对象</li>
<li>创建交换机</li>
<li>发送消息与关闭队列(通道)与连接</li>
</ol>
</li>
<li>服务端<ol>
<li>引入相关的文件</li>
<li>实例化MQ对象</li>
<li>创建队列与绑定交换机</li>
<li>接收消息与关闭队列(通道)与连接</li>
</ol>
</li>
</ol>
<p>4.1、客户端</p>
<p>4.1.1、引入相关的文件</p>
<pre><code>&lt;?php
    //引入自动加载类
    require_once __DIR__ . &apos;/vendor/autoload.php&apos;;
    //引入类
    use PhpAmqpLib\Connection\AMQPStreamConnection;
    use PhpAmqpLib\Message\AMQPMessage;</code></pre><p>4.1.2、实例化MQ对象</p>
<pre><code>//实例化MQ
//设置配置信息
$config = [
    &apos;host&apos; =&gt; &apos;127.0.0.1&apos;,
    &apos;port&apos; =&gt; 5672,
    &apos;user&apos; =&gt; &apos;guest&apos;,
    &apos;pass&apos; =&gt; &apos;guest&apos;
];
extract($config); // 从数组中将变量导入到当前的符号表
$connection = new AMQPStreamConnection($host, $port, $user, $pass);
$channel = $connection-&gt;channel();// 创建一个MQ，如果这个对象已存在，就不创建，否则相反</code></pre><p>4.1.3、创建交换机</p>
<pre><code>$channel-&gt;exchange_declare(&apos;php36&apos;, &apos;direct&apos;, false, false, false);</code></pre><p>4.1.4、发送消息与关闭队列(通道)与连接</p>
<pre><code>//发送消息
$data = &quot;Hello World!&quot;;
 //实例化发送消息类
$msg = new AMQPMessage($data);
//发送消息，参数说明：$msg需要发送的消息，$e_name交换机名称，$key_1路由key
$channel-&gt;basic_publish($msg, $e_name, $key_1);
echo &quot; [x] Sent {$key_1}:&quot;, $data, &quot;\n&quot;;
//关闭队列(通道)与连接
$channel-&gt;close();
$connection-&gt;close();</code></pre><p>4.2、服务端</p>
<p>4.2.1、引入相关的文件</p>
<pre><code>&lt;?php
    //引入自动加载类
    require_once __DIR__ . &apos;/vendor/autoload.php&apos;;
    //引入类
    use PhpAmqpLib\Connection\AMQPStreamConnection;</code></pre><p>4.2.2、实例化MQ对象</p>
<pre><code>//实例化MQ
//设置配置信息
$config = [
    &apos;host&apos; =&gt; &apos;127.0.0.1&apos;,
    &apos;port&apos; =&gt; 5672,
    &apos;user&apos; =&gt; &apos;guest&apos;,
    &apos;pass&apos; =&gt; &apos;guest&apos;
];
extract($config); // 从数组中将变量导入到当前的符号表
$connection = new AMQPStreamConnection($host, $port, $user, $pass);
$channel = $connection-&gt;channel();// 创建一个MQ，如果这个对象已存在，就不创建，否则相反</code></pre><p>4.2.3、创建交换机</p>
<pre><code>//创建一个交换机，第一个参数：交换机名称；第二个参数：交换机类型
$channel-&gt;exchange_declare(&apos;php36&apos;, &apos;direct&apos;, false, false, false);</code></pre><p>4.2.4、创建队列与绑定交换机</p>
<pre><code>//创建一个队列
$channel-&gt;queue_declare(&quot;php36&quot;, false, false, true, false);
//交换机与队列绑定一个key
$channel-&gt;queue_bind(&apos;php36&apos;, &apos;php36&apos;, &apos;key_1&apos;);
echo &apos; [*] Waiting for logs. To exit press CTRL+C&apos;, &quot;\n&quot;;</code></pre><p>4.2.5、接收消息与关闭队列(通道)与连接</p>
<pre><code>//回调
$callback = function($msg){
    //实现业务逻辑代码
    echo &apos; [x] &apos;,$msg-&gt;delivery_info[&apos;routing_key&apos;], &apos;:&apos;, $msg-&gt;body, &quot;\n&quot;;
};

$channel-&gt;basic_consume(&apos;php36&apos;, &apos;&apos;, false, true, false, false, $callback);

while(true) {
    $channel-&gt;wait();
}
//关闭通道与连接
$channel-&gt;close();
$connection-&gt;close();</code></pre><p>七、推送消息模板</p>
<p>1、创建一个消息模板</p>
<pre><code>尊敬的{{user.DATA}}：

您尾号{{num.DATA}}的招行信用卡最新交易信息

交易时间：{{time.DATA}}
交易类型：{{type.DATA}}
交易金额：{{price.DATA}}

截止至{{endTime.DATA}}，您招行个人信用卡账户可用额度为{{price1.DATA}}元</code></pre><p>2、推送微信模板消息</p>
<p>获取token</p>
<pre><code>&lt;?php
    //获取token
    function getToken(){
        $url = &apos;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=wx964c28e81dfaeb1c&amp;secret=1f6ac3fd2cfdb1c33057bede01ca84e7&apos;;
        //连接Redis
        $redis = new Redis();
        //连接
        $redis-&gt;connect(&apos;127.0.0.1&apos;, 6379);
        //认证(win下不需要)
        $redis-&gt;auth(&apos;123456&apos;);
        $wx_token = $redis-&gt;get(&apos;wx_token&apos;);
        if(!$wx_token){
            //使用get方式请求
            $wx_token = file_get_contents($url);
            //存储到redis
            $redis-&gt;set(&apos;wx_token&apos;, $wx_token);
        }
        return $wx_token;
    }</code></pre><p>微信消息模板</p>
<pre><code>&lt;?php
//推送微信消息模板
    function wx_tlp(){
        /*$url = &quot;https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=&quot; . wx_token();*/
        $url = &quot;https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=23_MaAGRbHca1MdqdDmABJqO8bVAoau78AshyjTjd_33p4tPndNS2Xljq2Q0gIP4bE4liILeDJfwstpu17zDLIbqn4fMcKEUr3Fmbj26HTOEDClbpsUBAyTwlWz1gYatmT9Z2FDfVKd0y1zg2p1AHUjAGADKX&quot;;

        $array = [
            &quot;touser&quot; =&gt; &quot;oju1w1eqeLcKhxWWFSmOKmnT4tew&quot;,
            &quot;template_id&quot; =&gt; &quot;FwCMBNNeg4qBbK45C5F6V8drIxxBXdioETZaaUrI-OI&quot;,
            &quot;url&quot; =&gt; &quot;http://weixin.qq.com/download&quot;,
            &quot;topcolor&quot; =&gt; &quot;#FF0000&quot;,
            &quot;data&quot; =&gt; [
                //变量名=&gt;值
                &quot;user&quot; =&gt; [
                        &quot;value&quot; =&gt; &quot;测试&quot;,
                        &quot;color&quot; =&gt; &quot;#173177&quot;
                ],
                &quot;time&quot; =&gt; [
                    &quot;value&quot; =&gt; date(&apos;m月d日 H时i分&apos;), //date(&apos;Y-m-d H:i:s&apos;); 2019年07月15日
                    &quot;color&quot; =&gt; &quot;#173177&quot;
                ],

                &quot;type&quot; =&gt; [
                    &quot;value&quot; =&gt; &quot;消费&quot;,
                    &quot;color&quot; =&gt; &quot;#173177&quot;
                ],

                &quot;price&quot; =&gt; [
                    &quot;value&quot; =&gt; &quot;人民币0.2元&quot;,
                    &quot;color&quot; =&gt; &quot;#173177&quot;
                ]
            ]
        ];
        return json_encode( http_curl($url,&apos;post&apos;, json_encode($array)) );
    }</code></pre><p>CURL函数</p>
<pre><code>&lt;?php
    function http_curl($url,$type=&apos;get&apos;,$postdata=array(),$return_type=&apos;json&apos;){
        $ch = curl_init();
        // 设置请求相关的信息 请求方式、请求参数、请求地址、返回结果不输出
        if($type ==&apos;post&apos;){
            // 设置请求方式
            curl_setopt($ch, CURLOPT_POST, TRUE);
            // 设置请求携带的参数
            curl_setopt($ch,CURLOPT_POSTFIELDS,$postdata);
        }
        // 禁止服务端证书验证
        curl_setopt($ch,CURLOPT_SSL_VERIFYPEER ,FALSE);
        // 设置请求地址
        curl_setopt($ch,CURLOPT_URL,$url);
        // 设置请求结果不输出
        curl_setopt($ch,CURLOPT_RETURNTRANSFER,TRUE);
        $json = curl_exec($ch);
        curl_close($ch);
        // 根据返回数据的类型格式化
        if($return_type==&apos;json&apos;){
            return json_decode($json,true);
        }
        return $json;
    }</code></pre><p>八、总结</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/01/rabbtMQ/" data-id="cjysgypd70004nouy3h5up6b4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux编译安装lanmp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/01/linux编译安装lanmp/" class="article-date">
  <time datetime="2019-08-01T08:13:32.000Z" itemprop="datePublished">2019-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/01/linux编译安装lanmp/">&#39;linux编译安装lanmp&#39;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目录<br>目录<br>一、查看系统信息<br>1、主机名<br>2、服务器时间<br>3、系统内核及位数<br>4、虚拟内存<br>二、WEB环境搭建<br>1、底层软件库<br>2、源码编译安装MySQL<br>2.1、安装依赖库<br>2.2、安装MySQL<br>2.2.1、建立mysql安装目录和用户<br>2.2.2、下载mysql<br>2.2.3、解压并进入目录<br>2.2.4、进行软件配置和环境检测<br>2.2.5、编译软件并且进行安装<br>2.3、配置<br>2.3.1、使用递归，把mysql目录所有者设置为mysql这个用户<br>2.3.2、进入MySQL安装目录下<br>2.3.3、根据实际情况优化mysql配置<br>2.3.4、初始化和启动<br>2.3.4.1、初始化mysql的基本表<br>2.3.4.2、启动mysql<br>2.3.4.3、修改mysql的root密码<br>2.3.4.4、增加到开机启动<br>2.3.4.5、将mysql命令加入到环境变量里<br>2.3.4.6、如果需要对外开放 3306 端口<br>3、源码编译安装PHP<br>3.1、安装PHP<br>3.1.1、下载<br>3.1.2、解压并进入目录<br>3.1.3、将configure参数及详情解析另存为一个文件，以供学习参考用：<br>3.1.4、进行软件的配置和环境检测<br>3.1.5、编译软件并且进行安装<br>3.2、配置<br>3.2.1、复制配置文件<br>3.2.2、配置php.ini<br>3.2.3、配置 php-fpm.conf<br>3.2.4、将 php-fpm 加入服务并自动启动<br>4、源码编译安装Apache<br>4.1、安装依赖库<br>4.2、安装apache<br>4.2.1、下载apache<br>4.2.2、解压并进入目录<br>4.2.3、将configure参数及详情解析另存为一个文件以供学习参考用<br>4.2.4、进行软件的配置和环境检测<br>4.2.5、编译软件并且进行安装<br>4.3、配置<br>4.3.1、简单配置<br>4.3.2、优化虚拟主机配置<br>4.3.3、设为服务并开机自运行<br>4.4、整合PHP<br>4.4.1、修改 apache 的配置文件<br>4.4.2、重启 apache<br>4.5、开放端口<br>三、总结</p>
<p>一、查看系统信息<br>1、主机名</p>
<p>查看：</p>
<p>shell&gt;# hostname</p>
<p>永久修改：</p>
<p>centos 6修改如下：</p>
<p>shell&gt;#vim /etc/sysconfig/network</p>
<p>shell&gt;# vim /etc/hosts</p>
<p>shell&gt;#hostname Youlongit<br>centos 7 修改如下：</p>
<p>shell&gt;# hostnamectl set-hostname <hostname><br>重新链接我们Linux服务器后可发现主机名已更改</hostname></p>
<p>2、服务器时间</p>
<p>查看：shell&gt;# date</p>
<p>如果时间不正确，可以这样修改</p>
<p>shell&gt;# vim /etc/sysconfig/clock<br>内容为：</p>
<p>ZONE=”Asia/Shanghai”<br>UTC=false<br>ARC=false</p>
<p>然后再执行：</p>
<p>shell&gt;# date -s “YYYYMMDD HH:mm:ss”<br>例如：date -s “20190215 10:39:11”</p>
<p>注意： -s 的s是小写的</p>
<p>最后同步BIOS时钟，强制把系统时间写入CMOS</p>
<p>shell&gt;# clock -w<br>注意：-w的w是小写</p>
<p>3、系统内核及位数</p>
<p>查看内核：</p>
<p>shell&gt;# cat /etc/redhat-release</p>
<p>查看位数：</p>
<p>shell&gt;# uname -a</p>
<p>有x86_64这个关键字表明系统是64位的</p>
<p>4、虚拟内存</p>
<p>​    如果服务器的物理内存小于2G，而且又没有设置虚拟内存的话，在编译安装MySQL的时候，就很容易发生以下报错：</p>
<p>解决方法：增加内存或者增加虚拟内存</p>
<p>先用free指令查看内存情况</p>
<p>shell&gt;# free</p>
<p>可以看到系统还没有设置虚拟内存，添加虚拟内存的方法如下：</p>
<p>第一步：创建swap文件</p>
<p>shell&gt;# cd /var<br>shell&gt;# dd if=/dev/zero of=swapfile bs=1024 count=2048000<br>shell&gt;# mkswap swapfile<br>第二步：激活</p>
<p>shell&gt;# swapon swapfile<br>第三步：开机自动创建</p>
<p>shell&gt;# echo “/var/swapfile swap swap defaults 0 0” &gt;&gt; /etc/fstab<br>二、WEB环境搭建<br>1、底层软件库</p>
<p>运行以下命令确保底层软件库都已安装</p>
<p>shell&gt;# yum -y install gcc gcc-c++ autoconf automake zlib libxml2 libxml2-devel ncurses-devel libmcrypt libtool cmake bison make pcre pcre-devel libevent openssl openssl-devel gd-devel bzip2 bzip2-devel libcurl curl-devel python python-devel mysql-devel expat-devel<br>2、源码编译安装MySQL</p>
<p>​    <code>MySQL从5.5版本开始，通过./configure进行编译配置方式已经被取消，取而代之的是cmake工具。需要下载CMake编译器、Boost库、ncurses库和GNU分析器生成器bison这4种工具，可以用yum install的方式安装cmake、bison、boost、ncurses</code></p>
<p>MySQL二进制文件可以 <a href="http://dev.mysql.com/downloads/mysql" target="_blank" rel="noopener">http://dev.mysql.com/downloads/mysql</a> 或者 <a href="http://mirrors.sohu.com/mysql" target="_blank" rel="noopener">http://mirrors.sohu.com/mysql</a> 去下载</p>
<p>注意要下载与操作系统对应的版本及位数（32位或64位），编译安装需要下载源码版(Source Code)，此处以mysql-5.7.24tar.gz为例</p>
<p>以下 安 装中 涉 及的 几点 需 要提 前 说明 的问 题 ：</p>
<p>所有 下 载的 文件 将 保存 在 /root 目 录下</p>
<p>mysql 将以 mysql 用户 运 行， 而 且将 加入 service 开 机 自动 运 行</p>
<p>mysql 将被 安 装在 /usr/local/mysql/ 目录 下</p>
<p>mysql 默认 安 装使 用 utf8 字符集</p>
<p>mysql 的数 据 和日 志文 件 保存 在 /usr/local/mysql/data/ 目录 下</p>
<p>mysql 的配 置 文件 保存 于 /usr/local/mysql/etc/my.cnf</p>
<p>tmp</p>
<p>注意 从 MySQL 5.7.5 开 始 Boost 库是 必需 的</p>
<p>2.1、安装依赖库</p>
<p>安装 cmake 和 bison 与 ncurses</p>
<p>shell&gt;# yum -y install -y cmake bison ncurses<br>下载 Boost</p>
<p>shell&gt;# wget <a href="http://sourceforge.net/projects/boost/files/boost/1.59.0/boost_1_59_0.tar.gz" target="_blank" rel="noopener">http://sourceforge.net/projects/boost/files/boost/1.59.0/boost_1_59_0.tar.gz</a></p>
<p>解压</p>
<p>shell&gt;# tar -zxvf boost_1_59_0.tar.gz</p>
<p>移动</p>
<p>shell&gt;# mv boost_1_59_0 /usr/local/boost</p>
<p>2.2、安装MySQL</p>
<p>2.2.1、建立mysql安装目录和用户</p>
<p>在/usr/local/mysql建立【data】、【tmp】、【log】、【etc】4个目录</p>
<p>shell&gt;# mkdir -pv /usr/local/mysql</p>
<p>shell&gt;# cd /usr/local/mysql</p>
<p>shell&gt;# mkdir data tmp log etc</p>
<p>shell&gt;# groupadd mysql<br>shell&gt;# useradd -g mysql -s /usr/sbin/nologin mysql</p>
<p>2.2.2、下载mysql</p>
<p>shell&gt;# cd ~<br>shell&gt;# wget <a href="http://mirrors.sohu.com/mysql/MySQL-5.7/mysql-5.7.24.tar.gz" target="_blank" rel="noopener">http://mirrors.sohu.com/mysql/MySQL-5.7/mysql-5.7.24.tar.gz</a><br>2.2.3、解压并进入目录</p>
<p>shell&gt;# tar -zxvf mysql-5.7.24.tar.gz<br>shell&gt;# cd mysql-5.7.24</p>
<p>2.2.4、进行软件配置和环境检测</p>
<p>shell&gt;# cmake <br>-DCMAKE_INSTALL_PREFIX=/usr/local/mysql <br>-DMYSQL_UNIX_ADDR=/usr/local/mysql/tmp/mysql.sock <br>-DMYSQL_DATADIR=/usr/local/mysql/data <br>-DSYSCONFDIR=/usr/local/mysql/etc <br>-DMYSQL_USER=mysql <br>-DDEFAULT_CHARSET=utf8 <br>-DDEFAULT_COLLATION=utf8_general_ci <br>-DWITH_EXTRA_CHARSETS:STRING=utf8,gbk <br>-DWITH_DEBUG=0 <br>-DWITH_MYISAM_STORAGE_ENGINE=1 <br>-DWITH_INNOBASE_STORAGE_ENGINE=1 <br>-DWITH_ARCHIVE_STORAGE_ENGINE=1 <br>-DWITH_PARTITION_STORAGE_ENGINE=1 <br>-DENABLED_LOCAL_INFILE=1 <br>-DWITH_EMBEDDED_SERVER=1 <br>-DMYSQL_USER=mysql <br>-DWITH_BOOST=/usr/local/boost <br>-DDOWNLOAD_BOOST=1<br>以上内容的解释：</p>
<p>shell&gt;# cmake</p>
<p>​    #设置安装目录</p>
<p>​    -DCMAKE_INSTALL_PREFIX=/usr/local/mysql</p>
<p>​    #设置sock目录</p>
<p>​    -DMYSQL_UNIX_ADDR=/usr/local/mysql/tmp/mysql.sock</p>
<p>​    #设置数据库存放目录</p>
<p>​    -DMYSQL_DATADIR=/usr/local/mysql/data</p>
<p>​    #设置配置文件my.cnf存放目录</p>
<p>​    -DSYSCONFDIR=/usr/local/mysql/etc</p>
<p>​    #设置mysql的默认使用用户</p>
<p>​    -DMYSQL_USER=mysql</p>
<p>​    #设置默认字符集</p>
<p>​    -DDEFAULT_CHARSET=utf8</p>
<p>​    #默认校对规则</p>
<p>​    -DDEFAULT_COLLATION=utf8_general_ci</p>
<p>​    #指明安装额外字符集的支持</p>
<p>​    -DWITH_EXTRA_CHARSETS:STRING=utf8,gbk</p>
<p>​    #去除debug模式</p>
<p>​    -DWITH_DEBUG=0</p>
<p>​    #以下几条开启常用的引擎</p>
<p>​    -DWITH_MYISAM_STORAGE_ENGINE=1</p>
<p>​    -DWITH_INNOBASE_STORAGE_ENGINE=1</p>
<p>​    -DWITH_ARCHIVE_STORAGE_ENGINE=1</p>
<p>​    -DWITH_PARTITION_STORAGE_ENGINE=1</p>
<p>​    #Enable LOAD DATA LOCAL INFILE（default：disabled）</p>
<p>​    -DENABLED_LOCAL_INFILE=1</p>
<p>​    #使用一些字符函数的汇编版本</p>
<p>​    -DWITH_EMBEDDED_SERVER=1</p>
<p>​    -DMYSQL_USER=mysql</p>
<p>​    #5.7编译需要boost类库，指明boost的路径</p>
<p>​    -DWITH_BOOST=/usr/local/boost</p>
<p>​    #在以上路径如果没查找到boost会自动下载并解压(如事先已下载好，此句可略)</p>
<p>​    -DDOWNLOAD_BOOST=1<br>2.2.5、编译软件并且进行安装</p>
<p>shell&gt;# make &amp;&amp; make install<br>注意：</p>
<p>​    接下来可能需要耗较长时间，请耐心等待。另外如果过程中出现报错而中断，需要删除CMakeCache.txt文件后再执行 2.2.4步骤内容（没出错请不要执行以下两行指令）：</p>
<p>shell&gt;# make clean</p>
<p>shell&gt;# rm -rf CMakeCache.txt或者 shell&gt;# unlink CMakeCache.txt<br>2.3、配置</p>
<p>2.3.1、使用递归，把mysql目录所有者设置为mysql这个用户</p>
<p>shell&gt;# chown -R mysql:mysql /usr/local/mysql</p>
<p>如果 /etc/my.cnf 存在的话，请删除</p>
<p>shell&gt;# unlink /etc/my.cnf</p>
<p>2.3.2、进入MySQL安装目录下</p>
<p>shell&gt;# cd /usr/local/mysql</p>
<p>重建 my.cnf文件</p>
<p>2.3.3、根据实际情况优化mysql配置</p>
<p>shell&gt;# vim etc/my.cnf</p>
<p>大概内容如下：</p>
<h1 id="my-cnf-的示例配置"><a href="#my-cnf-的示例配置" class="headerlink" title="my.cnf 的示例配置"></a>my.cnf 的示例配置</h1><p>[client]<br>default-character-set = utf8<br>port = 3306<br>socket = /usr/local/mysql/tmp/mysql.sock<br>​<br>[mysqld]<br>datadir =/usr/local/mysql/data<br>port = 3306<br>socket = /usr/local/mysql/tmp/mysql.sock<br>user = mysql<br>symbolic-links = 0<br>pid-file = /usr/local/mysql/tmp/mysql.pid<br>​<br>explicit_defaults_for_timestamp = true<br>sql_mode = ERROR_FOR_DIVISION_BY_ZERO,NO_ZERO_DATE,NO_ZERO_IN_DATE,NO_AUTO_CREATE_USER<br>​<br>slow_query_log = on<br>slow_query_log_file = /usr/local/mysql/log/slow.log<br>long_query_time = 2<br>​<br>log_error = /usr/local/mysql/log/mysql.err<br>2.3.4、初始化和启动</p>
<p>2.3.4.1、初始化mysql的基本表</p>
<p>5.7及以上的做法：</p>
<p>–initialize会生成一个随机密码(~/.mysql_secret)，而–initialize-insecure不会生成密码</p>
<p>shell&gt;# /usr/local/mysql/bin/mysqld <br>–initialize-insecure <br>–basedir=/usr/local/mysql <br>–datadir=/usr/local/mysql/data <br>–user=mysql</p>
<p>注意：</p>
<p>​    如果初始化出错，则需要用 rm -rf /usr/local/mysql/data/* 将 mysql 的 data 目录下的文件和目录都删除，然后再重新运行以上语句<br>2.3.4.2、启动mysql</p>
<p>shell&gt;# /usr/local/mysql/bin/mysqld_safe &gt; /dev/null 2&gt;&amp;1 &amp;</p>
<p>2.3.4.3、修改mysql的root密码</p>
<p>shell&gt;# /usr/local/mysql/bin/mysqladmin -u root password 123456</p>
<p>（其中 123456 为您希望使用的密码）</p>
<p>2.3.4.4、增加到开机启动</p>
<p>先将mysqld设置为服务</p>
<p>shell&gt;# cp /usr/local/mysql/support-files/mysql.server /etc/rc.d/init.d/mysqld</p>
<p>然后将mysqld服务加入启动项：</p>
<p>shell&gt;# chkconfig –add mysqld</p>
<p>设置为自启动：</p>
<p>shell&gt;# chkconfig –level 345 mysqld on</p>
<p>–level&lt;等级代号&gt; 　指定读系统服务要在哪一个执行等级中开启或关毕。<br>等级0表示：表示关机<br>等级1表示：单用户模式<br>等级2表示：无网络连接的多用户命令行模式<br>等级3表示：有网络连接的多用户命令行模式<br>等级4表示：不可用<br>等级5表示：带图形界面的多用户模式<br>等级6表示：重新启动</p>
<p>2.3.4.5、将mysql命令加入到环境变量里</p>
<p>shell&gt;# PATH=$PATH:/usr/local/mysql/bin</p>
<p>为了重启后仍能有效：</p>
<p>shell&gt;# echo ‘PATH=$PATH:/usr/local/mysql/bin’ &gt;&gt; /root/.bashrc</p>
<p>2.3.4.6、如果需要对外开放 3306 端口</p>
<p>shell&gt;# iptables -I INPUT -p tcp –dport 3306 -j ACCEPT<br>如果 mysqld 服务正常运行中，但是执行 mysql 指令时报出以下错误：</p>
<p>解决方案就是创建一个软链接</p>
<p>shell&gt;# mkdir -pv /var/lib/mysql<br>shell&gt;# ln -s /usr/local/mysql/tmp/mysql.sock /var/lib/mysql/mysql.sock</p>
<p>3、源码编译安装PHP</p>
<p>安装PHP之前，首先要检查安装libxml2、libxml2-devvel、gd-devel</p>
<p>shell&gt;# rpm -qa | grep libxml2*<br>shell&gt;# rpm -qa | grep gd-devel*<br>如果没有安装，可以使用yum -y install命令进行安装。</p>
<p>php可以到 <a href="http://php.net/downloads.php" target="_blank" rel="noopener">http://php.net/downloads.php</a> 或者 <a href="http://mirrors.sohu.com/php/" target="_blank" rel="noopener">http://mirrors.sohu.com/php/</a> 去下 载,此处 以php-7.2.2.tar.gz为例 </p>
<p>以下安装中涉及的几点需要提前说明的问题：</p>
<p>所有下载的文件将保存在 /root 目录下</p>
<p>php 将以 FastCGI模式运行，监听 9000 端口(默认端口)</p>
<p>php 将被安装在 /usr/local/php 目录下</p>
<p>php 的配置文件保存于 /usr/local/php/etc/php.ini</p>
<p>php 的扩展库文件，如果可以的话，尽量放在 /usr/local/php/lib/php/extensions/ 目录</p>
<p>3.1、安装PHP</p>
<p>3.1.1、下载</p>
<p>shell&gt;# cd ~<br>shell&gt;# wget <a href="http://am1.php.net/distributions/php-7.2.2.tar.gz" target="_blank" rel="noopener">http://am1.php.net/distributions/php-7.2.2.tar.gz</a><br>3.1.2、解压并进入目录</p>
<p>shell&gt;# tar -zxvf php-7.2.2.tar.gz<br>shell&gt;# cd php-7.2.2<br>3.1.3、将configure参数及详情解析另存为一个文件，以供学习参考用：</p>
<p>shell&gt;# ./configure –help &gt; php_configure.txt<br>注意：</p>
<p>​    这步可以忽略<br>3.1.4、进行软件的配置和环境检测</p>
<p>shell&gt;# ./configure <br>–prefix=/usr/local/php <br>–with-config-file-path=/usr/local/php/etc <br>–enable-fpm <br>–enable-opcache <br>–with-zlib-dir <br>–with-bz2 <br>–with-libxml-dir=/usr <br>–with-gd <br>–with-freetype-dir <br>–with-jpeg-dir <br>–with-png-dir <br>–enable-mbstring <br>–with-mysql=/usr/local/mysql <br>–with-mysqli=/usr/local/mysql/bin/mysql_config <br>–with-pdo-mysql=/usr/local/mysql <br>–with-iconv <br>–disable-ipv6 <br>–enable-static <br>–enable-inline-optimization <br>–enable-sockets <br>–enable-soap <br>–with-openssl <br>–with-curl<br>以上内容的解释如下：</p>
<p>./configure \                                        # 检测环境，并生成makefile文件</p>
<p>–prefix=/usr/local/php \                            # 指定php安装目录</p>
<p>–with-config-file-path=/usr/local/php/etc \            # 设置php.ini配置文件存放的路径</p>
<p>–enable-fpm \                                    # 开启PHP-FPM，用于控制PHP-CGI的FastCGI进程</p>
<p>–enable-opcache \                                # PHP新增opcache功能</p>
<p>–with-zlib-dir \                                    # 加载zlib库</p>
<p>–with-bz2 \                                        # 加载bz2的压缩库</p>
<p>–with-libxml-dir=/usr \                            # 加载xml库</p>
<p>–with-gd \                                        # 加载gd库</p>
<p>–with-freetype-dir \                                # 加载字体库</p>
<p>–with-jpeg-dir \                                    # 加载jpeg库</p>
<p>–with-png-dir \                                    # 加载png库</p>
<p>–enable-mbstring \                                # 开启mbstring加密库</p>
<p>–with-mysql=/usr/local/mysql \                    # 加载mysql，并指定mysql基本路径</p>
<p>–with-mysqli=/usr/local/mysql/bin/mysql_config \    # 加载mysqli库，并指定mysql配置工具</p>
<p>–with-pdo-mysql=/usr/local/mysql \                # 加载pdo对mysql的支持</p>
<p>–with-iconv \                                        # 开启转换字符集</p>
<p>–disable-ipv6 \                                    # 关闭ipv6支持</p>
<p>–enable-static \                                    # 以静态方式编辑php库</p>
<p>–enable-inline-optimization \                        # 开启优化线程</p>
<p>–enable-sockets \                                # 开启sockets支持</p>
<p>–enable-soap \                                    #开启soap对web service的支持</p>
<p>–with-openssl \                                    # 开启ssl支持</p>
<p>–with-curl                                        # 模拟浏览器<br>3.1.5、编译软件并且进行安装</p>
<p>shell&gt;# make &amp;&amp; make install<br>3.2、配置</p>
<p>3.2.1、复制配置文件</p>
<p>shell&gt;# cp php.ini-production /usr/local/php/etc/php.ini</p>
<p>shell&gt;# cp sapi/fpm/init.d.php-fpm /etc/rc.d/init.d/php-fpm</p>
<p>赋予其可执行权限</p>
<p>shell&gt;# chmod +x /etc/rc.d/init.d/php-fpm</p>
<p>拷贝产生 php-fpm 的配置文件</p>
<p>shell&gt;# cd /usr/local/php/etc<br>shell&gt;# cp php-fpm.conf.default php-fpm.conf</p>
<p>3.2.2、配置php.ini</p>
<p>shell&gt;# vim php.ini<br>找到 ;date.timezone = 修改为 date.timezone = Asia/Shanghai</p>
<p>根据自己的需求调整以下选项的值</p>
<p>error_reporting = E_ALL &amp; ~E_NOTICE &amp; ~E_STRICT &amp; ~E_DEPRECATED</p>
<p>​    !1550217004054</p>
<p>display_errors = On</p>
<p>max_execution_time = 60</p>
<p>max_input_time = 60</p>
<p>memory_limit = 256M</p>
<p>post_max_size = 256M</p>
<p>upload_max_filesize = 256M</p>
<p>3.2.3、配置 php-fpm.conf</p>
<p>shell&gt;# cd /usr/local/php/etc/php-fpm.d<br>shell&gt;# cp <a href="http://www.conf.default" target="_blank" rel="noopener">www.conf.default</a> <a href="http://www.conf" target="_blank" rel="noopener">www.conf</a></p>
<p>shell&gt;# vim <a href="http://www.conf" target="_blank" rel="noopener">www.conf</a><br>找到 user = nobody 和 group = nobody，将 nobody 改成 www</p>
<p>找到 listen.owner=nobody 和 listen.group= nobody，将 nobody 改成 www</p>
<p>注意：</p>
<p>​    ==必须得先新增www用户，否则无法启动php==</p>
<p>shell&gt;# groupadd www</p>
<p>shell&gt;# useradd -g www -s /usr/sbin/nologin www<br>3.2.4、将 php-fpm 加入服务并自动启动</p>
<p>shell&gt;# service php-fpm start<br>shell&gt;# chkconfig –add php-fpm<br>shell&gt;# chkconfig –level 345 php-fpm on<br>–level&lt;等级代号&gt; 　指定读系统服务要在哪一个执行等级中开启或关毕。<br>等级0表示：表示关机<br>等级1表示：单用户模式<br>等级2表示：无网络连接的多用户命令行模式<br>等级3表示：有网络连接的多用户命令行模式<br>等级4表示：不可用<br>等级5表示：带图形界面的多用户模式<br>等级6表示：重新启动</p>
<p>4、源码编译安装Apache</p>
<p>安装apache之前，首先要先确保已安装 APR 和 APR-util</p>
<p>shell&gt;# yum -y install apr*<br>apache 可以到 <a href="http://mirrors.sohu.com/apache/" target="_blank" rel="noopener">http://mirrors.sohu.com/apache/</a> 下载，此处理以 httpd-2.4.37.tar.gz 为例</p>
<p>以下安装中涉及的几点需要提前说明的问题：</p>
<p>所有下载的文件将保存在 /root 目录下</p>
<p>apache 将以 www用户运行，而且将加入 service 开机自动运行</p>
<p>apache 将被安装在 /usr/local/httpd 目录下</p>
<p>apache 的每个网站将存放在 /mydata/wwwroot 目录下，默认网站为php33</p>
<p>apache 的配置文件保存于 /usr/local/httpd/conf/httpd.cnf</p>
<p>4.1、安装依赖库</p>
<p>安装 apr 和 apr-util</p>
<p>shell&gt;# cd ~<br>shell&gt;# wget <a href="http://archive.apache.org/dist/apr/apr-1.4.8.tar.gz" target="_blank" rel="noopener">http://archive.apache.org/dist/apr/apr-1.4.8.tar.gz</a><br>shell&gt;# mkdir /usr/local/apr</p>
<p>shell&gt;# tar -zxf apr-1.4.8.tar.gz<br>shell&gt;# cd apr-1.4.8<br>shell&gt;# ./configure –prefix=/usr/local/apr<br>shell&gt;# make &amp;&amp; make install</p>
<p>shell&gt;# cd ~<br>shell&gt;# wget <a href="http://archive.apache.org/dist/apr/apr-util-1.5.2.tar.gz" target="_blank" rel="noopener">http://archive.apache.org/dist/apr/apr-util-1.5.2.tar.gz</a><br>shell&gt;# mkdir /usr/local/apr-util<br>shell&gt;# tar -zxf apr-util-1.5.2.tar.gz<br>shell&gt;# cd apr-util-1.5.2<br>shell&gt;# ./configure –prefix=/usr/local/apr-util –with-apr=/usr/local/apr/bin/apr-1-config<br>shell&gt;# make &amp;&amp; make install<br>4.2、安装apache</p>
<p>4.2.1、下载apache</p>
<p>shell&gt;# cd ~<br>shell&gt;# wget <a href="http://mirrors.sohu.com/apache/httpd-2.4.37.tar.gz" target="_blank" rel="noopener">http://mirrors.sohu.com/apache/httpd-2.4.37.tar.gz</a><br>4.2.2、解压并进入目录</p>
<p>shell&gt;# tar -zxvf httpd-2.4.37.tar.gz<br>shell&gt;# cd httpd-2.4.37<br>4.2.3、将configure参数及详情解析另存为一个文件以供学习参考用</p>
<p>shell&gt;# ./configure –help &gt; httpd_configure.txt<br>注意：</p>
<p>​    这步可以忽略<br>4.2.4、进行软件的配置和环境检测</p>
<p>shell&gt;# ./configure <br>–prefix=/usr/local/httpd <br>–enable-deflate <br>–enable-expires <br>–enable-headers <br>–enable-so <br>–enable-modules=most <br>–with-mpm=worker <br>–enable-rewrite <br>–enable-static-ab <br>–enable-ssl <br>–with-apr=/usr/local/apr <br>–with-apr-util=/usr/local/apr-util<br>以上内容解释如下：</p>
<p>4.2.5、编译软件并且进行安装</p>
<p>shell&gt;# make &amp;&amp; make install<br>4.3、配置</p>
<p>4.3.1、简单配置</p>
<p>创建网站根目录</p>
<p>shell&gt;# mkdir -pv /mydata/wwwroot</p>
<p>shell&gt;# chown www:www /mydata/wwwroot</p>
<p>shell&gt;# cd /usr/local/httpd/conf<br>开始配置</p>
<p>shell&gt;# vim httpd.conf<br>内容修改如下：</p>
<p>把</p>
<p>User daemon<br>Group daemon</p>
<p>修改以下</p>
<p>User www</p>
<p>Group www</p>
<p>把ServerName <a href="http://www.example.com:80" target="_blank" rel="noopener">www.example.com:80</a> 前面#去除，修改成：ServerName localhost:80</p>
<p>将 DocumentRoot 以及整个 Directory 标签代码段的内容都注释掉</p>
<p>DirectoryIndex index.htm index.html index.php</p>
<p>modules/mod_rewrite.so    去除前面的 # (井号)</p>
<p>Include conf/extra/httpd-vhosts.conf    去除前面的 # (井号)</p>
<p>保存并退出</p>
<p>4.3.2、优化虚拟主机配置</p>
<p>​    httpd.conf中的每个 VirtualHost 代码段都是一个独立的虚拟主机配置。当配置多个虚拟主机时，需要在 httpd.conf 里写多个 VirtualHost 代码段，那么主配置文件就会变得重复、臃肿。所以建议，将 VirtualHost 代码段都写在另一个文件（例如：conf/extra/httpd-vhosts.conf）或多个文件（例如按客户或项目分组），然后再用 Include 指令包含进来。</p>
<p>本文档以 httpd-vhosts.conf 举例说明：</p>
<p>shell&gt;# vim /usr/local/httpd/conf/extra/httpd-vhosts.conf</p>
<p>​<br>&lt;VirtualHost *:80&gt;<br>    ServerName localhost<br>    DocumentRoot “/mydata/wwwroot/php33/www/“<br>    <directory></directory></p>
<pre><code>    Require all granted

    AllowOverride All

    Options -Indexes
&lt;/Directory&gt;</code></pre>

<p>注意：</p>
<p>​    把httpd-vhosts.conf文件的内容全部注释掉或删除<br>保存</p>
<p>4.3.3、设为服务并开机自运行</p>
<p>编辑 apachectl</p>
<p>shell&gt;# vim /usr/local/httpd/bin/apachectl<br>加入以下注释内容</p>
<h1 id="add-by-php33-2019-02-15"><a href="#add-by-php33-2019-02-15" class="headerlink" title="add by php33 2019-02-15"></a>add by php33 2019-02-15</h1><h1 id="chkconfig-2345-85-15"><a href="#chkconfig-2345-85-15" class="headerlink" title="chkconfig: 2345 85 15"></a>chkconfig: 2345 85 15</h1><h1 id="description-Activates-Deactivates-Apache-Web-Server"><a href="#description-Activates-Deactivates-Apache-Web-Server" class="headerlink" title="description: Activates/Deactivates Apache Web Server"></a>description: Activates/Deactivates Apache Web Server</h1><p>找到 [Math Processing Error]​ARGV</p>
<p>改成 [Math Processing Error]​ARGV -f /usr/local/httpd/conf/httpd.conf</p>
<p>保存并启动 apache</p>
<p>shell&gt;# /usr/local/httpd/bin/apachectl start  到这里了<br>将 httpd 设置为服务</p>
<p>shell&gt;# cp /usr/local/httpd/bin/apachectl /etc/rc.d/init.d/httpd</p>
<p>加入启动项：</p>
<p>shell&gt;# chkconfig –add httpd<br>shell&gt;# chkconfig –level 345 httpd on<br>–level&lt;等级代号&gt; 　指定读系统服务要在哪一个执行等级中开启或关毕。<br>等级0表示：表示关机<br>等级1表示：单用户模式<br>等级2表示：无网络连接的多用户命令行模式<br>等级3表示：有网络连接的多用户命令行模式<br>等级4表示：不可用<br>等级5表示：带图形界面的多用户模式<br>等级6表示：重新启动</p>
<p>4.4、整合PHP</p>
<p>4.4.1、修改 apache 的配置文件</p>
<p>shell&gt;# vim /usr/local/httpd/conf/httpd.conf<br>去掉以下两项的注释</p>
<p>LoadModule proxy_module modules/mod_proxy.so<br>LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</p>
<p>在底部加上</p>
<p>&lt;FilesMatch .php$&gt;<br>    SetHandler “proxy:fcgi://127.0.0.1:9000”<br></p>
<p>保存</p>
<p>4.4.2、重启 apache</p>
<p>shell&gt;# service httpd restart<br>4.5、开放端口</p>
<p>将 80 端口加入防火墙</p>
<p>shell&gt;# iptables -I INPUT -p tcp –dport 80 -j ACCEPT<br>添加至自启动文件</p>
<p>shell&gt;# echo ‘iptables -I INPUT -p tcp –dport 80 -j ACCEPT’ &gt;&gt; /etc/rc.d/rc.local<br>三、总结<br>Lamp源码安装</p>
<p>源码编译安装分几步走？<br>答： 3步</p>
<p>第1步： ./configure 检查系统环境，并生成 makefile 文件<br>第2步： make 读取 makefile文件，编译生成寸进制文件<br>第3步： make install 读取二进制文件，并安装系统指定目录</p>
<p>这三步顺序能调换吗？<br>答：不能</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/01/linux编译安装lanmp/" data-id="cjysgypcq0002nouyuscrye1i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux权限和yum安装lamp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/01/linux权限和yum安装lamp/" class="article-date">
  <time datetime="2019-08-01T08:12:28.000Z" itemprop="datePublished">2019-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/01/linux权限和yum安装lamp/">&#39;linux权限和yum安装lamp&#39;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目录</p>
<p>目录 目录一、昨日回顾1、知识点回顾2、学习反馈二、Linux的权限管理指令(重要)1、chgrp命令2、chown命令3、chmod命令三、bin目录和sbin目录的区别(面试)1、他们两者的区别2、whereis命令四、在linux中搭建ftp上传和下载环境1、安装ftp的服务器端工具详细步骤(rpm包含安装)3、在windows当中安装ftp的客户端五、使用yum命令搭建Lamp环境1、yum命令2、使用yum安装lamp环境六、源码编译安装Lamp环境</p>
<p>一、昨日回顾</p>
<p>1、知识点回顾</p>
<p>能够掌握 /etc/passwd 与 /etc/group 文件</p>
<p>/etc/passwd</p>
<pre><code>以冒号( : )进行分隔，以上一共可以分为7列

第1列：用户名称

第2列：用户密码（使用x占位符，真实的密码存放在/etc/shadow文件当中）

第3列：用户id

第4列：用户所在的组id

第5列：用户备注名称（类似于微信的中备注名称，在Linux当中尽量不要修改备注名）

第6列：用户的宿主(家)目录

==第7列：表示一个用户是否可以登录Linux操作系统==

==如果/sbin/nologin表示用户没有登录Linux权限==

==如果/bin/bash表示用户可以登录Linux操作系统==</code></pre><p>/etc/group</p>
<pre><code>第1列：组名称

第2列：x表示组密码

==第3列：表示组的id(组id是唯一，冲突就发生错误)==</code></pre><p>能够掌握 /etc/inittab 文件介绍的 7 种运行级别</p>
<pre><code>等级0表示：表示关机

等级1表示：单用户模式

等级2表示：无网络连接的多用户命令行(黑窗口)模式

等级3表示：有网络连接的多用户命令行(黑窗口)模式

等级4表示：不可用

等级5表示：带图形界面的多用户模式

等级6表示：重新启动</code></pre><p>能够实现网络的关闭、启动</p>
<pre><code>shell&gt;# service network stop #停用
shell&gt;# service network start #启用
shell&gt;# service network restart #重启网卡
shell&gt;# service network status #查看状态</code></pre><p>2、学习反馈</p>
<p>二、Linux的权限管理指令(重要)</p>
<p>1、chgrp命令</p>
<pre><code>命令作用:修改一个目录或者文件的所属组
命令格式:chgrp [-选项] 组名称 文件或者目录名称</code></pre><p>例子1：修改/root/php33下的b.php的所属组为php33</p>
<p>例子2：修改/root/php33下的所有文件和子目录（包括子目录中的文件）的所属组都修改为php33这个用户组</p>
<p>如果希望修改一个目录下所有的文件和子目录就需要使用递归，使用的选项是 -R</p>
<p>命令格式如下所示：</p>
<p>chgrp -R 组名称 目录</p>
<p>2、chown命令</p>
<p>命令作用：修改一个目录或者文件的拥有者</p>
<p>命令格式：chown [-选项] 拥有者的名称 文件或者目录名称</p>
<p>例子1：修改/root/php33下的b.php的拥有者改为php33</p>
<p>例子2：修改/root/php33下的所有的文件和子目录（包括 子目录中文件和目录）的拥有者都修改为php33，需要加上-R 选项</p>
<p>chown -R 拥有者的名称 /root/php33</p>
<pre><code>对于b.php等文件来说，lh520属于其他人，只有可读权限，因此lh520可以看文件的内容，但是不可以修改也不可以执行，所以这个就是其他人的权限其了作用,但root也属于其他人，那么root能不能看a.php和能不能修改a.php呢？root是至高无上的，所以可以为所欲为，因此root的用户不能随便给别人使用。</code></pre><p>3、chmod命令</p>
<p>命令作用：修改一个目录或者文件的权限操作</p>
<p>命令格式：chmod[-选项] 权限 文件或者目录名称</p>
<p>例子1：修改/root/php33/itcast 下的权限为777</p>
<p>例子2：修改/usr/local/src下的所有的文件和子目录（包括 子目录中文件和目录）的权限都修改为777</p>
<p>那么就需要加入-R选项，格式如下：chmod -R 777 /root/php33/itcast</p>
<p>如果修改为777的权限，那么lh520就可以修改b.php的内容了，因为777是其他的也可以可读可写可执行的。</p>
<p>三、bin目录和sbin目录的区别(面试)</p>
<pre><code>在Linux当中一切都是用文件和目录来表示，命令其实也不例外,那么命令存在哪个目录下呢？其实系统的自带命令一般存放在/bin和/sbin目录下。</code></pre><p>1、他们两者的区别</p>
<pre><code>/bin目录存在所有的系统指令（linux默认的自带指令），这个目录中的所有指令都可以被所有的Linux用户正常的使用，也可以被root使用。(注意：指令普通用户能使用)

/sbin目录存放的指令是只有root才可以使用的指令,s表示super的意思，因此sbin就是超级管理指令，普通用户不能执行/sbin当中的指令，这2个目录的权限是由李纳斯开发linux的时候就已经分配好。</code></pre><p>这时我们明白这2个目录的作用后其实，有一个问题产生，我们怎么知道一个指令属于bin目录还是sbin目录的指令呢？</p>
<p>2、whereis命令</p>
<p>命令格式：whereis [有效的系统命令或者软件命令]</p>
<p>命令作用：找一个命令所在的目录的详细路径</p>
<p>如果我们希望知道useradd命令在哪个目录下，运行命令如下即可：</p>
<p>说明只有超级管理员才能使用这个命令，这些命令在/usr/sbin下，/sbin目录其实用一种叫做软链接的方式链接这/usr/sbin目录下的文件。所以/usr/sbin等同于/sbin，说明了useradd的命令只有root可以使用，普通用户可以使用useradd命令吗？</p>
<p>如果我们希望知道rm命令在哪个目录下，运行命令如下即可：</p>
<pre><code>发觉rm命令在/bin目录下，所有用户都可以调用，因此rm命令就需要跟我们自定义的全校有关了，如果设置为777权限，其实所有的用户都可以删除某一个文件或者某一个目录了，因为rm是所有人都可以调用的命令。</code></pre><p>四、在linux中搭建ftp上传和下载环境</p>
<pre><code>在Linux当中默认的情况下，我们无法把本地php文件或者其他素材文件上传到linux服务器当中，我们就需要拥有ftp上传工具，ftp拥有上传和下载的功能，有ftp服务器端和ftp客户端两种。</code></pre><p>1、安装ftp的服务器端工具详细步骤(rpm包含安装)</p>
<p>第1步：使用wget下载vsftpd.*rpm文件</p>
<pre><code>shell&gt;# yum -y install vsftp

shell&gt;# wget http://rpmfind.net/linux/centos/6.10/os/x86_64/Packages/vsftpd-2.2.2-24.el6.x86_64.rpm</code></pre><p>有可能报以下错误信息：</p>
<p>注意：</p>
<pre><code>上图所报的错误是因为没有安装wget指令，使用yum -y installl wget安装即可。</code></pre><p>第2步：使用rpm -ivh 执行vsftpd的安装，效果如下所示</p>
<pre><code>shell&gt;# rpm -ivh vsftpd-2.2.2-24.el6.x86_64.rpm</code></pre><p>注意：</p>
<pre><code>==这时就已经安装成功，成功后，必须确保 Linux 防火墙处于关闭的状态，同时要启动 vsftpd 的服务器进程，并且把 vsftpd 加入开机启动脚本当中。==</code></pre><p>第3步：把vsftpd的服务进程开启，并且加入开机启动脚本当中，执行如下</p>
<pre><code>shell&gt;# service vsftpd start    #启动
shell&gt;# service vsftpd stop        #停止
shell&gt;# service vsftpd status    #查看状态
shell&gt;# service vsftpd restart    #重启
shell&gt;# chkconfig vsftpd on        #加入系统，开机自动启用</code></pre><p>注意：阿里云(ESC)服务器是无法使用FTP=</p>
<p>3、在windows当中安装ftp的客户端</p>
<p>推荐使用 FileZilla 这个软件，默认的情况下是免费使用，并且无需安装</p>
<p>完成后，就会出现以下界面：</p>
<p>注意：</p>
<pre><code>Linux系统中使用ftp链接服务器时不能使用root用户，只能使用变通用户登陆，默认只能访问到自己的家(宿主)目录。普通用户默认只把文件上传自己家目录，如果上传到/usr/local/src目录，需要设置权限，使用：shell&gt;# chmod -R 777 /usr/local/src</code></pre><p>五、使用yum命令搭建Lamp环境</p>
<p>1、yum命令</p>
<pre><code>yum 是一个在线安装的命令，这个命令不是李纳斯发明的，而是 Red Hat 公司提供给用户的一个服务，在早期的版本当中 Red Hat 公司对yum命令的使用是进行收费的，但是在 CentOS 系列当中是免费提供用户使用的，但是 Red Hat 对你所安装软件下载源不进行任何的维护，所以我们有时需要自己配置yum的下载源。

yum 的命令使用必须保证 linux 可以正常上网，并且yum实现安装是自动完成的，下载的同时就会安装，而且依赖关系自动解决，但是缺点就是安装的速度和下载的快慢取决网络速度，如果安装失败那么可以续安装，在阿里云，腾讯云，亚马逊云，SmartTone 云服务可以采用这种安装模式，所以我们作为 php 程序员关键也是要学好这种安装的方法。</code></pre><p>使用 yum 进行安装,命令格式如下:</p>
<p>yum -y install [不完整的包名] </p>
<p>-y选项就是跳过所有询问，凡是遇到安装的询问都会以yes方式进跳过</p>
<p>使用yum进行卸载，命令格式如下:</p>
<p>yum -y remove [不完整的包名]</p>
<p>使用yum进行更新下载源，命令格式如下:</p>
<p>yum check-update</p>
<p>2、使用yum安装lamp环境</p>
<p>Lamp的含义 = Linux + Apache(httpd) + mysql + php</p>
<pre><code>其实lamp安装当中Linux我们已经安装完成了，因此lamp的安装我们只需要安装amp即可，同时amp有一个版本的选择问题,在XX游戏公司采用的版本如下:

Apache版本为2.0 - 2.4,Centos默认安装版本就是这个版本，因为Apache2的系列是一个稳定而且成熟版本</code></pre><p>Mysql版本为5.1.73，这个版本属于数据库当中的经典版本，也是稳定且功能强大，支持读写分离等设置操作。</p>
<pre><code>PHP版本在Centos默认的情况下，安装的php5.3的版本，这个版本不利于开发因为无法运行laravel这样框架，因为laravel5.1要求php最低版本为php5.5.9，如果希望运行laravel必须安装php5.6或者以上版本，另外php5.6 比较支持 memcached 和 redis 和 mongdb 的相关操作，如果版本太低 memcached 实现不了分布式操作，因此安装lamp，php 必须安装5.6的版本，因此我们就需要更新yum的下载源

由于安装 Lamp 的过程包括安装和测试流程，笔记比较复杂和繁琐，因此我们要参考笔记为【yum安装Lamp环境/yum安装Lamp环境.md】的文档。</code></pre><p>六、源码编译安装Lamp环境</p>
<pre><code>由于安装 Lamp 的过程包括安装和测试流程，笔记比较复杂与繁琐，因此我们需要参考笔记为【源码编译安装Lamp环境/源码编译安装Lamp环境.md】</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/01/linux权限和yum安装lamp/" data-id="cjysgypbt0001nouyxv42i20o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux用户和权限" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/01/linux用户和权限/" class="article-date">
  <time datetime="2019-08-01T08:08:14.000Z" itemprop="datePublished">2019-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/01/linux用户和权限/">&#39;linux用户和权限&#39;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目录</p>
<p>目录 目录一、昨日回顾1、知识回顾2、学习反馈二、Linux内核分析1、/etc/grub.conf文件1.1、passwd命令2、/etc/inittab文件三、Linux子安全系统selinux1、什么是selinux2、分析selinux的配置文件3、关闭Selinux3.1、使用vim修改配置3.2、重启操作系统四、用户组1、用户组是什么2、与用户组相关的文件3、分析用户组文件(/etc/group文件)4、用户组相关的指令4.1、添加用户组4.2、搜索或者定位4.3、删除用户组4.4、修改用户组五、Linux的用户1、与用户相关的文件2、分析/etc/passwd用户文件3、分析/etc/shadow文件（用户密码文件）4、与用户相关的指令4.1、显示用户的相关信息4.2、显示用户的信息4.3、添加用户4.4、删除用户4.5、修改用户5、禁止用户登录操作系统5.1、禁止单个用户登录5.2、禁止多个用户登录六、文件操作的相关命令1、删除文件或者目录2、删除的灾难性和Linux删除原理3、复制命令4、移动/剪切文件七、Linux的网络配置1、IP段的查找方式和ip地址选择1.1、在windows当中使用cmd打开命令运行窗口如下所示1.2、在窗口中输入ipconfig1.3、使用ping命令，ping 192.168.82.1972、在Linux当中使用静态Ip地址2.1、查看IP地址2.2、Linux网卡配置信息文件分析2.3、网卡的服务管理命令3、使用ssh远程工具管理Linux3.1、什么是ssh3.2、使用putty连接Linux服务器3.3、使用xshell来连接Linux服务器八、Linux的防火墙机制九、Linux的文件和目录权限1、Linux的文件类型2、Linux中的权限简介3、Linux中的权限分类4、Linux的权限表达式换算方法5、Linux中的权限表达公式6、在Linux当中查看文件的权限类型十、总结</p>
<p>一、昨日回顾</p>
<p>1、知识回顾</p>
<p>能够实现VM虚拟机安装CentOS操作系统</p>
<pre><code>首先创建一个虚拟主机

然后载入光盘( .iso镜像文件)

再然后开机</code></pre><p>能够运用vim编辑器</p>
<pre><code>有几种模式？    3种，分别为：命令行模式、编辑模式、末行模式</code></pre><p>vim 文件 — 直接进到命令行模式</p>
<pre><code>复制一行：yy

复制多行：ny n代表多少行 例如：复制3行，3y

粘贴：p

想去文件末尾：G

想去文件首先：gg或 :1

删除光标所在当前行：dd

删除多行：

    nd+回车键，例如：删除6行，默认会删除7行

    ndd，例如：删除6行，默认会删除6行

撤销：u

想替换当前光标位置：r

删除光标当前位置的内容：x</code></pre><p>进入编辑模式： i a o I A O</p>
<p>退出编辑模式：esc</p>
<p>怎么进入末行模式：首先必须到命令行模式，输入冒号( : )</p>
<p>:q 退出</p>
<p>:q! 强制退出</p>
<p>:w 保存</p>
<p>:w! 强制保存</p>
<p>:wq 保存并退出</p>
<p>:wq! 强制保存并退出</p>
<p>把3行复制到4行： 3copy4</p>
<p>把第3行移到第4行：3m4</p>
<p>2、学习反馈</p>
<p>二、Linux内核分析</p>
<p>1、/etc/grub.conf文件</p>
<p>1.1、passwd命令</p>
<pre><code>Linux以安全性和稳定性在世界上自居，在Linux发明之初就在安全领域做了很多手段，其中最简单就是提供了密码的登录和密码修改的功能，在Linux系统当中无论什么用户都必须具有密码才能登录Linux操作系统。</code></pre><p>命令格式： passwd [用户名]</p>
<p>命令作用：更新或者设置用户登录的密码</p>
<p>注意</p>
<pre><code>如果你是root用户，你可以随意修改任何一个普通用户的密码，主要是编译root管理其他的用户而生的一个安全手段。</code></pre><p>2、/etc/inittab文件</p>
<pre><code>其实在linux存在多种操作界面，常见的有图形操作界面也有字符操作界面(黑窗口)，而我们的虚拟机在启动的时候选择是字符操作界面而不是图形操作界面呢？</code></pre><p>原因在于Linux有一个文件专门控制用户的登录操作界面，这个文件叫/etc/inittab文件，我们在业界当中专业的说法叫inittab文件为用户选择登录操作界面控制文件</p>
<p>分析/etc/inittab文件，使用vim打开文件，内容如下图所示：</p>
<pre><code>shell&gt;# vim /etc/inittab</code></pre><p>第18行： 0 代表Linux的关机模式,该模式如果一旦设置，那么Linux无法启动(因为开机就会关机)，所以我们不能设置该模式为Linux的模式</p>
<p>第19行：1代表Linux单用户模式，如果设置为1，那么Linux启动就马上进入单用户模式状态，一般用户运维工程师的维护系统工作当中，php程序员一般不会使用</p>
<p>第20行：2表示字符操作界面的多用户模式，这个模式没有NFS上网的功能，所以这个模式用于60年代没有互联的时候 比较多，今天在互联网的时代基本没有人使用</p>
<p>第21行：3代表功能齐全的多用户字符操作界面(俗称黑窗口界面)，真正的服务器一般都是用该模式，所以我们使用这个模式的几率在真正的开发中是100%</p>
<p>第22行：4代表自定义模式,这个模式一般是C和C++程序员用于开发嵌入式的时候使用得非常多，使用该模式需要有非常强的Linux源码分析能力和C语言能力，一般开发者不是这个专业的很少接触</p>
<p>第23行：5代表图形操作界面</p>
<p>第24行：6代表Linux重启模式，这个模式一旦设置(Linux开启就重启)，无法正常的启动，因此我们不能设置这个模式</p>
<pre><code>以上代码选择为3，代表功能齐全的字符操作界面,所以Linux启动的时候，就会进入黑窗口界面让用户进行登录，比如阿里云就会设置该模式</code></pre><p>为什么0和6这个两个模式会存在呢?(拓展知识)</p>
<pre><code>==原因是因为Linux是由Unix发展而来，而Unix最早是用于军事机密当中，产生上个世界的60年代中期(美苏冷战时期)，美国官方把Unix操作系统用于星球大战计划当中(导弹远程系统，其实这个导弹系统就会有一个自我保护和自动爆炸的功能。当中0这个模式就代表自动毁灭，6就代表自动爆炸功能，因此0和6是历史的遗留问题，最早是用于导弹系统当中。(出自于鸟哥Linux私房菜当中的介绍)，0和6其实今天被海豹特战队用于定时炸弹C4当中==</code></pre><p>三、Linux子安全系统selinux</p>
<p>1、什么是selinux</p>
<pre><code>selinux是为安全而生，但是由于selinux操作系统太安全所以只用于航天行空或者科技发射领域当中，对于php开发来说selinux是一个bug，原因selinux会阻碍ftp、composer；如果开启selinux使用，php操作sphinx、redis、memcache、mongdb会导致获取数据失败，因此我们需要把selinux关闭掉</code></pre><p>2、分析selinux的配置文件</p>
<pre><code>任何一台服务器如果系统进行php或者java的开发，就必须关闭centos的selinux，首先如果希望知道selinux如何关闭,其实我们可以看看阿里云的配置跟我们有什么不一样，于是我们可以使用vim打开selinux的配置文件(/etc/selinux/config)如下所示：

shell&gt;# vim /etc/selinux/config</code></pre><p>3、关闭Selinux</p>
<p>3.1、使用vim修改配置</p>
<p>把SELINUX修改为disabled,表示关闭,保存并退出(:x)</p>
<p>注意：</p>
<pre><code>==修改selinux必须重启,否则无法生效==</code></pre><p>3.2、重启操作系统</p>
<p>四、用户组</p>
<p>1、用户组是什么</p>
<pre><code>在Linux操作系统当中，Linux是一个多用户，多任务的操作系统，Linux为了方便的管理用户，所以Linux把对应的很多用户都进行归组，任何一个用户在Linux当中都必须存在于一个用户组当中，否则会导致很多软件无法正常的启动，比如mysql软件如果要启动，就必须要有一个mysql的用户和用户组，用户和用户组其实就很像一个公司的架构，如下所示：



在Linux操作系统当中，Linux把一切的东西都当成目录和文件来对待，那么用户和用户组有没有相关的文件呢？这个答案是肯定的，用户和用户组在Linux当中也被当成文件来对待。</code></pre><p>2、与用户组相关的文件</p>
<p>用户组文件：/etc/group文件</p>
<p>用户组密码文件：/etc/gshadow文件（在Centos当中被红帽子公司忽略，因为对于开发来说这个文件没用，所以该文件了解就可以了）</p>
<p>3、分析用户组文件(/etc/group文件)</p>
<p>使用vim打开/etc/group文件，如下：</p>
<pre><code>shell&gt;# vim /etc/group</code></pre><p>打开后，内容如下所示：</p>
<p>用冒号(：)进行分隔，可以把上图分为4列：</p>
<p>第1列：组名称</p>
<p>第2列：x表示组密码（x是一个占位符，真实的密码存放在/etc/gshadow当中，但是在centos中无需关注，被弃用了）</p>
<p>第3列：表示组的id(组id是唯一，冲突就发生错误)</p>
<pre><code>==如果组id=0表示该组的名称为root，为超级管理组，这个组不能随便改名，也不能修改id的值，否则linux无法正常启动，0-499表示Linux的默认系统创建的组，称为系统用户组，500或这500以上（&gt;=500）的组id，我们称为自定义用户组，不过自定义用户组有可能是我们手动创建，也有可能是我们安装软件的时候，软件的开发者帮我们创建的==</code></pre><p>第4列：组内用户（表示附属组成员，在centos中无需理解，因为使用不上）</p>
<p>4、用户组相关的指令</p>
<p>在Linux当中我们可以通过命令对用户组进行管理，主要可以管理用户组的增删查该功能</p>
<p>4.1、添加用户组</p>
<p>命令格式：groupadd [-选项] 组名称</p>
<p>命令作用：添加用户组，一般使用该命令添加的用户组id大于或者等于500</p>
<p>案例1：添加一个名为php34的用户组</p>
<p>案例2：添加一个名为php32的用户组,id=520</p>
<p>这时如果希望自定义用户组的id，那么其命令规则如下：</p>
<pre><code>groupadd -g [id][组名]</code></pre><p>运行后的结果如下：</p>
<p>没有出现错误，就代表自定义用户组成功，使用vim查看/etc/group效果如下：</p>
<p>4.2、搜索或者定位</p>
<p>命令格式：grep 关键字 [文件的名称或者路径]</p>
<p>命令作用：搜索或者定位指定的关键字内容</p>
<p>案例1：查找/etc/group文件中id=1314的组信息</p>
<p>案例2：查找/etc/group文件中php520的组信息</p>
<p>4.3、删除用户组</p>
<p>命令格式：groupdel 组名称</p>
<p>命令作用：删除一个用户组</p>
<p>案例：删除一个名为itcast的用户组</p>
<p>注意：</p>
<pre><code>其实这个命令，只会在红帽子认证中考试的时候会使用，但是在现实开发中很少有人会删除用户组，因为删除用户组会导致用户失去所在组的依靠，导致某些软件无法正常启动，所以删除组需谨慎操作</code></pre><p>4.4、修改用户组</p>
<p>命令格式：groupmod [-选项] 组名称</p>
<p>命令作用：修改用户组的信息</p>
<p>案例1：修改php34为php33</p>
<p>如果需要修改组的名称，我们的命令格式如下：</p>
<pre><code>groupmod -n [新的名字][旧的名字]</code></pre><p>案例2：修改itcast的组Id=502</p>
<p>如果需要修改组的id，我们的命令格式如下：</p>
<pre><code>groupmod -g [id][组的名称]</code></pre><p>注意：</p>
<p>如果修改的组id已经存在，那么linux就会在修改时报错，如下所示：</p>
<p>五、Linux的用户</p>
<p>1、与用户相关的文件</p>
<p>用户文件：/etc/passwd</p>
<p>用户的密码文件：/etc/shadow</p>
<p>2、分析/etc/passwd用户文件</p>
<p>使用vim打开/etc/passwd文件，如下所示：</p>
<p>打开后的内容如下：</p>
<p>以冒号( : )进行分隔，以上一共可以分为7列</p>
<p>第1列：用户名称</p>
<p>第2列：用户密码（使用x占位符，真实的密码存放在/etc/shadow文件当中）</p>
<p>第3列：用户id</p>
<p>第4列：用户所在的组id</p>
<p>第5列：用户备注名称（类似于微信的中备注名称，在Linux当中尽量不要修改备注名）</p>
<p>第6列：用户的宿主目录</p>
<p>第7列：表示一个用户是否可以登录Linux操作系统</p>
<p>如果/sbin/nologin表示用户没有登录Linux权限</p>
<p>如果/bin/bash表示用户可以登录Linux操作系统</p>
<p>其实还有一个选项叫/sbin/halt或者/sbin/shutdown，这个其实是军事的遗留问题，一般开发用不上</p>
<p>3、分析/etc/shadow文件（用户密码文件）</p>
<p>用户密码文件我们只需记住其中2列可以了，用vim打开/etc/shadow文件如下所示：</p>
<p>打开后的内容如下：</p>
<p>用冒号( : )进行分隔，记住第1和第2列就足够了</p>
<p>第1列：用户名称</p>
<p>第2列：用户密码（是使用军事上的md5散列算法，因为linux以安全著称，所以这个Md5的加密不同于php的md5加密，一般很难被破解）</p>
<pre><code>==在密码的列中有时会出现!!的情况，这时表示当前用户没有密码，如果一个用户在linux中没有密码则无法登录Linux操作系统，但是可以被root用su命令进行随意的切换==</code></pre><p>4、与用户相关的指令</p>
<p>4.1、显示用户的相关信息</p>
<p>命令格式：id 【存在的linux用户】</p>
<p>命令作用：显示用户的相关信息</p>
<p>案例：显示root的相关信息</p>
<p>4.2、显示用户的信息</p>
<p>命令格式：groups 【存在的linux用户】</p>
<p>命令作用：以键值对【用户名=&gt;组名】来显示用户的信息</p>
<p>案例：显示root的相关信息用键值的方式进行显示</p>
<p>4.3、添加用户</p>
<p>命令格式：useradd [-选项] 用户名称</p>
<p>命令作用：自定义添加一个用户（普通用户）</p>
<p>例子1:添加一个用户叫：lisi</p>
<p>如果添加一个用户，默认会以用户名创建一个宿主目录在/home下，同时也会创建一个与用户名相同的组名称，如果下图所示：</p>
<p>例子2:添加一个用户osullivan，把osullivan的宿主目录设置/home/oshaliwen</p>
<p>如果希望在添加用户的时候为用户指定一个宿主目录,那么我们就需要使用以下命令格式</p>
<p>useradd -d [/home/宿主目录名称] 用户名</p>
<p>但是我们需要注意一个事项，当前 lisi 的这个用户没有密码，所以无法正常的登录Linux操作系统，所以添加一个用户，通常还要为该用户设置一个密码才能使得用户进入linux</p>
<p>这时切换用户，可以看到以下宿主目录信息</p>
<p>例子3：添加一个用户 long，把long归组到 lisi 当中</p>
<p>如果希望在添加用户的时候希望指定用户所在的用户组，那么我们就需要使用以下命令格式</p>
<p>useradd -g [存在的组名称] 用户名</p>
<p>4.4、删除用户</p>
<p>命令格式：userdel [-选项] 用户名</p>
<p>命令作用：删除一个用户</p>
<p>例子1：删除 long 这个用户</p>
<p>例子2:删除 osullivan 这个用户，同时删除 osullivan 的宿主目录</p>
<p>如果希望删除用户的宿主目录，就需要使用以下格式：</p>
<p>userdel -r 用户名</p>
<p>4.5、修改用户</p>
<pre><code>命令格式:usermod[-选项][用户名称]
命令作用:修改用户的相关信息</code></pre><p>例子：把用户 itcast 的修改为 dz,使用选项 -l，该选项用于修改用户的名称，格式如下:</p>
<p>usermod -l [新的名称] 用户名</p>
<p>注意：</p>
<pre><code>==如果进行了用户名的修改，其实新的用户不会被修改所在的用户组，同时也会运用原有宿主目录，用户Id也不会发生改变，这个修改用户很可能会成为一道社会中的面试题出现，所以要重点注意这个问题==</code></pre><p>shell&gt;# groupmod -n dz itcast</p>
<p>5、禁止用户登录操作系统</p>
<pre><code>有时我们在开发当中，我们需要维护计算机的硬盘或者修改配置文件的的时候，我们不希望某些用户登录到系统当中，那么我们就需要禁止用户登录，禁止用户登录Linux有以下两种模式：（1）禁止单个用户登录（2）禁止所有的普通用户登录。</code></pre><p>5.1、禁止单个用户登录</p>
<pre><code>不删除用户，也不修改用户的密码，目的是保证公司对一个用户的信任和保证一个用户的工作文件得以继续运行和保存，这时我们就需要单方面禁止用户的登录，比如说禁止用lh520登录操作</code></pre><p>第1步：添加一个叫做lh520的用户,并且确保lh520可以正常的登录</p>
<p>第2步：通过修改/etc/passwd文件禁止lh520登录</p>
<p>使用vim打开/etc/passwd文件</p>
<p>使用 :/lh520 定位到 lh520 用户信息</p>
<p>发现 lh520 的第 7 列为 /bin/bash 表示可以登录操作系统,因此我们需要把 /bin/bash 修改为 /sbin/nologin，如下图所示：</p>
<p>禁止后使用xshell登陆提示以下内容：</p>
<p>保存后，切换到 lh520 用户时提示以下信息：</p>
<p>5.2、禁止多个用户登录</p>
<pre><code>如果我们希望只有root用户可以登录Linux操作系统进行系统维护，其他普通用户都不可以进入Linux操作系统,这种情况我们就不可以一个一个用户进行修改，我们就需要批量禁止普通用户登录操作系统，那么这时我们需要怎么做呢?

这时我们的方法很简单,只需要在/etc目录底下创建一个叫nologin文件就可以禁止除了root以外所有的普通用户进入Linux操作系统,操作如下所示：</code></pre><p>创建完成,注销root用户,看看普通用户是否都不能登录</p>
<pre><code>shell&gt;# su lisi



发觉 /etc/nologin 文件生效了，所有用户都不能登录，除了 root 以外。当我们维护计算完成，那么就需要让所有普通用户都可以重新正常的登录Linux操作系统，我们就应该为所有普通用户进行解冻操作，那么这时又应该如何进行普通用户解冻操作?其实很简单，我们只需删除 /etc/nologin 文件就可以了



删除后，我们重新切换用户，看看普通用户是不是都恢复了正常的登录状态？发觉只要删除/etc/nologin文件，所有的普通用户被解冻了</code></pre><p>六、文件操作的相关命令</p>
<p>1、删除文件或者目录</p>
<pre><code>命令格式：rm [-选项][文件名称或者文件路径]
命令作用：删除文件或者目录</code></pre><p>例子1：删除/root/php33下的a.php文件</p>
<p>例子2：删除/root/php33下的b.php文件,但无需提示直接删除</p>
<p>那么如果为了完成这个例子，我们就需要使用强制删除的手段加上-f选项，-f（force）</p>
<p>如下图所示:</p>
<p>例子3：删除/root/php32下所有的文件，但不删除目录</p>
<pre><code>那么如果为了完成这个例子，我们就需要使用强制删除的手段加上-f选项，-f（force）</code></pre><p>同时在-f后面加上*，rm -f *表示删除一个目录下所有的子文件，这是一个固定的linux命令组合，我们需要永远牢记</p>
<p>例子3：删除/root/php32下所有的文件，包括子目录和文件，以及子目录中子文件和子目录</p>
<p>这时如果为了达到目的，我们就需要使用递归删除的方法，使用 -rf 选项和*</p>
<p>所以格式如下:</p>
<p>rm -rf *</p>
<p>这也是一个固定的组合</p>
<p>2、删除的灾难性和Linux删除原理</p>
<p>rm -rf * 假设这条命令在根目录（/）执行，那么就是一个毁灭性的操作，所以这条语句等同于rm -rf /，这种删除是绝对不能执行了，为什么不能执行，因为Linux的删除是粉碎性删除（删除后无法进行数据恢复，因为linux是安全著称的系统，删除是很彻底），其原理如下 所示：</p>
<pre><code>会删除文件的同时删除节点，因此没有节点，则无法恢复数据</code></pre><p>注意：</p>
<pre><code>==所以在公司当中切记不要随便在根目录下或者重要的目录下使用rm -rf *或者使用rm -rf /</code></pre><p>Linux删除是粉碎性的，但是它也 可以保证我们的重要机密文件不能被恢复。==</p>
<p>3、复制命令</p>
<pre><code>命令格式：cp [-选项][源文件或目录][目标位置]
命令作用：复制文件或者目录</code></pre><p>例子1：复制/root/php32下的a.php文件复制到cp的目录当中</p>
<p>例子2：复制/root/php32下的1.php文件复制到test的目录当中，那么会产生什么样的现象呢?</p>
<p>例子3：复制/root/php32下的1.php文件复制到cp的目录当中，并且把1.php文件修改为phpinfo.php?</p>
<p>例子4：复制/root/php32下test目录到itcast目录当中，包括test目录的子文件和子目录</p>
<p>如果需要复制的是一个目录，我们就需要使用-r进行递归复制,格式如下:</p>
<p>cp -r 目录 目标位置</p>
<p>4、移动/剪切文件</p>
<pre><code>命令格式:mv [-选项][源文件或目录][目标位置]
命令作用:移动文件或者目录</code></pre><p>例子1：移动php32/1.php到/root/itcast/long/当中</p>
<p>例子2：a.php移动/root/itcast/long/ldc.php</p>
<p>例子3：把/root/php32/test移动到/root/php32/itcast/long</p>
<p>七、Linux的网络配置</p>
<p>1、IP段的查找方式和ip地址选择</p>
<p>ip段其实是一个ip地址的前3位就是一个ip的段，同一个ip段的机器称为局域网机器。</p>
<p>IP最后那位可用只有：2~254</p>
<p>网关：192.168.82.1</p>
<p>比如现在有一个ip段位192.168.82.*，如果我们都处于这个ip段，我们俗称为62ip段，在这个段中的计算机都可以互相通信，同时也导致ip冲突的可能性发生，所以每一个计算机它的ip地址都是唯一的，所以如果你希望确定一个ip地址，首先你就需要确定ip段的同时，用以下方式去确定一个ip是否没有被别人使用：</p>
<p>1.1、在windows当中使用cmd打开命令运行窗口如下所示</p>
<p>1.2、在窗口中输入ipconfig</p>
<pre><code>如果这ip地址是62那么就代表192.168.82.62这个ip地址是已经被您的本地所使用了，因此linux是不能使用该地址的，同时我们怎么知道其他地址是否可以使用呢？比如说，我们怎么知道ip地址为192.168.82.197是否可以使用呢？</code></pre><p>1.3、使用ping命令，ping 192.168.82.197</p>
<p>结果如下所示</p>
<pre><code>如果无法访问目标主机，就代表当前ip段中，没有一个使用197ip地址的计算机，因此这个地址可以作为我们的linux服务器ip地址的静态地址。如果一个ip地址可以被ping通就会出现一下的界面，同时也代表这个ip地址不可用：</code></pre><p>2、在Linux当中使用静态Ip地址</p>
<p>2.1、查看IP地址</p>
<pre><code>命令格式:ifconfig
命令作用:显示Linux当中的ip地址和网卡信息</code></pre><p>eth0代表Linux的第1块网卡的名字</p>
<p>inet addr:192.168.82.197</p>
<p>inet6 addr:</p>
<p>表示Linux的ip地址,当前没有出现任何的ip代表当前Linux没有配置过任何的网络</p>
<p>2.2、Linux网卡配置信息文件分析</p>
<p>Linux网卡文件地址：/etc/sysconfig/network-scripts/ifcfg-eth0</p>
<p>使用vim打开该地址,如下所示：</p>
<pre><code>shell&gt;# vim /etc/sysconfig/network-scripts/ifcfg-eth0</code></pre><p>内容如下所示：</p>
<p>第1行：网卡的名字</p>
<p>第2行：Linux的物理地址</p>
<p>第3行：Linux网络类型(代表使用因特网进行网络配置)，一般不做任何的修改，如果当前是飞机上的网络跟地面通讯，这个选项其实是SocketsEthernet</p>
<p>第4行：Linux的网卡文件唯一Id</p>
<p>第5行：表示Linux启动的时候是否启动网卡配置信息，如果是no表示不启动，如果是yes表示启动，一般设置为yes</p>
<p>第6行：表示Linux的网卡是否受到NFS的安全控制，一般都是设置为yes，表示当前网络处于NFS网络安全控制当中</p>
<p>第7行：表示网卡ip地址的类型，dhcp表示当前使用的Ip地址是自动获取的，static表示使用当前的ip地址是静态,一般设置static作为静态地址方便xshell或者putty作为Linux连接管理</p>
<pre><code>但问题来了，以上这7行信息，不足以让Linux的网卡配置起效，如果希望网卡起效，我们还需要配置三个重要的选项：</code></pre><ul>
<li>IPADDR表示网卡的IP地址  IPADDR=192.168.82.197</li>
<li>NETMASK表示Linux子掩码地址  NETMASK=255.255.255.0</li>
<li>NETWORK表示网关  NETWORK=192.168.82.1</li>
</ul>
<p>因此我们可以把网卡信息的配置设置如下所示：</p>
<pre><code>DEVICE=eth0
HWADDR=00:0C:29:95:91:11
TYPE=Ethernet
UUID=bd01a1b9-bea8-4479-8730-7036b160011f
ONBOOT=yes #将no修改成yes。Linux操作系统网卡默认是不启动
NM_CONTROLLED=yes
BOOTPROTO=static
IPADDR=192.168.82.197    #IP地址
NETMASK=255.255.255.0    #子掩码
NETWORK=192.168.82.1    #网关

保存并退出(:wq)，这时其实我们修改网卡的配置信息，这时其实我们应该重启，但是不是重启Linux服务器，而是重启网卡的服务，在Linux当中网卡的服务器使用service network来表示，重启网卡使用命令：service network restart，运行结果如下所示：</code></pre><p>出现以上界面，代表我们的网卡配置没有错误，代表ip地址成功设置为linux的静态地址</p>
<p>如果使用ifconfig查看Linux网卡信息,结果如下所示：</p>
<p>2.3、网卡的服务管理命令</p>
<p>命令格式如下：</p>
<pre><code>shell&gt;# service network restart     #重启网卡
shell&gt;# service network stop     #停止网卡服务
shell&gt;# service network star     #开启网卡服务
shell&gt;# service network status     #查看网卡当前的状态</code></pre><p>3、使用ssh远程工具管理Linux</p>
<p>3.1、什么是ssh</p>
<pre><code>其实ssh是一种网络的管理协议，专门用于连接管理Linux服务器，它是众多网络协议的其中一种，网络协议有：http，https，ftp，telnet，socket。在ssh协议当中有一个重要的概念，ssh协议是一种加密传输协议，非常的安全，因此linux就采用了这种协议，这种协议的默认的端口为22。在世界上有很多专门用于管理Linux的ssh工具,这种工具主流有以下两种：putty与xshell</code></pre><p>3.2、使用putty连接Linux服务器</p>
<p>连接成功后，如下图所示：</p>
<p>3.3、使用xshell来连接Linux服务器</p>
<pre><code>xshell实际是功能非常齐全的并且对于个人和学生是免费的一款产品，安装时我们就是下一步下一步就可以完成安装，但是在安装的时候要注意选择家庭和学生免费版。安装完成,我们可以通过以下方式连接Linux</code></pre><p>第1步：通过ssh协议进行连接,连接登录方式是用户名@ip地址</p>
<p>第2步：在弹出的界面中选择接受并保存，如果是免费版其实密码无法保存的</p>
<p>登陆成功，如下图所示：</p>
<p>注意事项：</p>
<pre><code>如果我们使用版本有一些老公司，有可能使用centos5.5的，这时在centos5.5当中，其实Linux在默认的情况下是没有ssh协议的，这时如果我们遇到了这种情况，我们就需要启动ssh的协议服务，ssh服务的命令是固定，格式如下：service sshd</code></pre><p>service sshd start : 开启ssh协议</p>
<p>service sshd restart : 重启ssh协议</p>
<p>service sshd stop:停止(centos6默认开启,而centos5.5默认关闭)</p>
<p>service sshd status:查看ssh的状态</p>
<p>如果ssh服务器没有开启，那么是不可能连接linux服务器的，如下图xshell所示：</p>
<p>八、Linux的防火墙机制</p>
<pre><code>Linux默认的情况下是开启防火墙，那么如果开启了防火墙那么Linux会处于一个非常稳定和安全的状态当中，但是防火墙的默认开启会导致php无法链接数据库，也导致ftp无法链接服务器，那么这时我们就需要关闭防火墙并且把防火墙加入启动关闭脚本当中。</code></pre><p>防火墙在Linux中也是一种服务，所以固定形式为service iptables [start | restart | stop | status]，如果想知道防火墙有没有开启，那么我们可以查看： service iptables status如下所示：</p>
<p>防火墙开启状态如下：</p>
<p>防火墙关闭的状态如下：</p>
<pre><code>我们需要关闭防火墙，真正的服务器其实也是关闭了防火墙，但是这时我们的疑问是这样的；</code></pre><p>关闭了防火墙那么岂不是Linux服务器很危险？在真正的服务器中（阿里云），其实有安全组的防火墙规则（免费使用的），因此我们可以在真正的服务器中，关闭了防火墙，安全组如下所示：</p>
<pre><code>只要有安全组，就可以关闭iptables，但是我们学习的时候不可能存在安全组，因此我们直接关闭 vmware 中的 linux 的防火墙就可以了，因为我们学习的环境不存在所谓的黑客攻击行为，因此设置防火墙的关闭如下所示：</code></pre><p>但是这时问题来了：如果现在我们重启Linux，防火墙又会重新的自动开启，如下图所示：</p>
<p>这样是不是很麻烦，因为每一次开机我们就需要手动关闭。</p>
<p>问题：我们可以把防火墙加入开机关闭脚本当中吗？</p>
<p>答：可以使用chkconfig命令。</p>
<p>命令作用：把服务设置开机关闭脚本或者启动脚本</p>
<p>命令格式：chkconfig 服务器名称 [on|off]</p>
<p>on：加入开机启动脚本</p>
<p>off：加入开机关闭脚本</p>
<p>如果希望把iptables服务加入开机关闭脚本那么步骤如下：</p>
<p>重启计算机，查看脚本结果是否生效,如果加入开机关闭脚本成功，那么iptables不会重新启动了</p>
<p>CentOS7使用firewalld打开关闭防火墙与端口</p>
<pre><code>firewalld的基本使用

启动： systemctl start firewalld

关闭： systemctl stop firewalld

查看状态： systemctl status firewalld 

开机禁用  ： systemctl disable firewalld

开机启用  ： systemctl enable firewalld</code></pre><p>九、Linux的文件和目录权限</p>
<p>1、Linux的文件类型</p>
<pre><code>在Linux系统中其实林纳斯·托瓦兹最早只定义了5种类型，但在CentOS6.8中Red Hat公司把文件类型定义为6种，比原作者定义多了sock类型的文件：</code></pre><p>其中红色标记的3种是开发当中最常见的三种文件类型</p>
<p>2、Linux中的权限简介</p>
<pre><code>Linux是一个多用户多任务的操作系统而且它把一切都看成了目录和文件来对待，为了安全性Linux把这些文件和目录分配了权限。在现实开发当中，我们常常会听到运维工程师说一种这样的数字组合：777，666，755，644</code></pre><p>这些数字不是密码，而是Linux的权限</p>
<p>3、Linux中的权限分类</p>
<p>r (read),可读权限，权重值4</p>
<p>w(write),可写权限，权重值2</p>
<p>x(execute),可执行权限，权重值1</p>
<p>注意：没有权限用（-）横杠来表示，可以把没有权限的权重值当作0来对待</p>
<p>4、Linux的权限表达式换算方法</p>
<p>原则：Linux权限换算的顺序必须遵循读写执行(rwx)的顺序进行换算，不遵循该顺序表达都是无效的权限换算表达式。这个概念其实初学时非常抽象，所以日常需要通过更多的例子进行换算才能熟练和理解。</p>
<p>例子1：666 的权限表达是怎么理解的呢？</p>
<p>6 = 4 + 2 + 0 = rw-</p>
<p>6 = 4 + 2 + 0 = rw-</p>
<p>6 = 4 + 2 + 0 = rw-</p>
<p>666 = rw-rw-rw-</p>
<p>例子2：777 的权限表达是怎么理解的呢？</p>
<p>7 = 4 + 2 + 1 = rwx</p>
<p>7 = 4 + 2 + 1 = rwx</p>
<p>7 = 4 + 2 + 1 = rwx</p>
<p>777 = rwxrwxrwx</p>
<p>例子3：755 的权限表达是怎么理解的呢？</p>
<p>7 = 4 + 2 + 1 = rwx</p>
<p>5 = 4 + 0 + 1 = r-x</p>
<p>5 =4+0+1 = r-x</p>
<p>755 = rwxr-xr-x</p>
<p>例子4：644 的权限表达是怎么理解的呢？</p>
<p>6 = 4+2+0=rw-</p>
<p>4 = 4+0+0=r–</p>
<p>4 = 4+0+0=r–</p>
<p>644 = rw-r–r–</p>
<p>例子4：r-xrwx-wx的权限表达是怎么理解的呢？</p>
<p>r-x = 4 + 0 + 1 = 5</p>
<p>rwx = 4+2+1 = 7</p>
<p>-wx = 0+2+1 = 3</p>
<p>例子5：rwwrxxwwx 的权限表达是怎么理解的呢？</p>
<p>这时错误的权限表达</p>
<p>例子6：684 的权限表达是怎么理解的呢？</p>
<p>这时错误的权限表达</p>
<p>例子7：520 的权限表达是怎么理解的呢？</p>
<p>520 = r-x-w—-</p>
<p>520权限虽然是正确但是运用极少</p>
<p>5、Linux中的权限表达公式</p>
<p>Linux权限表达的公式一定是10个字符组成,格式为：文件类型 + 权限表达式</p>
<p>例子1：如果我们希望在linux中表达a.php的权限为777</p>
<p>分析a.php是一个什么文件的类型，a.php是一个普通文件，所以用-</p>
<p>777可以换算为：rwxrwxrwx</p>
<p>所有a.php表示 -rwxrwxrwx</p>
<p>例子2：如果我们希望在linux中表达/home/zhangsan/test的权限为644</p>
<p>/home/zhangsan/test是一个目录，所以其类型类型为d</p>
<p>644可以换算为：rw-r–r–</p>
<p>/home/zhangsan/test = drw-r–r–</p>
<p>例子3：如果我们希望在linux中表达/etc/grub.conf的权限为755</p>
<p>/etc/grub.conf是一个链接文件，其类型l</p>
<p>755可以换算为：rwxr-xr-x</p>
<p>/etc/grub.conf = lrwxr-xr-x</p>
<p>6、在Linux当中查看文件的权限类型</p>
<p>在Linux当中如果我们输入ls -lh就可以以人性化的方式查看文件或者目录的相关信息，如下所示：</p>
<p>按照空隔来进行分隔，那么以上可以分为7列</p>
<p>第1列（drwxr-xr-x）：表示Linux文件或者目录类型的权限，共有10位组成功，后面的.不算是一个字符，在此案例中表示文件的类型是目录权限为755</p>
<p>该列有1个特点，它一定是由10个字符组成</p>
<p>第1个字符：表示文件的类型</p>
<p>第2-4个字符：表示拥有者的权限是什么，本案例表示rwx=7，表示root用户可读可写可执行</p>
<p>第5-7个字符：表示所属组的权限是什么，本案例表示r-x=5,表示在root用户组当中的用户拥有可读可执行权限，但没有可写的权限</p>
<p>第8-10个字符：表示其他的人的权限是什么，本案例中表示r-x=5,表示既不是拥有者，也不是所属组中组内用户那么就是其他人，他们权限就是可读可执行，比如如果lisi属于php32这个用户组，那么lisi就是其他人，其权限就是可读可执行，不可写</p>
<p>第2列(4)：表示Linux中的硬链接数（调用次数），不过centos当中这个数字是不准确，所以一般人不关心</p>
<p>第3列（root）：表示文件或者目录的默认拥有者是谁，在此案例中表示图片目录的拥有者是root，在linux中默认谁创建了一个文件或者一个目录，谁就是这个目录或者文件的第1个拥有者。不过拥有者是可以改变的</p>
<p>第4列（root）：表示当前文件或者目录所在的默认用户组是哪个一个，在此案例中图片目录处于root用户组当中。用户组也是可以改变的。</p>
<p>第5列（4.0K）：表示文件或者目录的大小，不过在Linux中这个大小不一定是非常准确的，所以只有一定的参考价值，不能过分的迷信它的大小字节</p>
<p>第6列(11月  15 19:34)：文件或者目录的创建时间或者修改时间</p>
<p>第7列（test）：表示文件或者目录的名称，本案例表示目录的名称是图片</p>
<p>十、总结</p>
<p>防火墙</p>
<pre><code>service    iptables status    查看防火墙

service iptables stop 停用防火墙

service iptables start 启用防火墙

service iptables restart 重启防火墙

加入开机自动关闭防火墙

chkconfig iptables off</code></pre><p>复制文件</p>
<pre><code>cp 文件名 目标路径

例如：把 /root/php33/a.php 文件复制到 /root

cp /root/php33/a.php /root

例如：把 /root/php33/目录下所有文件复制到 /root/php

cp -r /root/php33/* /root/php</code></pre><p>删除文件</p>
<pre><code>rm 文件名称

例如：删除 /root/php33/a.php

rm /root/php33/a.php 提示用户是否确认删除

例如：删除 /root/php33/b.php，不需要提示确认信息
rm -f /root/php33/b.php

例如：删除 /root/php33目录下所有文件，不需要提示确认信息
rm -rf /root/php33</code></pre><p>移动文件/剪切</p>
<pre><code>mv 文件名 目标路径

例如：把 /root/php33目录下的c.php移动到，/root/php32

mv /root/php33/c.php /root/php32</code></pre><p>用户组</p>
<pre><code>添加用户组：groupadd 组名

删除用户组：groupdel 组名

修改用户组：groupmod -n 新组名 原先组名</code></pre><p>用户</p>
<pre><code>添加用户：useradd 用户名

删除用户：userdel 用户名

修改用户：usermod -l 新的用户名 原先用户名</code></pre><p>查看当前用户信息</p>
<pre><code>id [用户名]</code></pre><p>网络配置</p>
<pre><code>查看ip：ifconfig

vim /etc/sysconfig/network-script/ifcfg-eth0</code></pre><p>管道指令</p>
<pre><code>例如：查找一个用户名叫做 php34

grep 需要搜索内容 文件

grep php34 /etc/passwd

例如：查找php34的用户组是否存在
grep php34 /etc/group</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/01/linux用户和权限/" data-id="cjysgypdj0005nouyfbjqy05m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux系统搭建和命令的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/01/linux系统搭建和命令的使用/" class="article-date">
  <time datetime="2019-08-01T08:06:34.000Z" itemprop="datePublished">2019-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/01/linux系统搭建和命令的使用/">&#39;linux命令的使用&#39;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目录</p>
<p>目录 目录一、昨日回顾1、知识点回顾2、每日反馈二、Linux概述1、计算机资源2、操作系统类别3、Linux含义4、UNIX系统发展史5、Linux发展史(Linus)6、开源文化7、Linux特点8、Linux系统的主要产品9、CentOS特点10、Linux软件安装三、虚拟机的安装与配置1、软件配置(配置虚拟机)1.1、创建一个虚拟机1.2、选择自定义安装1.3、默认操作1.4、选择稍后安装Linux1.5、选择正确的操作系统选项1.6、为虚拟机命名和选择安装（配置）路径1.7、默认操作，选择下一步按钮即可1.8、配置内存1.9、配置网卡模式1.10、默认操作，下一步1.11、分配硬盘空间1.12、默认操作，下一步即可1.13、新添加一张网卡2、安装CentOS6.8镜像到虚拟机中2.1、选择虚拟机光驱插入镜像文件2.3、启动虚拟机2.4、出现以下界面选择第1项2.5、跳过检测(光盘)镜像2.6、选择下一步2.7、选择简体中文与选择下一步2.8、选择默认2.9、默认选择3.0、选择是3.1、默认选择3.2、设置 root 用户密码3.3、选择所有磁盘空间3.4、看到以下界面时代表安装成功四、Linux常见的目录五、Linux与Windows的区别1、盘符的区别2、大写小的区别3、操作的区别六、Linux的基本命令1、su命令2、cd命令2.1、修改网卡配置2.2、查看IP2.3、重启网卡3、pwd命令4、三个特殊的目录5、ls（list）命令5.1、直接输入ls命令5.2、使用带选项格式5.2.1、ls -l 格式5.2.2、ls -lh 格式5.2.3、ls -a 格式6、ll 命令7、关机命令7.1、直接关机7.2、shutdown命令8、reboot命令(不推荐)9、mkdir命令10、touch命令11、–help查看帮助和man帮助命令的使用11.1、–help11.2、man12、clear命令13、history命令七、使用vi / vim1、什么是vi和vim2、查检vim是否存在3、VIM打开文件的命令4、VIM的编辑模式4.1、编辑模式4.2、退出编辑模式按esc键4.3、VIM的末行模式5、VIM的命令行模式6、使用VIM其他指令7、VIM的总结八、使用rpm进行软件包的安装1、问题的产生2、Linux当中软件包3、使用rpm安装finger软件包3.1、使用rpm命令进行软件的安装，其命令格式如下所示3.2、使用finger命令查看root的信息4、使用rpm卸载finger软件包4.1、查看当前有哪些软件已经被安装4.2、使用rpm -e 来卸载九、总结</p>
<p>一、昨日回顾</p>
<p>1、知识点回顾</p>
<p>1.1、能够实现接口请求并渲染数据</p>
<p>1.1.1、接口</p>
<pre><code>创建一个对应控制器、并定义一个方法

获取数据，并返回数据(json)</code></pre><p>1.1.2、渲染数据</p>
<pre><code>&lt;block wx:for=&apos;{{变量}}&apos; wx:key=&quot;key(键值，自定义)&quot;&gt;
    ....
&lt;/block&gt;</code></pre><p>1.2、能够了解PHP接口开发</p>
<p>例如：商品接口(API)</p>
<pre><code>使用TP实现

1、新建一个api(模块名称)

2、新建一个Goods的控制器

3、定义一个方法

4、获取数据，并返回数据(json)</code></pre><p>1.3、能够实现商城首页热门商品接口请求</p>
<pre><code>商城首页--超值推荐--新品上市</code></pre><p>1.3.1、首先在 GoodsController.php 定义一个方法(Tp5)</p>
<pre><code>&lt;?php
    //...
    publuc function getHot(){
        $goods = Db::name(&apos;goods&apos;)-&gt;where(&apos;hot&apos;, 1)-&gt;select()-&gt;toArray();
        return json( [&apos;status&apos;=&gt;true, &apos;code&apos;=&gt;200, &apos;data&apos;=&gt;$goods] );
    }</code></pre><p>1.3.2、然后小程序 index.js 中调用</p>
<pre><code>Page({
    //...
    data:{
        getHot:[]
    },
    onLoad:function(){
        var _this = this;
        //发送一个请求
        wx.requser({
            url:&apos;http://127.0.0.1/api/v1/Goods/getHost&apos;,
            method:&apos;post&apos;,
            //如果给后传参，请求必须设置
            success:function(res){
                _this.setData({getHot: res.data.data});
            }
        });
    },
    //....
})</code></pre><p>1.3.3、然后小程序 index.wxml 中渲染数据</p>
<pre><code>&lt;block wx:for=&quot;{{getHot}}&quot; wx:key=&quot;key&quot;&gt;
    id:{{item.goods_id}}--goodsName:{{item.goods_name}}--price:{{itme.price}}
&lt;/block&gt;</code></pre><p>2、每日反馈</p>
<p>二、Linux概述</p>
<p>1、计算机资源</p>
<ol>
<li>硬件资源(鼠标、键盘、显示器)</li>
<li>软件资源(feiq/截图工具等)</li>
</ol>
<p>在计算机中协调软件资源与硬件资源的桥梁就是操作系统。</p>
<p>2、操作系统类别</p>
<ul>
<li>Windows(个人版市场占有率最高，其也具有服务器版W2k3/W2k8/Win2012)</li>
<li>Mac(个人版市场占有率低于Windows)</li>
<li>Linux(服务器版市场占有率最高LAMP环境)</li>
<li>Unix(服务器版市场占有率低于Linux)</li>
</ul>
<p>3、Linux含义</p>
<p>狭义Linux：由Linus(林纳斯·托瓦兹)开发的一段Linux内核代码(不足3%)</p>
<p>广义Linux：由Linux厂商开发的Linux衍生版(红帽系列、CentOS、乌班图等)</p>
<p>4、UNIX系统发展史</p>
<ul>
<li>1968年    Multics项目(通用电气、麻省理工学院、贝尔实验室)<br>1970年    UNIX诞生(贝尔实验室)<br> 1973年    用C语言重写UNIX(移植性)<br> 1975年    Bell实验室允许大学使用UNIX(免费)</li>
</ul>
<p>5、Linux发展史(Linus)</p>
<p>各个版本的发时间表：<a href="https://www.aliyun.com/jiaocheng/1381229.html" target="_blank" rel="noopener">https://www.aliyun.com/jiaocheng/1381229.html</a></p>
<ul>
<li>人物 Linus<br>1991年    0.0.1版本<br> 1992年    0.0.2版本<br> 1994年    1.0版本<br> 2003年    2.6版本</li>
</ul>
<p>6、开源文化</p>
<ul>
<li>人物 Stallman(理查德·马修·斯托曼)(AI实验室开发工程师，十大黑客)<br>1983年    GNU计划(倡导开源文化)<br> 1985年    FSF基金会(提供了对GNU计划支援)<br> 1990年    Emacs、GCC(C语言编辑器)、程序库<br> 1992年    GNU/Linux</li>
</ul>
<p>7、Linux特点</p>
<ul>
<li>开放性</li>
<li>多用户</li>
<li>多任务</li>
<li>设备独立性</li>
</ul>
<p>8、Linux系统的主要产品</p>
<ul>
<li>Red Hat Linux：红帽Linux(红帽企业版4)，CentOS(红帽免费版)</li>
<li>SuSE Linux：德国Linux</li>
<li>Debian Linux：界面比较炫</li>
<li>Red Flag Linux：红旗Linux(基于Linux内核)、麒麟Linux系统</li>
<li>Blue Point Linux：蓝点Linux</li>
</ul>
<p>9、CentOS特点</p>
<ul>
<li>安装简单</li>
<li>集成大量应用软件</li>
<li>文档丰富</li>
<li>符合UNIX和Linux的标准</li>
<li>市场占有率最高</li>
</ul>
<p>缺点：</p>
<ul>
<li>操作复杂(操作都是通过shell指令完成) </li>
<li>软件安装(成功率比较低，原生安装成功在30%左右)</li>
</ul>
<p>10、Linux软件安装</p>
<ul>
<li>.rpm：编译软件包(功能与Windows中的exe类似，yum install)</li>
<li>.tar.gz：二进制源码包(源码包)</li>
</ul>
<p>Linux系统下的软件都是通过包进行安装实现的，但是包与包之间存在依赖关系。</p>
<p>三、虚拟机的安装与配置</p>
<p>虚拟机安装：请参考资料中的《安装VMware虚拟机.doc》</p>
<p>在实际系统使用中，如果我们想在同一个电脑安装多个操作系统，就可以使用虚拟机。</p>
<p>Windows操作系统的分区格式：FAT32或NTFS格式</p>
<p>Linux操作系统的分区格式：ext3、ext4</p>
<p>虚拟机：本质就是一款软件，其可以在电脑模拟其他操作系统的运行环境</p>
<p>虚拟机：VMware虚拟机(收费)、VisualBox虚拟机</p>
<p>1、软件配置(配置虚拟机)</p>
<p>1.1、创建一个虚拟机</p>
<p>1.2、选择自定义安装</p>
<p>1.3、默认操作</p>
<p>1.4、选择稍后安装Linux</p>
<p>1.5、选择正确的操作系统选项</p>
<p>1.6、为虚拟机命名和选择安装（配置）路径</p>
<p>1.7、默认操作，选择下一步按钮即可</p>
<p>1.8、配置内存</p>
<p>1.9、配置网卡模式</p>
<p>1.10、默认操作，下一步</p>
<p>1.11、分配硬盘空间</p>
<p>1.12、默认操作，下一步即可</p>
<p>注意：目录(存放路径不能有中文)</p>
<p>1.13、新添加一张网卡</p>
<p>2、安装CentOS6.8镜像到虚拟机中</p>
<p>镜像下载地址：<a href="https://www.centos.org/download/" target="_blank" rel="noopener">https://www.centos.org/download/</a></p>
<p>2.1、选择虚拟机光驱插入镜像文件</p>
<p>注意事项如下：不能有任何中文目录</p>
<p>2.3、启动虚拟机</p>
<p>2.4、出现以下界面选择第1项</p>
<p>注意：</p>
<pre><code>ctrl+G或者单击鼠标可以进入虚拟机当中，ctrl+alt可以把鼠标退出虚拟机以外

然后回车或者等待倒数就可以进行安装了</code></pre><p>2.5、跳过检测(光盘)镜像</p>
<p>2.6、选择下一步</p>
<p>2.7、选择简体中文与选择下一步</p>
<p>2.8、选择默认</p>
<p>2.9、默认选择</p>
<p>3.0、选择是</p>
<p>3.1、默认选择</p>
<p>3.2、设置 root 用户密码</p>
<p>3.3、选择所有磁盘空间</p>
<p>3.4、看到以下界面时代表安装成功</p>
<p>四、Linux常见的目录</p>
<pre><code>Linux操作系统当中与Windows最大的区别在于Linux没有盘符(没有C盘、D盘等的说法)，因为Linux把一切都看成目录和文件(一切皆文件)，包括鼠标、磁盘Linux都把它们当成了目录和文件来对待并且存入到对应目录当中，因此学习Linux最好的方法是首先要建立一个目录结构认识，但这些不需要死记硬背</code></pre><p>以下这些目录就是我们可能会用到的目录，但是我们用到时候再去记住会比较容易理解，现在只需要建立一个概念就可以了</p>
<p>/    表示Linux的根目录，作用是存放一切Linux相关目录和文件，包括核心和非核心的</p>
<p>/boot    表示Linux启动目录和文件存在，该目录简单的可以理解为windows的C盘，如果/boot被删除或者损坏将无法正常启动Linux系统</p>
<p>/dev    表示计算机设备(硬盘、磁盘、鼠标)在Linux当中的表示目录(当中包括了设备相关驱动程序文件和设备信息文件)</p>
<p>/etc（重要）    ==表示Linux所有的系统或者软件的配置信息，所有的配置都可以在该目录中找到，是PHP程序员最常用的目录，也是我们必须记住的目录，比如mysql的配置my.cnf，apache的配置都可以在该目录中找到。==</p>
<p>/home和/root（重要）    ==表示Linux用户的房间，我们称为用户的宿主目录（台湾把该目录称为家目录），该目录主要是记录用户的相关操作隐私==</p>
<p>/media    表示镜像光盘的目录，用于安装软件时调用</p>
<p>/usr        表示Linux的软件资源目录，这个目录对于PHP程序员来说也非常重要，我们开发程序一般会使用该目录</p>
<p>五、Linux与Windows的区别</p>
<p>1、盘符的区别</p>
<ul>
<li><p>Linux没有盘符</p>
</li>
<li><p>Windows拥有盘符</p>
</li>
</ul>
<p>2、大写小的区别</p>
<ul>
<li><p>Linux严格区分大小写</p>
</li>
<li><p>windows不区分大小写</p>
</li>
</ul>
<p>3、操作的区别</p>
<ul>
<li>Windows大部分的工作是通过图形操作界面就能够完成</li>
<li>Linux大部分的工作是通过命令行来完成，安装包与包之间有依赖作用</li>
</ul>
<p>六、Linux的基本命令</p>
<pre><code>Linux 很多人认为它非常难学，原因就是因为 linux 命令据说有 17800 多个，如果你通过当当网或其他的网站进行搜索的话，你会发觉linux有一些所谓的命令大全手册让你去购买，然而我们如果购买这样手册是非常不值得的，因为 linux 的命令是贵在理解而不是死记硬背，在开发当中其实我们使用到的常用命令顶多只有 60 多个，这命令一般都是有应用场景和帮助可以查看没必要买一本命令大全。

学习 Linux 的命令必须先理解什么叫 shell，其实 shell 是一个命令的解析器，对于 linux 来说 shell 其实有很多工具，比如图形操作中的终端就是一个 shell 解析器的命令输入工具,更为强大和人性化的工具有 putty 和 xshell，我们学习之初可以先从终端的 shell 工具开始，在 linux 图形操作界面中右键选择终端打开，如下图所示：</code></pre><p>shell各项详解如下：</p>
<p>如果希望切换用户登录操作系统,那么我们应该如何切换用户,并且shell的标志会产生如何的变化呢?</p>
<p>1、su命令</p>
<p>作用：切换用户</p>
<p>格式：su [一个存在的Linux用户]</p>
<p>测试效果如下：</p>
<p>注意：</p>
<pre><code>如果当前是 root 用户切换为普通用户，那么是不需要输入任何密码的，因为 root 是超级管理员。如果当前的用户是一个普通的用户切换成为 root，那么必须输入超级管理员的密码。</code></pre><p>如果密码错误，会出现以下结果：</p>
<p>如果切换的用户不存在，那么会出现以下结果:</p>
<p>2、cd命令</p>
<p>作用：切换目录</p>
<p>格式：cd [目的目录]</p>
<p>测试效果如下：</p>
<p>思考：输入命令cd /bin和输入命令cd /usr/bin得到的shell标识结果是一样的吗？</p>
<p>得到这样效果，我们应该如何区分当前所以在的位置的详细信息？使用 pwd 命令就可以解决</p>
<p>2.1、修改网卡配置</p>
<pre><code>shell&gt;# cd /etc/sysconfig/network-scripts/
shell&gt;# vi ifcfg-eth0</code></pre><p>注意：</p>
<pre><code>按键盘 a 键，把 ONBOOT=no 修改 ONBOOT=yes，再按键盘 esc 键盘，然后输入 :wq</code></pre><p>2.2、查看IP</p>
<pre><code>shell&gt;# ifconfig</code></pre><p>2.3、重启网卡</p>
<pre><code>shell&gt;#service network restart</code></pre><p>3、pwd命令</p>
<p>作用：显示当前所在的工作目录</p>
<p>格式：pwd</p>
<p>测试效果如下：</p>
<p>4、三个特殊的目录</p>
<p>宿主目录(~)：这个目录好比用户的房间，存放着当前登录Linux系统用户的相关信息</p>
<p>上一层目录：这个目录的表示方式用 .. 或者 ../ 来表示</p>
<p>当前所在目录：这个目录用 . 或者 ./ 来表示</p>
<p>现在问题来了：如果我们当前在某一个目录当中，如果我们想知道当前目录下有什么文件或者子目录我们应该怎么做呢？</p>
<p>5、ls（list）命令</p>
<p>作用：列出目录当中的内容（目录和文件）</p>
<p>格式：ls 【-选项】【文件或目录(路径)】</p>
<p>5.1、直接输入ls命令</p>
<p>5.2、使用带选项格式</p>
<p>5.2.1、ls -l 格式</p>
<p>使用选项 l（long）显示目录下文件或者子目录的详细信息</p>
<p>虽然 ls -l 可以详细显示当前目录的内容，但是我们发觉人性化比较差，如何提高人性化的阅读方式？</p>
<p>5.2.2、ls -lh 格式</p>
<p>使用选项 -h:表示以人性化的方式显示列表</p>
<p>注意：</p>
<pre><code>==-h 选项一般很少单独使用，它是组合其他的选项共同使用的，如果单独使用 -h 选项会没有任何效果。==</code></pre><p>问题：</p>
<pre><code>在Linux操作系统中以点(.)开头的文件都是隐藏文件，我们想查看隐藏文件使用什么命令？</code></pre><p>5.2.3、ls -a 格式</p>
<p>使用选项 -a（all）：表示显示全部文件（包括隐藏文件）</p>
<p>在Linux当中隐藏文件一般是不会显示的，除非你使用-a选项，在linux隐藏文件用 . 来表示，因为 -a 表示 all 能够把隐藏文件也进行显示。</p>
<p>注意：</p>
<pre><code>==在Linux的命令中选项的顺序是不固定的，例如：ls -lha 和 ls -hla是一样的效果。==</code></pre><p>6、ll 命令</p>
<p>这个指令其实就是 ls -l 命令的简写</p>
<p>7、关机命令</p>
<p>7.1、直接关机</p>
<p>poweroff、halt（这两个其实是 unix 的关机命令）</p>
<p>注意：</p>
<pre><code>==不推荐使用，因为Linux操作是多用户操作。==</code></pre><p>7.2、shutdown命令</p>
<pre><code>作用：关机或重启
格式：shutdown [选项] [时间] [警告信息]</code></pre><p>按照规定关机，以分钟作为单位</p>
<p>命令中各选项的含义为：</p>
<p>  选项      说明<br>  -k      并不真正关机而只是发出警告信息给所有用户<br>  -r      关机后立即重新启动<br>  -h      关机后不重新启动<br>  -f      快速关机重启动时跳过 fsck<br>  -n      快速关机不经过 init 程序<br>  -c      取消一个已经运行的 shutdown  </p>
<p>例如：如果希望10分钟后关机，可以使用命令： shutdown -h 10</p>
<p>注意：ctrl+c 在 Linux 不是复制，而是终止命令的运行</p>
<p>如果希望马上关机，应该如何操作？</p>
<p>使用命令： shutdown -h 0 或者 shutdown -h now</p>
<p>回车后马上关机，运行结果如下：</p>
<p>重启操作系统</p>
<p>8、reboot命令(不推荐)</p>
<p>作用：重启操作系统</p>
<p>格式：reboot</p>
<pre><code>重启命令一般我们是用于修改配置文件之后，比如修改 selinux 的配置文件就必须重启服务器才能生效，这时就需要用到 reboot。</code></pre><p>注意：</p>
<pre><code>==使用 reboot 命令重启操作系统是没有任何提示信息，建议使用：shutdown 指令重启==</code></pre><p>9、mkdir命令</p>
<p>作用：创建目录</p>
<p>格式：mkdir 【-p】[目录名称]</p>
<p>效果如下：</p>
<p>10、touch命令</p>
<p>作用：创建一个或多个文件</p>
<p>格式：touch [一个或多个文件名]</p>
<p>效果如下：</p>
<p>11、–help查看帮助和man帮助命令的使用</p>
<p>11.1、–help</p>
<p>格式：格式: [命令] –help</p>
<p>注意：不是所有的命令都具备 –help 这个选项，例如使用 cd 命令加上 –help 就获取不了任何的帮助信息。</p>
<p>如下图所示：</p>
<p>11.2、man</p>
<p>格式：man [命令]</p>
<p>例如：可以使用 man 去查看 cd 命令的帮助，如下图所示：</p>
<p>执行后，获取的文档是全部为英文的，同时打开帮助之后，需要使用特殊的手段退出帮助</p>
<p>注意:只有英文的帮助文档,退出帮助:q</p>
<p>解决方法：</p>
<pre><code>可以通过 yum 源安装，yum -y install man

shell&gt;# yum install -y man</code></pre><p>注意：前提必须能上网</p>
<p>在职场的开发当中，如果我们进行开发我们还需要时时在身边准备一个离线的命令帮助文档</p>
<p>12、clear命令</p>
<p>作用：清除屏幕命令</p>
<p>格式：clear</p>
<p>虽然 clear 命令可以清除屏幕，但是人们在习惯中使用得很少，因为人们习惯使用快捷键来取代命令的输入，clear命令的快捷键是 ctrl + L</p>
<p>13、history命令</p>
<p>作用：显示当前登陆用户的操作历史</p>
<p>格式：history</p>
<p>效果如下：</p>
<p>注意：</p>
<pre><code>==history看到只是自己相关操作历史，如果切换用户为 itcast 那 itcast 这个用户 使用history命令只能够查看自己的相关操作==</code></pre><p>现在我们拥有了这些命令之后，其实我们可以通过命令来进行 linux 的基本操作，现在假设我们要在 /root/itcast 下编写一个叫做 phpinfo.php 的文件？那么这时我们应该如何编写 phpinfo.php这个文件呢？</p>
<p>问题来了：在linux下没有 sublime Text这样软件工具，那么我们如何在命令界面中编写 phpinfo.php 的代码呢？在 Linux 如果希望编辑文件我们可以使用 vi 或者 vim 来进行编辑操作。</p>
<p>七、使用vi / vim</p>
<p>1、什么是vi和vim</p>
<p>vi / vim是一款编辑器，它们是Linux自带编辑器。vim是vi的升级版，功能上vi和vim都是一样的。</p>
<p>vim具有语法着色的功能而vi没有，所以人们会更加喜欢使用vim。</p>
<p>2、查检vim是否存在</p>
<p>输入命令vim那么弹出以下界面就代表vim是存在的(退出，输入:q回车)</p>
<p>注意：</p>
<pre><code>输入 vim 时有可能提示以下错误</code></pre><p>shell&gt;# yum install -y vim</p>
<p>3、VIM打开文件的命令</p>
<p>命令格式：vim [打开一个或者多个文件，文件是可以存在的文件也可以是存在的文件]</p>
<p>vim如果打开一个不存在的文件，那么会在底部显示一个新文件的标识,如下图所示：</p>
<p>如果这个文件已经存在，vim打开是不会显示新文件的标识的：</p>
<p>vim打开一个不存的文件如果没有保存，这文件其实并没创建</p>
<p>注意:vim没有菜单，只有命令，跟windows编辑器不一样</p>
<p>4、VIM的编辑模式</p>
<pre><code>vim其实有所谓编辑模式，vim在打开一个文件之后其实vim处于一个命令模式的状态在等待用户输入正确的指令才能切换到编辑模式当中，如果你输入的是1111这的内容在vim的命令模式下看来这个不是一个正确的指令，所以vim什么都不会做，这时有些人认为当前是死机的状态，然而不是,这是一个等待命令输入的状态。</code></pre><p>4.1、编辑模式</p>
<p>  命令      说明<br>  i       在光标之前插入内容<br>  a       在光标之后插入内容<br>  o       在光标之下新起一行插入内容<br>  I       让光标回到行首输入内容<br>  A       让光标去到行末输入内容<br>  O       在光标之上新起一行插入内容</p>
<p>4.2、退出编辑模式按esc键</p>
<p>4.3、VIM的末行模式</p>
<p>  命令              说明<br>  :w              w是write的意思，意思是写入（保存）内容<br>  :q              退出vi/vim<br>  :wq             保存并退出<br>  :x              保存并退出，相当于是:wq的简写<br>  :q!             强制退出<br>  :w!             强制保存(写入)<br>  :wq!            强制保存并退出<br>  :set nu         设置行号<br>  :set nonu       取消行号<br>  :1              回到首行<br>  :n              去到第n行，假设去到第21行<br>  :/关键字 或 /关键字    搜索关键字<br>  :nohls          去除高亮显示                </p>
<p>注意：使用两次esc键可以退出末行模式</p>
<p>5、VIM的命令行模式</p>
<p>说明：只要键入vim打开文件就处于命令行模式</p>
<p>  命令              说明<br>  G               去到末行<br>  gg              去到首行，相当于输入:1<br>  r               replace的意思，替换光标选中的内容<br>  x               删除光标选中的内容<br>  u               撤销功能<br>  yy              复制一行<br>  ny 按上下方向键盘      复制多行<br>  p               粘贴<br>  dd              删除一行<br>  ndd 或者 nd+回车    删除n行，3dd删除3行        </p>
<p>6、使用VIM其他指令</p>
<p>使用 vim 指令打开文件时指定到行号：</p>
<p>有时候我们需要使用vim编辑多个文件，那么我可以使用以下命令进行编辑：</p>
<p>如果需要切换文件的编辑就需要使用以下命令，建议使用:w先保存文件</p>
<p>  命令       说明<br>  :next    进入下一个文件的编辑状态，该命令必须先保存当前文件才能使用<br>  :prev    进入上一个文件的编辑状态，该命令必须先保存当前文件才能使用</p>
<p>7、VIM的总结</p>
<p>八、使用rpm进行软件包的安装</p>
<p>1、问题的产生</p>
<p>在Linux当中有一个常用的指令叫finger，用于查看用户的备注信息，其命令格式如下：</p>
<pre><code>finger [存在的linux用户名]</code></pre><p>然而这时如果你直接运行这个命令结果如下所示：</p>
<p>提示命令找不到，原因就是finger这个软件不存在，如果希望使用finger这个软件的命令，我们就需要安装finger这个软件包。</p>
<p>2、Linux当中软件包</p>
<p>在Linux当中有2中软件包：</p>
<p>第 1 种软件包叫rpm包，相当于windows的.exe安装文件（一般用于linux的rpm安装和yum安装当中）</p>
<p>第 2 种软件包叫源码包，一般是使用gcc进行编译的软件，这种软件安装的难度比较高，消耗比较大，一般在php种用于安装 迅搜 软件</p>
<p>3、使用rpm安装finger软件包</p>
<p>3.1、使用rpm命令进行软件的安装，其命令格式如下所示</p>
<p>下载地址：</p>
<p><a href="http://rpmfind.net/linux/fedora/linux/development/rawhide/Everything/x86_64/os/Packages/f/finger-0.17-63.fc29.x86_64.rpm" target="_blank" rel="noopener">http://rpmfind.net/linux/fedora/linux/development/rawhide/Everything/x86_64/os/Packages/f/finger-0.17-63.fc29.x86_64.rpm</a></p>
<p>rpm -ivh [完整的rpm包名称]：</p>
<p>-i : 表示install的意思，就是安装</p>
<p>-v:表示view的意思，表示显示安装的视图</p>
<p>-h：表示以人性化的方式显示安装的视图</p>
<p>如果需要安装finger软件包，那么我们就可以rpm -ivh进行安装，包名用tab键进行补全</p>
<p>出现以上界面就代表finger软件包安装成功</p>
<p>3.2、使用finger命令查看root的信息</p>
<p>4、使用rpm卸载finger软件包</p>
<p>4.1、查看当前有哪些软件已经被安装</p>
<pre><code>命令格式：rpm -qa [文件名称]</code></pre><p>rpm -qa中q表示query，a表示all的意思</p>
<p>4.2、使用rpm -e 来卸载</p>
<pre><code>命令格式如下: rpm -e [不完整或者完整的rpm包名] --nodeps</code></pre><p>比如卸载finger软件包，那么我们可以使用如下命令：</p>
<p>如果没有出现任何的错误，那么就代表卸载成功了，这时如果再次使用</p>
<p>rpm -qa | grep finger就会发现结果如下:</p>
<p>–nodeps代表强制卸载的意思，如果一个软件包被强制卸载后，那么再次使用finger指令，那么就会出现找不命令的结果：</p>
<p>rpm的安装和卸载的步骤比较别扭，而且步骤比较复杂，所以在开发当中比如在阿里云服务其中我们可以使用yum进行替代，所以rpm安装我们只需了解就可以了，不是你学习的重点。</p>
<p>九、总结</p>
<p>常用指令：</p>
<p>su        切换用户</p>
<p>cd         切换目录</p>
<p>ls        列出当前目录所有文件(不包含隐藏文件)</p>
<pre><code>显示隐藏：ls -a</code></pre><p>pwd    查看当前所在目录</p>
<p>ll    相当于 ls -l 详细列出当前目录文件</p>
<p>mkdir    创建一个目录，递归创建例如：mkdir -p php33/it</p>
<p>touch    创建一个文件/多个文件</p>
<p>history      查看当前用户历史的记录</p>
<p>mount(挂载文件)</p>
<p>rpm </p>
<pre><code>安装：rpm -ivh rpm包文件

卸载：rpm -e rpm包文件名 --nodeps</code></pre><p>vi/vim</p>
<p>几种模式？答3种</p>
<p>命令行模式</p>
<pre><code>vim 文件名</code></pre><p>注意：使用vi/vim打开的文件，如果存储就打开，不存在就创建(必须保存之后)</p>
<p>编辑模式</p>
<pre><code>i a o I A O</code></pre><p>按键盘的上esc退出到命令行模式</p>
<p>末行模式</p>
<p>前提必须是在命令行模式才能进入末行模式</p>
<p>输入 :</p>
<p>shutdown 关机与重启</p>
<p>shutdown -h 10 提示信息</p>
<p>shutdown -r 10 提示信息</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/01/linux系统搭建和命令的使用/" data-id="cjysgypd50003nouy00h9m7wv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-nginx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/01/nginx/" class="article-date">
  <time datetime="2019-08-01T06:29:37.000Z" itemprop="datePublished">2019-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/01/nginx/">&#39;nginx&#39;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目录</p>
<p>目录 目录一、昨日回顾1、知识点回顾二、今日目标三、Nginx 简介1、什么是 Nginx2、Nginx 服务器的特点3、查看一个网站是否使用 nginx四、安装操作系统1、安装CentOS6.8镜像到虚拟机中1.1、选择虚拟机光驱插入镜像文件1.2、启动虚拟机1.3、出现以下界面选择第1项1.4、跳过检测(光盘)镜像1.5、选择下一步1.6、选择简体中文与选择下一步1.7、默认下一步1.8、默认下一步1.9、选择是1.10、默认下一步1.11、设置 root 用户密码1.12、选择所有磁盘空间1.13、看到以下界面时代表安装成功2、网络配置2.1、关闭Selinux2.2、修改Linux系统下的网卡2.2.1、ifcfg-eth0(第一张网卡配置)2.2.2、ifcfg-eth1(第二张网卡配置)2.3、关闭防火墙2.4、修改虚拟机的网卡模式2.4.1、第一张网卡2.4.2、第二张网卡2.5、设置本地网络VM1网卡IP地址(windows)2.6、重启Linux操作系统3、使用 cmder 连接Linux五、WEB环境搭建(重要)1、前期准备1.1、底层软件库1.2、虚拟内存2、安装 MySQL2.2.1、安装依赖库2.2.1.1、安装 cmake 和 bison 与 ncurses2.2.1.2、下载 Boost2.2.1.3、解压2.2.1.4、移动2.2.2、安装MySQL2.2.2.1、建立 MySQL 安装目录和用户2.2.2.2、下载 MySQL2.2.2.3、上传2.2.2.4、解压2.2.2.5、进入目录2.2.2.6、进行软件配置和环境检测2.2.2.7、编译软件并且进行安装2.2.3、配置2.2.3.1、使用递归，把 MySQL 目录所有者设置为 MySQL这个用户2.2.3.2、删除系统自带的 my.cnf 文件2.2.3.3、进入 MySQL 安装目录下2.2.3.4、根据实际情况优化 MySQL 配置2.2.3.5、初始化和启动2.2.3.5.1、初始化 MySQL 的基本表2.2.3.5.2、启动 MySQL2.2.3.5.3、修改 MySQL 的 root 密码2.2.3.5.4、增加到开机启动2.2.3.5.4、将 MySQL 命令加入到环境变量中2.2.3.5.5、如果需要对外开放 3306 端口3、安装PHP3.1、检查与安装依赖库3.1.1、检查依赖库3.1.2、安装依赖库3.2、安装 PHP3.2.1、下载3.2.2、解压3.2.3、进入目录3.2.4、将configure 参数及详情解析另存为一个文件，以供学习参考用3.2.5、进行软件的配置与环境检测3.2.6、编译软件并且进行安装3.3、配置3.3.1、复制配置文件3.3.2、配置 php.ini3.3.3、配置 php-fpm.conf3.3.4、创建用户组与用户名3.3.5、将 php-fpm 加入服务并自动启动4、安装 Nginx4.1、检查与安装依赖库4.1.1、检查依赖库4.1.2、安装依赖库4.2、安装 nginx4.2.1、创建目录4.2.2、下载  nginx4.2.3、解压4.2.4、进入目录4.2.5、将 configure 参数及详情解析另存为一个文件，以供学习参考 用4.2.6、进行软件配置和环境检测4.2.7、编译软件并且进行安装4.3、配置4.3.1、简单配置4.3.1.1、创建网站根目录4.3.1.2、开始配置4.3.2、支持 PHP4.3.3、优化虚拟主机配置4.4、nginx 管理4.4.1、启动4.4.2、重载配置文件4.4.3、停止4.4.4、通知nginx关闭服务4.4.4、安装为服务4.4.4.1、配置权限并添加到开机启动4.5、与 ThinkPHP 的整合4.6、开放端口六、网站的静态资源和 gzip 压缩1、配置如下2、重新加载七、使用缓存功能把静态资源缓存到客户端1、启动缓存功能的配置八、服务器集群(了解)九、负载均衡的分发实验(重要)1、正向代理和反向代理的原理图2、负载均衡的原理和作用3、使用 nginx 部署一个负载均衡的实验3.1、负载均衡必须要有至少 3 台服务器3.2、修改 Proxy 服务器中 nginx.conf 文件内容3.3、修改 Proxy 服务器中 vhost.conf 文件内容3.4、重新加载 nginx十、Lamp 和Lnmp 的区别1、Lamp 架构概述2、Lnmp 框架概述3、Lamp 和 Lnmp 的区别是什么十一、总结</p>
<p>一、昨日回顾</p>
<p>1、知识点回顾</p>
<p>二、今日目标</p>
<ul>
<li>能够说出 Nginx 的作用</li>
<li>能够实现 Nginx 与 php-fpm 安装</li>
<li>能够实现 Nginx 的虚拟主机配置</li>
<li>能够了解 Nginx 的缓存功能</li>
<li>能够了解 Nginx 的压缩功能</li>
<li>能够解释 session 访问失效的原因</li>
<li>能够理解 session 共享的原理</li>
</ul>
<p>三、Nginx 简介</p>
<p>官网：<a href="http://nginx.org" target="_blank" rel="noopener">http://nginx.org</a></p>
<p>中文社区：<a href="http://www.nginx.cn/doc/" target="_blank" rel="noopener">http://www.nginx.cn/doc/</a></p>
<p>淘宝：<a href="http://tengine.taobao.org/" target="_blank" rel="noopener">http://tengine.taobao.org/</a></p>
<p>1、什么是 Nginx</p>
<pre><code>Nginx(&quot;engine x&quot;) 是一个高性能的 Web 和反向代理服务器，它具有很多非常优越的特性：</code></pre><p>作为 Web 服务器：</p>
<pre><code>相比 Apache，Nginx 使用更少的资源，支持更多的并发连接，体现更高的效率，能够支持高达 50000 个并发连接数的响应，Nginx选择了 epoll and kqueue 作为开发模型。</code></pre><p>作为负载均衡服务器：</p>
<pre><code>Nginx 即可以在内部直接支持 Rails 和 PHP，也可以支持作为 HTTP 代理服务器对外进行服务。Nginx 使用 C 语言编写，不论是系统资源开销还  CPU 使用效率都比 Perlbal 要好的多。</code></pre><p>作为邮件代理服务器：</p>
<pre><code>Nginx 同时也是一个非常优秀的邮件代理服务器（最早开发这个产品的目的之一也是作为邮件代理服务器），Last.fm 描述成功并且美妙的使用经验。</code></pre><p>2、Nginx 服务器的特点</p>
<ul>
<li>热部署</li>
<li>可以高并连接</li>
<li>内存消耗低</li>
<li>处理响应请求很快</li>
</ul>
<p>3、查看一个网站是否使用 nginx</p>
<p>使用 lua 命令：curl -I -H “Accept-Encoding: gzip, deflate” “网址”</p>
<p>案例：获取元游信息这个网站的相关信息</p>
<pre><code>shell&gt;# curl -I -H &quot;Accept-Encoding: gzip, deflate&quot; &quot;http://www.yyxxgame.com&quot;</code></pre><p>其实淘宝也是使用 Nginx，只不过淘宝的工程师把 Nginx 的源代码进行了修改，他们把修改后的 Nginx 服务叫做 Tengine，是一个进阶版 Nginx</p>
<p>四、安装操作系统</p>
<p>学习目标：能够实现CentOS系统安装与网络配置</p>
<p>概述</p>
<pre><code>为什么在自己的电脑上安装VM虚拟机，而不直接在各大云服务商购买云主机？为了减少学习或开发成本与方便开发人员测试代码。</code></pre><p>步骤</p>
<ol>
<li>安装CentOS系统<ol>
<li>选择虚拟机光驱插入镜像文件</li>
<li>出现以下界面选择第1项</li>
<li>跳过检测(光盘)镜像</li>
<li>选择下一步</li>
<li>选择简体中文与选择下一步</li>
<li>默认下一步</li>
<li>默认下一步</li>
<li>选择是</li>
<li>默认下一步</li>
<li>设置 root 用户密码</li>
<li>选择所有磁盘空间</li>
<li>等待安装</li>
</ol>
</li>
<li>网络配置<ol>
<li>关闭 Selinux</li>
<li>修改Linux系统下的网卡<ol>
<li>ifcfg-eth0</li>
<li>ifcfg-eth1</li>
</ol>
</li>
<li>修改虚拟机的网卡模式<ol>
<li>第一张网卡</li>
<li>第二张网卡</li>
</ol>
</li>
<li>设置本地网络VM1网卡IP地址</li>
</ol>
</li>
</ol>
<p>1、安装CentOS6.8镜像到虚拟机中</p>
<p>镜像下载地址：<a href="https://www.centos.org/download/" target="_blank" rel="noopener">https://www.centos.org/download/</a></p>
<p>1.1、选择虚拟机光驱插入镜像文件</p>
<p>注意事项如下：不能有任何中文目录</p>
<p>1.2、启动虚拟机</p>
<p>1.3、出现以下界面选择第1项</p>
<p>注意：</p>
<pre><code>ctrl+G或者单击鼠标可以进入虚拟机当中，ctrl+alt可以把鼠标退出虚拟机以外

然后回车或者等待倒数就可以进行安装了</code></pre><p>1.4、跳过检测(光盘)镜像</p>
<p>1.5、选择下一步</p>
<p>1.6、选择简体中文与选择下一步</p>
<p>1.7、默认下一步</p>
<p>1.8、默认下一步</p>
<p>1.9、选择是</p>
<p>1.10、默认下一步</p>
<p>1.11、设置 root 用户密码</p>
<p>1.12、选择所有磁盘空间</p>
<p>1.13、看到以下界面时代表安装成功</p>
<p>2、网络配置</p>
<p>2.1、关闭Selinux</p>
<p>注意：关闭子防火墙，不关闭可能影响nginx/apache、ftp、php、memcache、redis、mognoDB</p>
<pre><code>shell&gt;# vi /etc/selinux/config</code></pre><p>2.2、修改Linux系统下的网卡</p>
<p>将第一张网卡设置为静态IP，第二张网卡设置动态IP</p>
<p>2.2.1、ifcfg-eth0(第一张网卡配置)</p>
<pre><code>IPADDR=10.10.10.11    #IP地址
NETMASK=255.255.255.0    #子掩码
NETWORK=10.10.10.1    #网关

shell&gt;# vi /etc/sysconfig/network-scripts/ifcfg-eth0</code></pre><p>2.2.2、ifcfg-eth1(第二张网卡配置)</p>
<pre><code>shell&gt;# vi /etc/sysconfig/network-scripts/ifcfg-eth1</code></pre><p>2.3、关闭防火墙</p>
<pre><code>shell&gt;# service iptables stop</code></pre><p>以上这种方式只是临时关闭防火墙，重启操作系统后防火墙又重新启动了；想永久关闭的话，就必须设置开机自动关闭防火墙操作如下：</p>
<pre><code>shell&gt;# chkconfig iptables off</code></pre><p>注意：在学习或本地测试时可以关闭防火墙，在生产环境中防火墙是必须开启的；防火墙开启后，我们需要使用到的端口必须要在防火墙中设置规则，把这个规则称为：开放端口。</p>
<p>2.4、修改虚拟机的网卡模式</p>
<p>2.4.1、第一张网卡</p>
<p>2.4.2、第二张网卡</p>
<p>2.5、设置本地网络VM1网卡IP地址(windows)</p>
<p>2.6、重启Linux操作系统</p>
<pre><code>shell&gt;# reboot</code></pre><p>3、使用 cmder 连接Linux</p>
<p>如果使用 cmder 连接Linux时，有可能会出现以下错误：</p>
<p>解决方案：</p>
<p>将保存在本地key清除即可</p>
<pre><code>shell&gt;# ssh-keygen -R ip</code></pre><p>五、WEB环境搭建(重要)</p>
<p>学习目标：了解 WEB 环境作用， WEB 环境的搭建</p>
<p>概念</p>
<pre><code>我们开发出来项目目的是为了什么？为了提供给更多用户的操作与使用，项目前期是在开发环境中运行，只能够是我们自己或同一个局域网的用户才操作；想让更多用户的操作与使用我们开发出来项目，就得把项目部署到线上(生产环境中)，前提得有一台允许外网访问的WEB，一般购买云主机默认只有一个操作系统，没有WEB服务，需要我们自己搭建WEB服务。</code></pre><p>步骤</p>
<ol>
<li>前期准备<ol>
<li>安装底层软件库(底层库)</li>
<li>虚拟内存(了解)<ol>
<li>阿里云</li>
</ol>
</li>
</ol>
</li>
<li>安装 MySQL(5.7)<ol>
<li>安装依赖库<ol>
<li>rpm(ftp安装到一半，会提示它必须要依赖某包)、yum(成功率比较高)、源码编译安装(成功率30%)</li>
<li>5.5以编译安装方式不是以 ./configure，cmake、boost依赖库(底层库)</li>
</ol>
</li>
<li>安装mysql<ol>
<li>建立一个目录</li>
<li>下载</li>
<li>解压</li>
<li>进入目录</li>
<li>进行软件配置和环境检测  ./configure (cmake) — 生成 makeFile</li>
<li>编译软件 – 读取 makeFile 文件，并生成二进制</li>
<li>进行安装</li>
</ol>
</li>
<li>配置<ol>
<li>修改目录拥有者与所属组</li>
<li>删除系统自带my.cnf</li>
<li>进入MYSQL安装目录</li>
<li>创建mysql配置文件</li>
<li>初始化和启动</li>
</ol>
</li>
</ol>
</li>
<li>安装 PHP</li>
<li>安装 Nginx</li>
</ol>
<p>1、前期准备</p>
<p>1.1、底层软件库</p>
<p>学习目标：了解底层软件库安装/更新与作用</p>
<p>概述</p>
<pre><code>Linux操作系统下，安装软件不管以哪种方式安装，安装包与安装包之间是需要依赖的，除依赖之外面，对软件包的版本也是有要求。</code></pre><p>运行以下命令确保底层软件库都已安装</p>
<pre><code>shell# yum -y install gcc gcc-c++ autoconf automake zlib libxml2 libxml2-devel ncurses-devel libmcrypt libtool cmake bison make pcre pcre-devel libevent openssl openssl-devel gd-devel bzip2 bzip2-devel libcurl curl-devel python python-devel mysql-devel expat-devel</code></pre><p>1.2、虚拟内存</p>
<p>学习目标：了解虚拟内存的作用与设置</p>
<p>概念</p>
<pre><code>源码编译安装 MySQL 对内存要求相对比较高，它需要内存2G或以上；在我们学习阶段只能购买1核1G的服务器，也想源码编译安装 MySQL哪怎么办，只能用空间换内存。</code></pre><p>如果服务器的物理内存小于2G，而且又没有设置虚拟内存的话，在编译安装MySQL的时候，就很容易发生以下报错：</p>
<p>步骤</p>
<ol>
<li>查看内存情况</li>
<li>创建swap文件</li>
<li>激活</li>
<li>设置开机自动创建</li>
</ol>
<p>解决方法：增加内存或者增加虚拟内存</p>
<p>先用free指令查看内存情况</p>
<pre><code>shell&gt;# free</code></pre><p>可以看到系统还没有设置虚拟内存，添加虚拟内存的方法如下：</p>
<p>第一步：创建swap文件</p>
<pre><code>shell&gt;# cd /var
shell&gt;# dd if=/dev/zero of=swapfile bs=1024 count=2048000
shell&gt;# mkswap swapfile</code></pre><p>第二步：激活</p>
<pre><code>shell&gt;# swapon swapfile</code></pre><p>第三步：开机自动创建</p>
<pre><code>shell&gt;# echo &quot;/var/swapfile swap swap defaults 0 0&quot; &gt;&gt; /etc/fstab</code></pre><p>例如：我要在/root 家目录创建一个txt，并写入”我是一个txt文件”</p>
<p>2、安装 MySQL</p>
<p>学习目标：了解源码编译安装 MySQL， MySQL配置</p>
<p>概述</p>
<pre><code>MySQL二进制文件可以 http://dev.mysql.com/downloads/mysql 或者 http://mirrors.sohu.com/mysql 去下载注意要下载与操作系统对应的版本及位数（32位或64位），编译安装需要下载源码版(Source Code)，此处以mysql-5.7.24tar.gz为例</code></pre><p>以下 安 装中 涉 及的 几点 需 要提 前 说明 的问 题 ：</p>
<ul>
<li>所有下载的文件将保存在 /root 目录下</li>
<li>mysql 将以 mysql 用户运 行， 而且将加入 service 开机自动运行</li>
<li>mysql 将被安装在 /usr/local/mysql/ 目录下</li>
<li>mysql 默认安装使用 utf8 字符集</li>
<li>mysql 的数据和日志文件保存在 /usr/local/mysql/data/ 目录下</li>
<li>mysql 的配置文件保存于 /usr/local/mysql/etc/my.cnf</li>
<li>mysql 的mysql.sock保存于 /usr/local/mysq/tmp/mysql.sock</li>
<li>注意 从 MySQL 5.7.5 开 始 Boost 库是 必需 的</li>
</ul>
<p>步骤</p>
<ol>
<li>安装依赖库</li>
<li>建立 MySQL 安装目录和用户</li>
<li>下载 MySQL</li>
<li>解压</li>
<li>进入目录</li>
<li>环境检测</li>
<li>编译软件</li>
<li>进行安装</li>
<li>配置MySQL</li>
</ol>
<p>2.2.1、安装依赖库</p>
<p>学习目标：了解怎么使用 yum 命令检查软件是否安装</p>
<p>概述</p>
<pre><code>`MySQL从5.5版本开始，通过./configure进行编译配置方式已经被取消，取而代之的是cmake工具。需要下载CMake编译器、Boost库、ncurses库和GNU分析器生成器bison这4种工具，可以用yum install的方式安装cmake、bison、boost、ncurses`</code></pre><p>步骤</p>
<ol>
<li>使用 yum 源安装 cmake、bison、ncurses依赖库</li>
<li>下载 Boost 依赖库</li>
<li>解压 Boost 依赖库</li>
<li>移动 Boost 依赖库到 /usr/local目录下，并重命名为 boost</li>
</ol>
<p>2.2.1.1、安装 cmake 和 bison 与 ncurses</p>
<pre><code>shell&gt;# yum -y install cmake bison ncurses</code></pre><p>2.2.1.2、下载 Boost</p>
<pre><code>shell&gt;# wget http://sourceforge.net/projects/boost/files/boost/1.59.0/boost_1_59_0.tar.gz</code></pre><p>有可能会报以下错误：</p>
<p>解决方案</p>
<pre><code>shell&gt;# yum -y install wget</code></pre><p>上传</p>
<p>2.2.1.3、解压</p>
<pre><code>shell&gt;# tar -zxvf boost_1_59_0.tar.gz</code></pre><p>2.2.1.4、移动</p>
<pre><code>shell&gt;# mv boost_1_59_0 /usr/local/boost</code></pre><p>2.2.2、安装MySQL</p>
<p>学习目标：掌握源码编译安装 MySQL</p>
<p>概述</p>
<pre><code>为什么使用源码编译安装 MySQL，不直接使用 yum 源安装 MySQL？虽然 yum 源安装也可以指定安装目录，但是默认会帮我们安装很多用不到的扩展，会占用我们磁盘空间。使用源码编译安装可以定制功能安装。</code></pre><p>步骤</p>
<ol>
<li>建立 MySQL 安装目录与用户</li>
<li>下载 MySQL</li>
<li>解压</li>
<li>进入目录</li>
<li>进行软件配置和环境检测</li>
<li>编译软件并且进行安装</li>
</ol>
<p>2.2.2.1、建立 MySQL 安装目录和用户</p>
<p>在/usr/local/mysql建立【data】、【tmp】、【log】、【etc】4个目录</p>
<pre><code>shell&gt;# mkdir -pv /usr/local/mysql</code></pre><p>进入mysql目录</p>
<pre><code>shell&gt;# cd /usr/local/mysql</code></pre><p>创建 data tmp log etc 目录</p>
<pre><code>shell&gt;# mkdir data tmp log etc</code></pre><p>创建用户组</p>
<pre><code>shell&gt;# groupadd mysql</code></pre><p>创建用户名</p>
<pre><code>shell&gt;# useradd -g mysql -s /usr/sbin/nologin mysql</code></pre><p>2.2.2.2、下载 MySQL</p>
<pre><code>shell&gt;# cd ~
shell&gt;# wget http://mirrors.sohu.com/mysql/MySQL-5.7/mysql-5.7.24.tar.gz</code></pre><p>注意：MySQL源码安装包在国外，下载会比较慢；我已经提前下载好了。</p>
<p>2.2.2.3、上传</p>
<p>2.2.2.4、解压</p>
<pre><code>shell&gt;# tar -zxvf mysql-5.7.24.tar.gz</code></pre><p>2.2.2.5、进入目录</p>
<pre><code>shell&gt;# cd mysql-5.7.24</code></pre><p>2.2.2.6、进行软件配置和环境检测</p>
<pre><code>shell&gt;# cmake \
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
-DMYSQL_UNIX_ADDR=/usr/local/mysql/tmp/mysql.sock \
-DMYSQL_DATADIR=/usr/local/mysql/data \
-DSYSCONFDIR=/usr/local/mysql/etc \
-DMYSQL_USER=mysql \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci \
-DWITH_EXTRA_CHARSETS:STRING=utf8,gbk \
-DWITH_DEBUG=0 \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_ARCHIVE_STORAGE_ENGINE=1 \
-DWITH_PARTITION_STORAGE_ENGINE=1 \
-DENABLED_LOCAL_INFILE=1 \
-DWITH_EMBEDDED_SERVER=1 \
-DMYSQL_USER=mysql \
-DWITH_BOOST=/usr/local/boost \
-DDOWNLOAD_BOOST=1</code></pre><p>以上内容的解释：</p>
<p>shell&gt;# cmake</p>
<pre><code>#设置安装目录

-DCMAKE_INSTALL_PREFIX=/usr/local/mysql

#设置sock目录

-DMYSQL_UNIX_ADDR=/usr/local/mysql/tmp/mysql.sock

#设置数据库存放目录

-DMYSQL_DATADIR=/usr/local/mysql/data

#设置配置文件my.cnf存放目录

-DSYSCONFDIR=/usr/local/mysql/etc

#设置mysql的默认使用用户

-DMYSQL_USER=mysql

#设置默认字符集

-DDEFAULT_CHARSET=utf8

#默认校对规则

-DDEFAULT_COLLATION=utf8_general_ci

#指明安装额外字符集的支持

-DWITH_EXTRA_CHARSETS:STRING=utf8,gbk

#去除debug模式

-DWITH_DEBUG=0

#以下几条开启常用的引擎

-DWITH_MYISAM_STORAGE_ENGINE=1

-DWITH_INNOBASE_STORAGE_ENGINE=1

-DWITH_ARCHIVE_STORAGE_ENGINE=1

-DWITH_PARTITION_STORAGE_ENGINE=1

#Enable LOAD DATA LOCAL INFILE（default：disabled）

-DENABLED_LOCAL_INFILE=1

#使用一些字符函数的汇编版本

-DWITH_EMBEDDED_SERVER=1

-DMYSQL_USER=mysql

#5.7编译需要boost类库，指明boost的路径

-DWITH_BOOST=/usr/local/boost

#在以上路径如果没查找到boost会自动下载并解压(如事先已下载好，此句可略)

-DDOWNLOAD_BOOST=1</code></pre><p>2.2.2.7、编译软件并且进行安装</p>
<pre><code>shell&gt;# make &amp;&amp; make install</code></pre><p>注意：</p>
<pre><code>接下来可能需要耗较长时间，请耐心等待。另外如果过程中出现报错而中断，需要删除CMakeCache.txt文件后再执行 2.2.4步骤内容（没出错请不要执行以下两行指令）：</code></pre><p>shell&gt;# make clean</p>
<p>shell&gt;# rm -rf CMakeCache.txt或者 shell&gt;# unlink CMakeCache.txt</p>
<p>2.2.3、配置</p>
<p>学习目标： MySQL 目录权限设置和配置 MySQL</p>
<p>概述</p>
<pre><code>MySQL 服务需要使用 mysql 用户与用户组来运行，我们安装 MySQL 时使用的是 root 用户，所以 mysql 安装目录默认的所有者与所属组都是 root，必须将它们修改为 mysql 才能运行 MySQL 服务。CentOS 系统默认自带了 mysql 配置文件，如果不将系统自带的 mysql 配置文件删除，则无法启动 mysql 服务，删除自带配置文件后，需要重新创建 mysql 配置文件，不创建也无法启动 mysql 服务。</code></pre><p>步骤</p>
<ol>
<li>修改拥有者与所属组</li>
<li>删除系统自带配置文件</li>
<li>创建 my.cnf 配置文件(进入 MySQL 安装目录下)</li>
</ol>
<p>2.2.3.1、使用递归，把 MySQL 目录所有者设置为 MySQL这个用户</p>
<pre><code>shell&gt;# chown -R mysql:mysql /usr/local/mysql</code></pre><p>2.2.3.2、删除系统自带的 my.cnf 文件</p>
<pre><code>shell&gt;# unlink /etc/my.cnf</code></pre><p>注意：</p>
<pre><code>如果 /etc/my.cnf 存在的话，请删除。可以使用 whereis 查找 my.cnf 存在路径。</code></pre><p>2.2.3.3、进入 MySQL 安装目录下</p>
<pre><code>shell&gt;# cd /usr/local/mysql</code></pre><p>重建 my.cnf 文件</p>
<p>2.2.3.4、根据实际情况优化 MySQL 配置</p>
<p>注意：以下命令是在 /usr/local/mysql/目录下执行(根据自己实际情况操作)</p>
<pre><code>shell&gt;# vim etc/my.cnf</code></pre><p>大概内容如下(my.cnf 的示例配置)：</p>
<pre><code>[client]
default-character-set = utf8
port = 3306
socket = /usr/local/mysql/tmp/mysql.sock

[mysqld]
datadir =/usr/local/mysql/data
port = 3306
socket = /usr/local/mysql/tmp/mysql.sock
user = mysql
symbolic-links = 0
pid-file = /usr/local/mysql/tmp/mysql.pid

explicit_defaults_for_timestamp = true
sql_mode = ERROR_FOR_DIVISION_BY_ZERO,NO_ZERO_DATE,NO_ZERO_IN_DATE,NO_AUTO_CREATE_USER

slow_query_log = on
slow_query_log_file = /usr/local/mysql/log/slow.log
long_query_time = 2

log_error = /usr/local/mysql/log/mysql.err</code></pre><p>2.2.3.5、初始化和启动</p>
<p>学习目标：掌握 MySQL 初始化配置项、启动 MySQL、修改 root 密码、加入环境变量中，了解如何开放3306端口</p>
<p>概述</p>
<pre><code>在 MySQL5.7 以上有两种方式，一种是随机生成密码，另外一种是不生成密码，我们会使用第二种(不生成密码)，初始时不生成密码，则默认密码为空；MySQL 没有密码很不安全，如果开放了3306端口，其他人知道我们服务器的IP就很容易登陆到我们MySQL，他们就可以为所欲为，直接下需要为 MySQL 设置密码。

为什么要将 MySQL 服务增加到开机自动启动？如果没有将 MySQL 服务增加到开机自启，我们每次重启服务器后都必须手动启动 MySQL服务，这样操作比较繁琐。

为什么要将 MySQL 命令加入到环境变量中？只是为方便我们使用 mysql -uroot -proot 来管理 MySQL，如果没有设置到环境变量中，需要进入到 MySQL 安装目录下的 bin 目录下才能使用 mysql -uroot -proot 命令。</code></pre><p>步骤</p>
<ol>
<li>初始化 MySQL</li>
<li>启动 MySQL</li>
<li>修改 MySQL 密码</li>
<li>增加到开机启动</li>
<li>加入环境变量中</li>
<li>开放 3306 端口(作为了解)</li>
</ol>
<p>2.2.3.5.1、初始化 MySQL 的基本表</p>
<p>–inittialize会生成一个随机密码(~/.mysql_secret)，而–initialize-insecure不会生成密码</p>
<pre><code>shell&gt;# /usr/local/mysql/bin/mysqld \
--initialize-insecure \
--basedir=/usr/local/mysql \
--datadir=/usr/local/mysql/data \
--user=mysql</code></pre><p>注意：</p>
<pre><code>如果初始化出错，则需要用 rm -rf /usr/local/mysql/data/* 将 mysql 的 data 目录下的文件和目录都删除，然后再重新运行以上语句</code></pre><p>2.2.3.5.2、启动 MySQL</p>
<pre><code>shell&gt;# /usr/local/mysql/bin/mysqld_safe &gt; /dev/null 2&gt;&amp;1 &amp;</code></pre><p>2.2.3.5.3、修改 MySQL 的 root 密码</p>
<pre><code>shell&gt;# /usr/local/mysql/bin/mysqladmin -u root password 123456</code></pre><p>2.2.3.5.4、增加到开机启动</p>
<pre><code>shell&gt;# cp /usr/local/mysql/support-files/mysql.server /etc/rc.d/init.d/mysqld</code></pre><p>然后将mysqld服务加入启动项：</p>
<pre><code>shell&gt;# chkconfig --add mysqld</code></pre><p>设置为自启动：</p>
<pre><code>shell&gt;# chkconfig --level 345 mysqld on</code></pre><p>–level 参数说明：</p>
<p>–level&lt;等级代号&gt; 　指定读系统服务要在哪一个执行等级中开启或关毕。</p>
<p>等级0表示：表示关机</p>
<p>等级1表示：单用户模式</p>
<p>等级2表示：无网络连接的多用户命令行模式</p>
<p>等级3表示：有网络连接的多用户命令行模式</p>
<p>等级4表示：不可用</p>
<p>等级5表示：带图形界面的多用户模式</p>
<p>等级6表示：重新启动</p>
<p>2.2.3.5.4、将 MySQL 命令加入到环境变量中</p>
<pre><code>shell&gt;# PATH=$PATH:/usr/local/mysql/bin</code></pre><p>为了重启后仍能有效：</p>
<pre><code>shell&gt;# echo &apos;PATH=$PATH:/usr/local/mysql/bin&apos; &gt;&gt; /root/.bashrc</code></pre><p>2.2.3.5.5、如果需要对外开放 3306 端口</p>
<pre><code>shell&gt;# iptables -I INPUT -p tcp --dport 3306 -j ACCEPT</code></pre><p>注意：不建议对面开放3306端口，为了安全起见</p>
<p>如果 mysqld 服务正常运行中，但是执行 mysql 指令时报出以下错误：</p>
<p>解决方案就是创建一个软链接</p>
<pre><code>shell&gt;# mkdir -pv /var/lib/mysql
shell&gt;# ln -s /usr/local/mysql/tmp/mysql.sock /var/lib/mysql/mysql.sock</code></pre><p>3、安装PHP</p>
<p>学习目标：掌握源码编译安装PHP、FastCGI模式运行PHP、PHP配置，了解php-fpm 作用与 cgi 的区别</p>
<p>概述</p>
<p>php-fpm 提供了更好的 PHP 进程管理方式，可以有效控制内存和进程、可以平滑重载 PHP 配置。</p>
<p>CGI 是什么</p>
<pre><code>CGI 是一个协议，就好像我是广东人，相处了一个东北的女朋友，我们可以用户普通话交流，普通话这个语法规则就是一个协议，跟 CGI 一样，遵循这个 CGI 规则，我们都能够互相理解对方的意思，最后就是 nginx/apache 都能够理解 php 是啥。</code></pre><p>FastCGI 是什么</p>
<pre><code>同 CGI，是一种通信协议，但比 CGI 在效率上做了一些优化，fast-cgi则是一个进程可以处理多个请求。</code></pre><p>php可以到 <a href="http://php.net/downloads.php" target="_blank" rel="noopener">http://php.net/downloads.php</a> 或者 <a href="http://mirrors.sohu.com/php/" target="_blank" rel="noopener">http://mirrors.sohu.com/php/</a> 去下 载,此处 以php-7.2.2.tar.gz为例 </p>
<p>以下安装中涉及的几点需要提前说明的问题：</p>
<ul>
<li>所有下载的文件将保存在 /root 目录下</li>
<li>php 将以 FastCGI模式运行，监听 9000 端口(默认端口)</li>
<li>php 将被安装在 /usr/local/php 目录下</li>
<li>php 的配置文件保存于 /usr/local/php/etc/php.ini</li>
<li>php 的扩展库文件，如果可以的话，尽量放在 /usr/local/php/lib/php/extensions/ 目录</li>
</ul>
<p>注意：以www用户来运行PHP与nginx</p>
<p>步骤</p>
<ol>
<li>检查与安装依赖库<ol>
<li>检查依赖是否安装</li>
<li>使用 yum 源安装依赖库</li>
</ol>
</li>
<li>安装 PHP<ol>
<li>下载</li>
<li>解压</li>
<li>进入目录</li>
<li>生成帮助文档(了解)</li>
<li>进行软件的配置与环境检测</li>
<li>编译并且进行安装</li>
</ol>
</li>
<li>配置<ol>
<li>复制配置文件<ol>
<li>在解压目录中复制配置文件到/urs/local/php/etc/php.ini</li>
</ol>
</li>
<li>修改配置文件 php.ini</li>
<li>修改配置文件 php-fpm.conf</li>
<li>创建用户组与用户名</li>
<li>将 php-fpm 加入开机自动启动</li>
</ol>
</li>
</ol>
<p>3.1、检查与安装依赖库</p>
<p>学习目录：了解怎么使用 rpm 命令检查软件是否安装</p>
<p>概述</p>
<pre><code>源码编译安装 PHP 需要依赖libxml2、libxml2-devvel、gd-devel启动库，在安装 PHP 之前必须先检查这些依赖是否都安装，如果没有安装直接使用 yum 源安装即可。</code></pre><p>步骤</p>
<ol>
<li>使用 rpm 命令检查 libxml2* 等依赖库是否安装</li>
<li>使用 yum 源安装依赖库</li>
</ol>
<p>3.1.1、检查依赖库</p>
<p>安装PHP之前，首先要检查安装 libxml2、libxml2-devvel、gd-devel</p>
<pre><code>shell&gt;# rpm -qa | grep libxml2*
shell&gt;# rpm -qa | grep gd-devel*</code></pre><p>如果没有安装，可以使用yum -y install命令进行安装。</p>
<p>3.1.2、安装依赖库</p>
<pre><code>shell&gt;# yum -y install libxml2 libxml2-devvel gd-devel</code></pre><p>3.2、安装 PHP</p>
<p>学习目标：掌握源码编译安装 PHP</p>
<p>概述</p>
<pre><code>为什么选择源码编译安装 PHP？一台服务器同时运行多个项目，每个项目对 PHP 版本要求都不同，这时我们可以选择使用源码编译安装不同版本PHP，并以 FastCGI模式运行，为不同版本PHP设置不同的服务名称与不同的端口；以 FastCGI 模式运行，默认端口为：9000。</code></pre><p>步骤</p>
<ol>
<li>下载</li>
<li>解压</li>
<li>进入目录</li>
<li>生成帮助文档(可以忽略)</li>
<li>进行软件的配置与环境检测</li>
<li>编译软件并且进行安装</li>
</ol>
<p>3.2.1、下载</p>
<pre><code>shell&gt;# cd ~
shell&gt;# wget http://am1.php.net/distributions/php-7.2.2.tar.gz</code></pre><p>3.2.2、解压</p>
<pre><code>shell&gt;# tar -zxvf php-7.2.2.tar.gz</code></pre><p>3.2.3、进入目录</p>
<pre><code>shell&gt;# cd php-7.2.2</code></pre><p>3.2.4、将configure 参数及详情解析另存为一个文件，以供学习参考用</p>
<pre><code>shell&gt;# ./configure --help &gt; php_configure.txt</code></pre><p>注意：这步可以忽略</p>
<p>3.2.5、进行软件的配置与环境检测</p>
<pre><code>shell&gt;# ./configure \
--prefix=/usr/local/php \
--with-config-file-path=/usr/local/php/etc \
--enable-fpm \
--enable-opcache \
--with-zlib-dir \
--with-bz2 \
--with-libxml-dir=/usr \
--with-gd \
--with-freetype-dir \
--with-jpeg-dir \
--with-png-dir \
--enable-mbstring \
--with-mysql=/usr/local/mysql \
--with-mysqli=/usr/local/mysql/bin/mysql_config \
--with-pdo-mysql=/usr/local/mysql \
--with-iconv \
--disable-ipv6 \
--enable-static \
--enable-inline-optimization \
--enable-sockets \
--enable-soap \
--with-openssl \
--with-curl</code></pre><p>以上配置项目说明以下：</p>
<p>./configure \                                                # 检测环境，并生成makefile文件</p>
<p>–prefix=/usr/local/php \                            # 指定php安装目录</p>
<p>–with-config-file-path=/usr/local/php/etc \            # 设置php.ini配置文件存放的路径</p>
<p>–enable-fpm \                                    # 开启PHP-FPM，用于控制PHP-CGI的FastCGI进程</p>
<p>–enable-opcache \                                # PHP新增opcache功能</p>
<p>–with-zlib-dir \                                    # 加载zlib库</p>
<p>–with-bz2 \                                        # 加载bz2的压缩库</p>
<p>–with-libxml-dir=/usr \                            # 加载xml库</p>
<p>–with-gd \                                        # 加载gd库</p>
<p>–with-freetype-dir \                                # 加载字体库</p>
<p>–with-jpeg-dir \                                    # 加载jpeg库</p>
<p>–with-png-dir \                                    # 加载png库</p>
<p>–enable-mbstring \                                # 开启mbstring加密库</p>
<p>–with-mysql=/usr/local/mysql \                    # 加载mysql，并指定mysql基本路径 注意：PHP7.0以(包含)不需要加上</p>
<p>–with-mysqli=/usr/local/mysql/bin/mysql_config \    # 加载mysqli库，并指定mysql配置工具</p>
<p>–with-pdo-mysql=/usr/local/mysql \                # 加载pdo对mysql的支持</p>
<p>–with-iconv \                                        # 开启转换字符集</p>
<p>–disable-ipv6 \                                    # 关闭ipv6支持</p>
<p>–enable-static \                                    # 以静态方式编辑php库</p>
<p>–enable-inline-optimization \                        # 开启优化线程</p>
<p>–enable-sockets \                                # 开启sockets支持</p>
<p>–enable-soap \                                    #开启soap对web service的支持</p>
<p>–with-openssl \                                    # 开启ssl支持</p>
<p>–with-curl                                        # 模拟浏览器</p>
<p>3.2.6、编译软件并且进行安装</p>
<pre><code>shell&gt;# make &amp;&amp; make install</code></pre><p>3.3、配置</p>
<p>学习目标：掌握PHP配置与加入开机自动启动</p>
<p>概述</p>
<pre><code>源码编译安装 PHP 默认是没有配置文件，需要我们在解压出来目录中复制到PHP安装目录下的etc目录，因为安装时已经指定 PHP 配置文件路径。</code></pre><p>步骤</p>
<ol>
<li>复制配置文件</li>
<li>修改配置文件 php.ini</li>
<li>修改配置文件 php-fpm.conf</li>
<li>创建用户组与用户名</li>
<li>将 php-fpm 设置开机自动启动</li>
</ol>
<p>3.3.1、复制配置文件</p>
<pre><code>shell&gt;# cp php.ini-production /usr/local/php/etc/php.ini



shell&gt;# cp sapi/fpm/init.d.php-fpm /etc/rc.d/init.d/php-fpm</code></pre><p>赋予其可执行权限</p>
<pre><code>shell&gt;# chmod +x /etc/rc.d/init.d/php-fpm</code></pre><p>拷贝产生 php-fpm 的配置文件</p>
<pre><code>shell&gt;# cd /usr/local/php/etc
shell&gt;# cp php-fpm.conf.default php-fpm.conf</code></pre><p>3.3.2、配置 php.ini</p>
<pre><code>shell&gt;# vim php.ini</code></pre><p>找到 ;date.timezone = 修改为 date.timezone = Asia/Shanghai</p>
<p>根据自己的需求调整以下选项的值</p>
<p>error_reporting = E_ALL &amp; ~E_NOTICE &amp; ~E_STRICT &amp; ~E_DEPRECATED  ;开启php报错机制</p>
<p>display_errors = On ;开启报错内容</p>
<p>max_execution_time = 60  ;PHP运行时间默认30秒，将PHP脚本运行时间设置60秒</p>
<p>max_input_time = 60</p>
<p>memory_limit = 256M</p>
<p>post_max_size = 256M</p>
<p>upload_max_filesize = 256M</p>
<p>3.3.3、配置 php-fpm.conf</p>
<pre><code>shell&gt;# cd /usr/local/php/etc/php-fpm.d
shell&gt;# cp www.conf.default www.conf



shell&gt;# vim www.conf</code></pre><p>找到 user = nobody 和 group = nobody，将 nobody 改成 www</p>
<p>找到 listen.owner=nobody 和 listen.group= nobody，将 nobody 改成 www</p>
<p>3.3.4、创建用户组与用户名</p>
<pre><code>shell&gt;# groupadd www
shell&gt;# useradd -g www -s /usr/sbin/nologin www</code></pre><p>3.3.5、将 php-fpm 加入服务并自动启动</p>
<pre><code>shell&gt;# service php-fpm start
shell&gt;# chkconfig --add php-fpm
shell&gt;# chkconfig --level 345 php-fpm on</code></pre><p>启动php</p>
<p>添加自动启动</p>
<p>4、安装 Nginx</p>
<p>学习目录：掌握源码编译安装 Nginx 与配置虚拟主机</p>
<p>概述</p>
<p>Nginx 可以到 <a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a> 下去，此处以 nginx-1.15.6.tar.gz 为例</p>
<p>以下安装中涉及的几点需要提前说明的问题：</p>
<p>所有下载文件将保存在 /root 目录</p>
<p>nginx 将以 www 用户运行，而且将加入 service 开机自动运行</p>
<p>nginx 将被安装在 /usr/local/nginx 目录下</p>
<p>nginx 的每个网站将存放在 /mydata/wwwroot 目录下，默认网站为  /mydata/wwwroot/php34/www</p>
<p>nginx 的配置文件保存于 /usr/local/nginx/conf/nginx.conf</p>
<p>nginx 的临时目录都保存于 /usr/local/nginx/tmp/ 目录下</p>
<p>步骤</p>
<ol>
<li>检查与安装依赖库<ol>
<li>检查依赖库</li>
<li>安装依赖库</li>
</ol>
</li>
<li>安装 Nginx<ol>
<li>创建目录</li>
<li>下载 nginx</li>
<li>解压</li>
<li>进入目录</li>
<li>生成帮助文档</li>
<li>进行软件配置和环境检测</li>
<li>编译软件并且进行安装</li>
</ol>
</li>
<li>配置 Nginx<ol>
<li>简单配置<ol>
<li>创建网站根目录</li>
<li>开始配置</li>
</ol>
</li>
<li>支持 PHP</li>
<li>优化虚拟主机配置</li>
</ol>
</li>
<li>nginx 管理<ol>
<li>启动</li>
<li>重载配置文件</li>
<li>停止</li>
<li>通知 nginx 关闭服务</li>
<li>安装为服务<ol>
<li>配置权限并添加到开机启动</li>
</ol>
</li>
</ol>
</li>
<li>与 ThinkPHP 的整合</li>
<li>开放端口</li>
</ol>
<p>4.1、检查与安装依赖库</p>
<p>学习目标：了解怎么使用 rpm 命令检查软件是否安装</p>
<p>概述</p>
<pre><code>源码编译安装 Nginx 需要依赖pcre、pcre-devel、libevent、openssl、openssl-devel启动库，在安装 Nginx 之前必须先检查这些依赖是否都安装，如果没有安装直接使用 yum 源安装即可。</code></pre><p>步骤</p>
<ol>
<li>检查依赖库</li>
<li>安装依赖库</li>
</ol>
<p>4.1.1、检查依赖库</p>
<p>安装 nginx 之前，首先要检查安装 pcre（正则表达式库）、pcre-devel 和 libevent（提高应用程序的性能）、make 以及 openssl、openssl-devel</p>
<pre><code>shell&gt;# rpm -qa | grep pcre*
shell&gt;# rpm -qa | grep libevent*
shell&gt;# rpm -qa | grep openssl*</code></pre><p>如果没有安装，可以使用 yum -y install命令进行安装。</p>
<p>4.1.2、安装依赖库</p>
<pre><code>shell&gt;# yum -y install pcre pcre-devel libevent openssl openssl-devel</code></pre><p>4.2、安装 nginx</p>
<p>学习目标：掌握源码编译安装 nginx</p>
<p>概述</p>
<pre><code>为什么选择源码编译安装 nginx？可以定制安装我们需要的功能模板，以方便管理。</code></pre><p>步骤</p>
<ol>
<li>创建目录</li>
<li>下载 nginx</li>
<li>解压</li>
<li>进入目录</li>
<li>生成帮助文档</li>
<li>进行软件配置和环境检测</li>
<li>编译软件并且进行安装</li>
</ol>
<p>4.2.1、创建目录</p>
<pre><code>shell&gt;# mkdir -pv /usr/local/nginx/tmp</code></pre><p>4.2.2、下载  nginx</p>
<pre><code>shell&gt;# cd ~
shell&gt;# wget http://nginx.org/download/nginx-1.15.6.tar.gz</code></pre><p>上传</p>
<p>4.2.3、解压</p>
<pre><code>shell&gt;# tar -zxvf nginx-1.15.6.tar.gz</code></pre><p>4.2.4、进入目录</p>
<pre><code>shell&gt;# cd nginx-1.15.6</code></pre><p>4.2.5、将 configure 参数及详情解析另存为一个文件，以供学习参考 用</p>
<pre><code>shell&gt;# ./configure --help &gt; nginx_configure.txt</code></pre><p>4.2.6、进行软件配置和环境检测</p>
<pre><code>./configure \
--prefix=/usr/local/nginx \
--user=www \
--group=www \
--with-http_ssl_module \
--with-http_flv_module \
--with-http_stub_status_module \
--with-http_gzip_static_module \
--with-http_realip_module \
--with-http_image_filter_module \
--with-pcre \
--http-client-body-temp-path=/usr/local/nginx/tmp/client_body_temp \
--http-fastcgi-temp-path=/usr/local/nginx/tmp/fastcgi_temp \
--http-proxy-temp-path=/usr/local/nginx/tmp/proxy_temp \
--http-uwsgi-temp-path=/usr/local/nginx/tmp/uwsgi_temp \
--http-scgi-temp-path=/usr/local/nginx/tmp/scgi_temp</code></pre><p>参数说明：</p>
<pre><code>./configure \
--prefix=/usr/local/nginx \        # 指明安装目录
--user=www \                    # 默认的 nginx 使用的用户
--group=www \                    # 默认组
--with-http_ssl_module \
--with-http_flv_module \
--with-http_stub_status_module \
--with-http_gzip_static_module \
--with-http_realip_module \
--with-http_image_filter_module \    # 这个还需要安装gd库 yum -y install gd-devel
--with-pcre \
--http-client-body-temp-path=/usr/local/nginx/tmp/client_body_temp \
--http-fastcgi-temp-path=/usr/local/nginx/tmp/fastcgi_temp \
--http-proxy-temp-path=/usr/local/nginx/tmp/proxy_temp \
--http-uwsgi-temp-path=/usr/local/nginx/tmp/uwsgi_temp \
--http-scgi-temp-path=/usr/local/nginx/tmp/scgi_temp</code></pre><p>4.2.7、编译软件并且进行安装</p>
<pre><code>shell&gt;# make &amp;&amp; make install</code></pre><p>4.3、配置</p>
<p>学习目标：掌握 nginx 相关配置与创建虚拟主机</p>
<p>概述</p>
<pre><code>nginx 安装成功后，默认站点是在安装目录中的html目录，我们为了方便管理站点，将 /mydata/wwwroot 目录设置为专门存放所有站点；nginx 默认不支持 PHP 解析，也需要我们修改配置文件来支持。</code></pre><p>步骤</p>
<ol>
<li>简单配置<ol>
<li>创建网站根目录</li>
<li>开始配置</li>
</ol>
</li>
<li>支持 PHP</li>
<li>优化虚拟主机配置</li>
</ol>
<p>4.3.1、简单配置</p>
<p>4.3.1.1、创建网站根目录</p>
<pre><code>shell&gt;# mkdir /mydata/wwwroot
shell&gt;# chown -R www:www /mydata/wwwroot
shell&gt;# mkdir -pv /mydata/wwwroot/php34/www</code></pre><p>4.3.1.2、开始配置</p>
<pre><code>shell&gt;# vim /usr/local/nginx/conf/nginx.conf</code></pre><ul>
<li>在 http{} 代码段里添加 client_max_body_size 200m; 以支持 php 上传大文件。(请根据自己项目需求来定值)</li>
</ul>
<ul>
<li>将第一个 server{} 代码段里的 location /{} 里面的 root 值改为 /mydata/wwwroot/php34/www。并在 index 的值 后面追加 index.php。然后将 root 和 index 都转移到 location 外面(同一个 server 代码段内可能需要多个 location，但每个 location 里面都要写 root 指令和 index 指令，就冗余了。所以将它们转移到 location 外面就可以消除此冗余)，然后同一 server 代码段里面的其他 root 指令注释掉</li>
</ul>
<p>4.3.2、支持 PHP</p>
<p>在 server{}代码段里新增以下代码就可以支持 php 的访问了</p>
<pre><code>location ~ \.php {
    fastcgi_pass    127.0.0.1:9000;
    fastcgi_index    index.php;
    include            fastcgi.conf;
}</code></pre><p>4.3.3、优化虚拟主机配置</p>
<pre><code>`nginx.conf中的每个server{}代码段都是一个独立的虚拟主机配置。当配置多个虚拟主机时，需要在nginx.conf里定多个server{}`代码段，那么主配置文件就会变得重复、臃肿。所以建议，将 server{} 代码段都写在另一个文件(例如：vhost.conf 或 server.conf)或多个文件(例如：按客户或项目分组)，然后再用include 指令包含进来。</code></pre><p>本文档以 vhost.conf举例说明：</p>
<p>nginx.conf的 server{}代码段都移走，换成一个include指令</p>
<p>注意：在/usr/local/nginx/conf/目录创建vhost.conf文件；需要在/mydata/wwwroot目录创建itcast/www目录与phpshop.com目录</p>
<p>1、创建 itcast/www</p>
<p>2、创建 phpshop.com 目录</p>
<pre><code>shell&gt;# vim /usr/local/nginx/conf/vhost.conf</code></pre><p>vhost.conf 的示例代码如下：</p>
<pre><code># 默认网站
server {
    listen    80; #端口
    server_name    localhost;    #域名
    root    /mydata/wwwroot/itcast/www; #站点
    index index.htm index.html index.php;    #入口文件
    #支持PHP
    location ~ \.php {
        fastcgi_pass    127.0.0.1:9000;    #PHP进程
        fastcgi_index    index.php;    # 入口文件
        include            fastcgi.conf;    # 载入一些配置文件
    }
}

# 电商
server {
    listen    80;
    server_name    phpshop.com;
    root    /mydata/wwwroot/phpshop.com;
    index    index.htm index.html index.php;

    location ~ \.php {
        fastcgi_pass    127.0.0.1:9000;
        fastcgi_index    index.php;
        include            fastcgi.conf;
    }
}


==有没有发现每个虚拟主机都需要配置 php 的代理转发，所以还可以再这样优化，将转发的指令移动到 fastcgi.conf里面==</code></pre><p>fastcgi.conf 的示例代码：</p>
<pre><code># add by youlong from vhost.conf
fastcgi_pass 127.0.0.1:9000;
fastcgi_index index.php;


shell&gt;# vim /usr/local/nginx/conf/fastcgi.conf</code></pre><p>有可能报以下错误</p>
<p>因为fastcgi_pass 127.0.0.1:9000;与fastcgi_index index.php;已经重复出现，先检测vhost.conf文件有没有配置该项。</p>
<p>如果再出现.pid文件找不到的话，</p>
<p>vhost.conf的示例代码：</p>
<pre><code>shell&gt;# vim /usr/local/nginx/conf/vhost.conf



# 默认网站
server {
    listen    80;
    server_name    localhost;
    root    /mydata/wwwroot/itcast/www;
    index index.htm index.html index.php;

    location ~ \.php {
        include            fastcgi.conf;
    }
}

# 电商
server {
    listen    80;
    server_name    phpshop.com;
    root    /mydata/wwwroot/phpshop.com;
    index    index.htm index.html index.php;

    location ~ \.php {
        include            fastcgi.conf;
    }
}</code></pre><p>4.4、nginx 管理</p>
<p>学习目标：掌握启动、重载、停止、通知 nginx 关闭服务，了解如何安装为服务与设置开机自动启动</p>
<p>概述</p>
<pre><code>使用源码编译安装的 nginx 默认是不能使用 service 命令来启动 nginx 服务，需要安装为服务才行。</code></pre><p>步骤</p>
<ol>
<li>启动</li>
<li>重载配置文件</li>
<li>停止</li>
<li>通知 nginx 关闭服务</li>
<li>安装为服务<ol>
<li>配置权限并添加到开机启动</li>
</ol>
</li>
</ol>
<p>4.4.1、启动</p>
<pre><code>shell&gt;# /usr/local/nginx/sbin/nginx</code></pre><p>4.4.2、重载配置文件</p>
<pre><code>shell&gt;# /usr/local/nginx/sbin/nginx -s reload</code></pre><p>注意：nginx服务必须启动，才能使用该。</p>
<p>4.4.3、停止</p>
<pre><code>shell&gt;# /usr/local/nginx/sbin/nginx -s stop</code></pre><p>4.4.4、通知nginx关闭服务</p>
<pre><code>shell&gt;# /usr/local/nginx/sbin/nginx -s quit</code></pre><p>注意：nginx服务必须启动，才能使用该。</p>
<p>4.4.4、安装为服务</p>
<pre><code>shell&gt;# vim /etc/rc.d/init.d/nginx</code></pre><p>内容如下（特别是 chkconfig 和 description那两行代码，一定要写，否则无法加入服务）：</p>
<pre><code>#!/bin/sh
# chkconfig: - 85 15
# description: nginx is a World Wide Web server. It is used to serve
start() {
    echo &apos;Starting Nginx ...&apos;
    /usr/local/nginx/sbin/nginx &gt; /dev/null 2&gt;&amp;1 &amp;
}

stop() {
    echo &apos;Stoping Nginx ...&apos;
    /usr/local/nginx/sbin/nginx -s stop &gt; /dev/null 2&gt;&amp;1 &amp;
}

reload() {
    echo &apos;Reloading Nginx ...&apos;
    /usr/local/nginx/sbin/nginx -s reload
}

if [ $# -ne 1 ]
    then
        echo &apos;please input one params like start|restart|stop|reload&apos;
    exit 1
fi

case &quot;$1&quot; in
    &apos;start&apos;)
        start
    ;;

    &apos;stop&apos;)
        stop
    ;;

    &apos;restart&apos;)
        stop
        sleep 2
        start
    ;;

    &apos;reload&apos;)
        reload
    ;;

    &apos;*&apos;)
        echo &apos;please input one params like start|restart|stop|reload&apos;
    ;;
esac</code></pre><p>4.4.4.1、配置权限并添加到开机启动</p>
<pre><code>shell&gt;# chmod a+x /etc/rc.d/init.d/nginx
shell&gt;# chkconfig --add nginx
shell&gt;# chkconfig --level 345 nginx on</code></pre><p>以后就可以直接用以下指令来完成日常管理了：</p>
<pre><code>shell&gt;# service nginx start        #启动
shell&gt;# service nginx reload    #重载
shell&gt;# service nginx stop        # 停止</code></pre><p>4.5、与 ThinkPHP 的整合</p>
<p>学习目标：掌握 nginx 与 ThinkPHP 整合</p>
<p>概述</p>
<pre><code>    nginx 默认不支持 pathinfo 模式，如果想让 nginx 支持 pathinfo 模式，需要借助 fastcgi 模块自带 fastcgi_split_path_info 指令来解决此类问题。

==如果希望 nginx 支持 ThinkPHP 的运行，还需要将 nginx 配置成支持 pathinfo 模式。==

fastcgi 模块自带了一个 fastcgi_split_path_info 指令专门用来解决此类问题的，该指令会根据给定的正则表达式来分隔 URL，从而提取出脚本名和 pathinfo 信息，使用这个指令可以避免使用 if 语句，配置更简单。</code></pre><p>另外判断文件是否存在也有更简单的方法，使用 try_files 指令即可。</p>
<p>本案例以 /mydata/wwwroot/phpshop.com 虚拟主机为例：</p>
<pre><code>shell&gt;# vim /usr/local/nginx/conf/vhost.conf



server {
    ......
    location / {
        # 访问路径的文件不存在则重写 URL 转交给 ThinkPHP 处理
        try_files $uri /index.php$uri;
    }

    location ~ .+\.php($|/) {
        # 设置 PATH_INFO，注意 fastcgi_split_path_info 已经自动改写了 fastcgi_script_name 变量
        # 后面不需要再改写 SCRIPT_FILENAME，SCRIPT_NAME 环境变量，所以必须在加载 fastcgi.conf 之前设置
        fastcgi_split_path_info ^(.+\.php)(/.*)$;
        fastcgi_param PATH_INFO $fastcgi_path_info;

        # 加载 Nginx 默认&quot;服务器环境变量&quot;配置
        include fastcgi.conf;
    }
}</code></pre><p>可将第二个 location 的内容剪切追加到 fastcgi.conf 文件的内容前面，以实现代码重用。</p>
<p>本案例以 /mydata/wwwroot/phpshop.com 虚拟主机为例：</p>
<pre><code>shell&gt;# vim /usr/local/nginx/conf/vhost.conf

server {
    listen 80;
    server_name phpshop.com
    root /mydata/wwwroot/phpshop.com/public;
    index index.htm index.html index.php;
    location ~ /\.ht {
        deny all;
    }

    location / {
        # 访问路径的文件不存在则重写 URL 转交给 ThinkPHP 处理
        try_files $uri /index.php$uri;
    }

    location ~ .+\.php($|/) {
        # 加载 Nginx 默认&quot;服务器环境变量&quot;配置
        include fastcgi.conf;
    }
}

shell&gt;# vim /usr/local/nginx/conf/fastcgi.conf

fastcgi_split_path_info ^(.+.php)(/.*)$;
fastcgi_param PATH_INFO $fastcgi_path_info;</code></pre><p>注意：每次更改了配置内容后，记得执行重载命令让配置生效。</p>
<pre><code>shell&gt;# service nginx reload</code></pre><p>4.6、开放端口</p>
<p>将 80 端口加入防火墙</p>
<pre><code>shell&gt;# iptables -I INPUT -p tcp --dport 80 -j ACCEPT</code></pre><p>添加至自启动文件</p>
<pre><code>shell&gt;# echo &apos;iptables -I INPUT -p tcp --dport 80 -j ACCEPT&apos; &gt;&gt; /etc/rc.d/rc.local</code></pre><p>六、网站的静态资源和 gzip 压缩</p>
<p>学习目标：了解 nginx 压缩功能</p>
<p>概述</p>
<p>一般静态页面指没有和服务器互相交互的 html 页面。</p>
<p>我们平常所说的 html、css、image、js、xml、json、视频、音乐等都属于静态资源。</p>
<p>静态资源越大越多网页加载的速度就会越慢，因此有必要对静态资源进行压缩优化，这就可以为网站提速不少。</p>
<p>然而有一些大型网站他们除了对静态资源压缩之外他们还会使用 CDN 静态资源服务器做支撑，但 CDN 服务器是需要一定的资金成本的。</p>
<p>步骤</p>
<ol>
<li>开启压缩功能</li>
<li>重启服务</li>
</ol>
<p>查看一个网站是否有启用静态资源压缩：</p>
<pre><code>shell&gt;# curl -I -H &quot;Accept-Encoding: gzip, deflate&quot; &quot;http://www.sohu.com&quot;</code></pre><p>在 Nginx 服务器中，我们可以通过开启 gzip 来对网站的静态资源进行压缩</p>
<p>1、配置如下</p>
<pre><code>shell&gt;# vim /usr/local/nginx/conf/nginx.conf



http {
    ......
    #是否启动gzip压缩,on代表启动,off代表开启
    gzip  on;
    #需要压缩的常见静态资源
    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png video/mp4 video/mp3;
    #由于nginx的压缩发生在浏览器端而微软的ie6很坑爹,会导致压缩后图片看不见所以该选项是禁止ie6发生压缩
    gzip_disable &quot;MSIE [1-6]\.&quot;;
    #如果文件大于1k就启动压缩
    gzip_min_length 1k;
    #以16k为单位,按照原始数据的大小以4倍的方式申请内存空间,一般此项不要修改
    gzip_buffers 4 16k;
    #压缩的等级,数字选择范围是1-9,数字越小压缩的速度越快,消耗cpu就越大
    gzip_comp_level 2; 
}</code></pre><p>2、重新加载</p>
<pre><code>shell&gt;# service nginx reload</code></pre><p>注意：默认情况下 gzip 压缩必须是静态文件大于 1k 才会启动，如果文件小于 1k 则无法启动压缩，如下图所示：</p>
<p>如果无法启动压缩，则 gzip 选项在 curl 命令中无法显示，如果成功如下图所示：</p>
<pre><code>shell&gt;# curl -I -H &quot;Accept-Encoding: gzip, deflate&quot; &quot;http://10.10.10.11/phpinfo.php&quot;</code></pre><p>七、使用缓存功能把静态资源缓存到客户端</p>
<p>1、启动缓存功能的配置</p>
<pre><code>shell&gt;# vim /usr/local/nginx/conf/vhost.conf

# 设置需要压缩的文件类型
location ~ .*\.(jpg|jpeg|gif|css|js|png|ico|mp3|mp4|swf|flv){
     expires 10;  # 缓存10天
}</code></pre><p>如果希望对静态文件缓存 10 天，设置为如下：</p>
<p>保存并退出，然后重启 nginx 服务</p>
<pre><code>shell&gt;# service nginx reload</code></pre><p>使用 lua 的 curl 测试如下：</p>
<pre><code>curl -I -H &quot;Accept-Encoding: gzip, deflate&quot; &quot;http://10.10.10.11/it.mp4&quot;</code></pre><p>注意：如果 Linux 时间不对要修改 Linux 中的系统时间和硬件的时间，否则缓存有问题</p>
<p>八、服务器集群(了解)</p>
<p>服务器(电脑主机)，安装许多软件，例如：php/apache/mysql/redis/memcache 等等</p>
<p>这些软件是网站运行需要的</p>
<p>网站运行经营的比较好的，每天就会有许多人员进行访问 pv (point view)：1000万</p>
<p>可以查看PV值：<a href="http://alexa.chinaz.com/default.html" target="_blank" rel="noopener">http://alexa.chinaz.com/default.html</a></p>
<p>1 天 3600 * 4 = 14400 秒，平均并发访问量：700 次，峰值：3000/4000/5000或以上并发量：服务器每秒被访问的次数</p>
<p>现在服务器每天负载很高（工作量非常多）</p>
<p>并发访问量高的时候，服务器要做优化（否则影响用户使用）：</p>
<p>可以购买多个服务器来支撑网站运行，这个多服务器的组合就是”集群”</p>
<p>九、负载均衡的分发实验(重要)</p>
<p>学习目标：能够实现配置负载均衡器，了解正向代理和反向代理的作用</p>
<p>1、正向代理和反向代理的原理图</p>
<p>2、负载均衡的原理和作用</p>
<p>应用场景</p>
<p>正向代理：是为了请求访问不到的网站发起了代理，因此正向代理是多数应用是为了提供上网服务，我们说的翻墙就是一种正向代理，VPN就是正向代理的一种服务器软件</p>
<p>反向代理：是为了实现负载均衡解决网站大访问量所应用的技术手， Nginx 就是一种能实现反向代理的服务器，因此 Nginx 成为反向代理服务器，由于反向代理服务器能实现负载均衡，所以也有人把反向代理服务器叫做负载均衡器。</p>
<p>3、使用 nginx 部署一个负载均衡的实验</p>
<p>3.1、负载均衡必须要有至少 3 台服务器</p>
<p>Proxy(反向代理服务器)：10.10.10.11:80</p>
<p>Lnmp1(Linux 的 php 环境)：10.10.10.11:81</p>
<p>创建一个站目录，/mydata/wwwroot/81</p>
<pre><code>shell&gt;# mkdir /mydata/wwwroot/81</code></pre><p>Lnmp2(Linux 的 php 环境)：10.10.10.11:82</p>
<p>创建一个站目录，/mydata/wwwroot/82</p>
<p>创建虚拟主机</p>
<p>分别为81与82站点创建index.html文件，内容分ip:81与ip:82</p>
<p>必须确保所有的服务器都处于开启状态</p>
<p>3.2、修改 Proxy 服务器中 nginx.conf 文件内容</p>
<pre><code>shell&gt;# vim /usr/local/nginx/conf/nginx.conf



# 负载均衡的反向代理分发选项
upstream web {
    # 配置服务器地址
    server ip地址 weight=1 max_fails=3 fail_timeout=20s;
    server ip地址 weight=1 max_fails=3 fail_timeout=20s;
}</code></pre><p>参数说明：</p>
<p>weight=1：权重，如果分配的值越大，权重超高</p>
<p>max_fails=3：最多连接失败次数为 3 次</p>
<p>fail_timeout=20s：每次连接失败的时间</p>
<p>3.3、修改 Proxy 服务器中 vhost.conf 文件内容</p>
<pre><code>shell&gt;# vim /usr/local/nginx/conf/vhost.conf



location / {
    proxy_pass http://web/;
}</code></pre><p>3.4、重新加载 nginx</p>
<pre><code>shell&gt;# service nginx reload</code></pre><p>十、Lamp 和Lnmp 的区别</p>
<p>1、Lamp 架构概述</p>
<pre><code>LAMP（Linux+Apche+MySQL+PHP）网站架构是目前国际流行的 Web 框架，这个框架是经典且古老的框架，应该是拥有 PHP 开始这组合就是开始了，Lamp 最大特点是其面对解析程序执行的时候速度很快，因为 Apache 为算法而生，而其缺点在于使用模块加载显得有些臃肿，第一个扩展的修改 Apache 就需要重新加载一次，所以 Apache 在实际开发中其实不是为了提高访问量而生，而是为了提高自算法而生的。</code></pre><p>2、Lnmp 框架概述</p>
<pre><code>Lnmp 是 Linux + Nginx + MySQL + PHP 的组合服务器架构，PHP修改配置文件可以无需重启 Nginx 服务，它管理 PHP 是依赖 PHP 的内存管理工具 php-fpm，所以当 PHP 的配置发生修改，Nginx 服务器是不需要重新启动去加载 PHP 的配置，只需要单纯重新启动 php-fpm 本身就可以完成 PHP 的配置。而 Nginx 服务器是一个反向代理的服务器软件，是为访问量而生的服务器软件。</code></pre><p>3、Lamp 和 Lnmp 的区别是什么</p>
<pre><code>Lamp 为算法而生，所以如果一个网站的逻辑非常复杂，例如：股票交易、金融等适合采用 Lamp 架构，Lnmp 为访问量而生，如果访问量比较大适合采用 Lnmp，目前的流行的 Lamp  + Lnmp 两者结合使用。</code></pre><p>在现实开发中，如果希望 nginx 服务器和 Lamp 一起工作，那么我们就采用负载均衡，这也是工作用得最多的，工作中使用单独 Lnmp 环境其实并不是非常多，多数是 Lanmp 环境。</p>
<p>十一、总结</p>
<p>Nginx</p>
<pre><code>web服务器？http与https协议

反向代理

负载均衡

邮件服务器</code></pre><p>启动nginx</p>
<pre><code>/usr/local/nginx/sbin/nginx    #启动  nginx

/usr/local/nginx/sbin/nginx -s quit  #通知nginx关闭服务

/usr/local/nginx/sbin/nginx -s reload    #重新加载 、热加载

/usr/local/nginx/sbin/nginx -s stop # 停止nginx</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/01/nginx/" data-id="cjysgypds0006nouys6a4fdqy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hexo搭建github个人博客" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/01/hexo搭建github个人博客/" class="article-date">
  <time datetime="2019-08-01T06:14:28.000Z" itemprop="datePublished">2019-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/01/hexo搭建github个人博客/">&#39;hexo搭建github个人博客&#39;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>hexo搭建github个人博客</p>
<p>国内有很多个人博客，比如cdn，博客园，简书等等</p>
<p>1.什么是HEXO？</p>
<p>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p>
<p>2.安装HEXO</p>
<p>安装Hexo只需10分钟时间，相当简单。但有个安装前提，在安装前，您必须检查电脑中是否已安装下列应用程序</p>
<p>Node.js （安装nodejs自带了npm包管理工具）</p>
<p>Git （代码管理工具）</p>
<p>Node.js 安装包及源码下载地址为：<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">https://nodejs.org/en/download/</a> </p>
<p>GIt下载地址：<a href="https://git-scm.com/downloads" target="_blank" rel="noopener">https://git-scm.com/downloads</a></p>
<p>也可以用本地的安装包</p>
<p>一路默认便可(建议安装到本地的新建一个文件夹)</p>
<p>nodejs安装</p>
<p>配置环境变量</p>
<p>打开黑窗口cmd</p>
<p>看到版本号表示配置成功</p>
<p>git安装</p>
<p>一路默认,安装后出现下图表示成功</p>
<p>按鼠标右键出来：</p>
<p>安装淘宝镜像：</p>
<p>默认的npm是国外镜像，要去国外的源下载东西，切换淘宝源是用国内的镜像地址下载我的的库</p>
<p>使用淘宝NPM安装Hexo的脚手架工具 </p>
<pre><code>cnpm install -g hexo-cli</code></pre><p>安装hexo</p>
<pre><code>cnpm install hexo --save</code></pre><p>查看是否安装成功</p>
<pre><code>hexo -v</code></pre><p>3.本地运行hexo</p>
<p>初始化hexo</p>
<p> hexo init</p>
<ul>
<li><p>安装生成器</p>
<p>cnpm install</p>
</li>
<li><p>运行hexo,以后要在本地运行博客只要输入该命令即可</p>
<p>hexo s -g</p>
</li>
</ul>
<p>打开浏览器，输入localhost:4000,就可以在本地看到你的个人博客了 </p>
<ul>
<li>停止运行<br>按住Ctrl+C键即可停止</li>
</ul>
<p>hexo常用的几个命令：</p>
<p>hexo init   blog   //初始化博客项目的名称</p>
<p>cd blog             //进入项目目录</p>
<p>npm install   //安装项目需要的依赖(包括hexo了)</p>
<p>hexo  n   ‘文章的名称’  </p>
<p>hexo g     生成静态页面</p>
<p>hexo s      启动本地服务</p>
<p>hexo d   发布到线上仓库 username.github.io</p>
<p>4.安装一个工具，上传我们hexo代码到github的工具</p>
<pre><code>cnpm install   hexo-deployer-git --save</code></pre><p>或则</p>
<pre><code>npm install   hexo-deployer-git --registry https://registry.npm.taobao.org --save</code></pre><p>过程比较慢，慢慢等等</p>
<p>5.需要配置线上仓库：</p>
<pre><code>1.配置 _config.yml 

deploy:
  type: git
  repo: git@github.com:xxx/xxx.github.io.git
  branch: master</code></pre><p>6.打通git线上线下环境</p>
<p>1.配置本地的用户名密码</p>
<p>git config –global user.name 名字     # 叫啥名字</p>
<p>git config –global user.email 邮箱         # 怎么联系你</p>
<p>2.生成公钥密钥</p>
<p> ssh-keygen  -t rsa -C（大写C哦） ‘邮箱地址’</p>
<p>成功之后会在当前用户的目录多出如下的两个文件。</p>
<p>id.rsa:私钥文件</p>
<p>id_rsa.pub:公钥文件</p>
<p>3.配置私钥到github上的ssh设置</p>
<p>复制id.rsa到GitHub用户设置的ssh上</p>
<p>相当于GitHub密钥（钥匙）链接我们的公钥（锁头）       —注意一个key只能用一个GitHub账号</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/01/hexo搭建github个人博客/" data-id="cjysgypaw0000nouy2nj1on0t" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/08/01/rabbtMQ/">&#39;rabbtMQ&#39;</a>
          </li>
        
          <li>
            <a href="/2019/08/01/linux编译安装lanmp/">&#39;linux编译安装lanmp&#39;</a>
          </li>
        
          <li>
            <a href="/2019/08/01/linux权限和yum安装lamp/">&#39;linux权限和yum安装lamp&#39;</a>
          </li>
        
          <li>
            <a href="/2019/08/01/linux用户和权限/">&#39;linux用户和权限&#39;</a>
          </li>
        
          <li>
            <a href="/2019/08/01/linux系统搭建和命令的使用/">&#39;linux命令的使用&#39;</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>